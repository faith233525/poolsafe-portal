<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LounGenie Support Portal - Professional B2B Platform</title>
    <!-- Microsoft Authentication Library (MSAL) -->
    <script src="https://alcdn.msauth.net/browser/2.38.3/js/msal-browser.min.js"></script>
    <!-- Chart.js for Advanced Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chart.js Date Adapter for Time-based Charts -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <!-- Leaflet for Interactive Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Leaflet MarkerCluster Plugin -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css"
    />
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    <style>
      /* Professional B2B Color System */
      :root {
        --primary: #002b4c; /* Dark Blue - Primary brand */
        --secondary: #005a8d; /* Medium Blue - Secondary elements */
        --accent: #00b5cc; /* Aqua - Accents & highlights */
        --gray-dark: #333333; /* Dark gray - Text */
        --white: #ffffff; /* White - Backgrounds */
        --gray-50: #fafafa;
        --gray-100: #f4f4f5;
        --gray-200: #e4e4e7;
        --gray-300: #d1d5db;
        --gray-400: #9ca3af;
        --gray-500: #6b7280;
        --gray-600: #4b5563;
        --gray-700: #374151;
        --success: #059669;
        --warning: #d97706;
        --error: #dc2626;

        /* Shadows - HubSpot Style */
        --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.05), 0 2px 4px rgba(0, 0, 0, 0.03);
        --shadow-lg: 0 8px 25px rgba(0, 43, 76, 0.1);
        --shadow-card: 0 2px 8px rgba(0, 0, 0, 0.06);

        /* Border radius */
        --radius: 6px;
        --radius-md: 8px;
        --radius-lg: 12px;

        /* Typography */
        --font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell",
          sans-serif;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: var(--font-family);
        background-color: var(--gray-50);
        color: var(--gray-dark);
        line-height: 1.5;
        font-size: 14px;
      }

      /* Professional Header */
      .header {
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        color: var(--white);
        padding: 12px 0;
        box-shadow: var(--shadow-lg);
        position: relative;
        z-index: 100;
      }

      .header-content {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 24px;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 12px;
        font-weight: 700;
        font-size: 20px;
      }

      .logo-svg {
        height: 32px;
        width: auto;
      }

      .logo-text {
        display: flex;
        flex-direction: column;
        line-height: 1;
      }

      .logo-main {
        font-size: 20px;
        font-weight: 700;
        background: linear-gradient(135deg, #00b5cc 0%, #f4a261 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .logo-tagline {
        font-size: 8px;
        color: rgba(255, 255, 255, 0.8);
        letter-spacing: 2px;
        text-transform: uppercase;
        margin-top: 2px;
      }

      .user-menu {
        display: flex;
        align-items: center;
        gap: 16px;
        font-size: 13px;
      }

      .user-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: var(--accent);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 12px;
      }

      /* Main Container */
      .container {
        display: flex;
        min-height: calc(100vh - 60px);
      }

      /* Sidebar Styles */
      .sidebar {
        width: 280px;
        background: linear-gradient(180deg, #1e293b 0%, #334155 100%);
        border-right: 1px solid #475569;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        position: fixed;
        left: 0;
        top: 60px;
        bottom: 0;
        z-index: 100;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
      }

      .sidebar.collapsed {
        width: 70px;
      }

      .sidebar-header {
        padding: 24px 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .sidebar-brand {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .sidebar-brand h3 {
        color: white;
        font-size: 18px;
        font-weight: 700;
        margin: 0;
        transition: opacity 0.3s ease;
      }

      .sidebar.collapsed .sidebar-brand h3 {
        opacity: 0;
        width: 0;
      }

      .sidebar-toggle {
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: white;
        width: 36px;
        height: 36px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .sidebar-toggle:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: scale(1.05);
      }

      .sidebar-nav {
        flex: 1;
        padding: 20px 0;
        overflow-y: auto;
      }

      .nav-section {
        margin-bottom: 32px;
      }

      .nav-section-title {
        color: rgba(255, 255, 255, 0.6);
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        padding: 0 20px 12px 20px;
        margin: 0;
        transition: opacity 0.3s ease;
      }

      .sidebar.collapsed .nav-section-title {
        opacity: 0;
      }

      .nav-list {
        list-style: none;
        margin: 0;
        padding: 0;
      }

      .nav-item {
        margin-bottom: 4px;
      }

      .nav-link {
        display: flex;
        align-items: center;
        gap: 16px;
        padding: 12px 20px;
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.3s ease;
        border-radius: 0;
        position: relative;
        cursor: pointer;
      }

      .nav-link:hover {
        background: rgba(255, 255, 255, 0.1);
        color: white;
        transform: translateX(4px);
      }

      .nav-link.active {
        background: rgba(59, 130, 246, 0.2);
        color: #60a5fa;
        border-right: 3px solid #3b82f6;
      }

      .nav-link.active::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 3px;
        background: #3b82f6;
      }

      .nav-icon {
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        flex-shrink: 0;
      }

      .nav-text {
        transition: opacity 0.3s ease;
      }

      .sidebar.collapsed .nav-text {
        opacity: 0;
        width: 0;
      }

      .nav-badge {
        background: #ef4444;
        color: white;
        font-size: 10px;
        font-weight: 700;
        padding: 2px 6px;
        border-radius: 10px;
        margin-left: auto;
        transition: opacity 0.3s ease;
      }

      .sidebar.collapsed .nav-badge {
        opacity: 0;
      }

      /* Main Content Area */
      .main-content {
        flex: 1;
        margin-left: 280px;
        transition: margin-left 0.3s ease;
        background: #f8fafc;
        max-width: 1200px;
        margin-left: 280px;
        margin-right: auto;
        padding: 24px;
      }

      .sidebar.collapsed + .main-content {
        margin-left: 70px;
      }

      /* Sidebar User Info */
      .sidebar-user {
        padding: 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(0, 0, 0, 0.1);
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .user-info-avatar {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 14px;
        flex-shrink: 0;
      }

      .user-info-details {
        flex: 1;
        transition: opacity 0.3s ease;
      }

      .sidebar.collapsed .user-info-details {
        opacity: 0;
        width: 0;
      }

      .user-info-name {
        color: white;
        font-weight: 600;
        font-size: 14px;
        margin: 0 0 4px 0;
      }

      .user-info-role {
        color: rgba(255, 255, 255, 0.6);
        font-size: 12px;
        margin: 0;
      }

      /* Mobile Menu Button */
      .mobile-menu-btn {
        display: none;
        background: rgba(255, 255, 255, 0.15);
        border: none;
        color: white;
        width: 44px;
        height: 44px;
        border-radius: 8px;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        margin-right: 16px;
      }

      /* Responsive Sidebar */
      @media (max-width: 1024px) {
        .sidebar {
          transform: translateX(-100%);
        }

        .sidebar.mobile-open {
          transform: translateX(0);
        }

        .main-content {
          margin-left: 0;
        }

        .sidebar.collapsed + .main-content {
          margin-left: 0;
        }

        .mobile-menu-btn {
          display: flex;
        }
      }

      /* Sidebar Overlay for Mobile */
      .sidebar-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 99;
        display: none;
      }

      .sidebar-overlay.active {
        display: block;
      }

      /* Enhanced Professional Login */
      .login-container {
        max-width: 480px;
        margin: 40px auto;
        background: var(--white);
        border-radius: 16px;
        box-shadow:
          0 20px 40px rgba(0, 43, 76, 0.1),
          0 8px 16px rgba(0, 0, 0, 0.05);
        padding: 48px 40px;
        border: 1px solid var(--gray-200);
        position: relative;
        overflow: hidden;
      }

      .login-container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(135deg, var(--accent) 0%, var(--primary) 100%);
      }

      .login-header {
        text-align: center;
        margin-bottom: 40px;
      }

      .login-title {
        color: var(--primary);
        font-size: 28px;
        font-weight: 700;
        margin: 16px 0 8px 0;
        letter-spacing: -0.5px;
      }

      .login-subtitle {
        color: var(--gray-500);
        font-size: 15px;
        font-weight: 400;
        line-height: 1.5;
      }

      .login-header h1 {
        font-size: 24px;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 8px;
      }

      .login-header p {
        color: var(--gray-500);
        font-size: 14px;
      }

      .role-cards {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .role-card {
        border: 2px solid var(--gray-200);
        border-radius: 12px;
        padding: 24px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        background: var(--white);
        position: relative;
        overflow: hidden;
      }

      .role-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        transition: left 0.5s;
      }

      .role-card:hover {
        border-color: var(--accent);
        box-shadow:
          0 12px 24px rgba(0, 43, 76, 0.1),
          0 4px 8px rgba(0, 0, 0, 0.05);
        transform: translateY(-4px);
      }

      .role-card:hover::before {
        left: 100%;
      }

      .role-card.active {
        border-color: var(--primary);
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        color: var(--white);
        box-shadow: 0 16px 32px rgba(0, 43, 76, 0.2);
      }

      .role-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 8px;
      }

      .role-icon {
        width: 40px;
        height: 40px;
        border-radius: var(--radius);
        background: var(--primary);
        color: var(--white);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
      }

      .role-title {
        font-weight: 600;
        font-size: 16px;
        color: var(--primary);
      }

      .role-description {
        font-size: 13px;
        color: var(--gray-600);
        line-height: 1.4;
      }

      /* Dashboard Layout */
      .dashboard {
        display: none;
      }

      .dashboard.active {
        display: block;
      }

      .dashboard-header {
        background: var(--white);
        border-radius: var(--radius-md);
        padding: 24px;
        margin-bottom: 24px;
        box-shadow: var(--shadow-card);
        border: 1px solid var(--gray-200);
      }

      .dashboard-title {
        font-size: 24px;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 8px;
      }

      .dashboard-subtitle {
        color: var(--gray-600);
        font-size: 14px;
      }

      /* Stats Grid */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 20px;
        margin-bottom: 32px;
      }

      .stat-card {
        background: var(--white);
        border-radius: var(--radius-md);
        padding: 24px;
        box-shadow: var(--shadow-card);
        border: 1px solid var(--gray-200);
        position: relative;
        overflow: hidden;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
      }

      .stat-card:hover {
        transform: translateY(-4px) scale(1.02);
        box-shadow:
          0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
        border-color: var(--primary);
      }

      .stat-card:hover::before {
        height: 6px;
        background: linear-gradient(90deg, var(--primary), var(--accent), #10b981);
      }

      .stat-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(90deg, var(--primary), var(--accent));
      }

      .stat-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 16px;
      }

      .stat-icon {
        width: 40px;
        height: 40px;
        border-radius: var(--radius);
        background: rgba(0, 43, 76, 0.1);
        color: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
      }

      .stat-label {
        font-weight: 600;
        color: var(--gray-700);
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .stat-value {
        font-size: 32px;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 4px;
      }

      .stat-change {
        font-size: 12px;
        color: var(--success);
        font-weight: 500;
      }

      /* Enhanced Dashboard Styles */
      .dashboard-header {
        margin-bottom: 32px;
      }

      .header-content {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 24px;
      }

      .header-actions {
        display: flex;
        gap: 12px;
        flex-shrink: 0;
      }

      .dashboard-title {
        font-size: 28px;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 8px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .dashboard-subtitle {
        font-size: 15px;
        color: var(--gray-600);
        font-weight: 500;
      }

      /* Enhanced Stats Grid */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 24px;
        margin-bottom: 40px;
      }

      .stat-card {
        background: var(--white);
        border-radius: 16px;
        padding: 28px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid var(--gray-200);
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
      }

      .stat-card.highlight {
        border: 2px solid var(--accent);
        background: linear-gradient(135deg, rgba(0, 181, 204, 0.02), rgba(0, 181, 204, 0.08));
      }

      .stat-card.urgent {
        border: 2px solid #ef4444;
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.02), rgba(239, 68, 68, 0.08));
      }

      .stat-header {
        display: flex;
        align-items: flex-start;
        gap: 16px;
        margin-bottom: 20px;
      }

      .stat-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        color: white;
        flex-shrink: 0;
      }

      .gradient-blue {
        background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      }
      .gradient-green {
        background: linear-gradient(135deg, #10b981, #059669);
      }
      .gradient-orange {
        background: linear-gradient(135deg, #f59e0b, #d97706);
      }
      .gradient-red {
        background: linear-gradient(135deg, #ef4444, #dc2626);
      }
      .gradient-purple {
        background: linear-gradient(135deg, #8b5cf6, #7c3aed);
      }
      .gradient-cyan {
        background: linear-gradient(135deg, #06b6d4, #0891b2);
      }

      .stat-details {
        flex: 1;
      }

      .stat-label {
        font-weight: 600;
        color: var(--gray-800);
        font-size: 15px;
        margin-bottom: 4px;
      }

      .stat-sublabel {
        font-size: 13px;
        color: var(--gray-500);
        font-weight: 400;
      }

      .stat-value {
        font-size: 36px;
        font-weight: 800;
        color: var(--primary);
        margin-bottom: 8px;
        line-height: 1;
      }

      .stat-change {
        font-size: 13px;
        font-weight: 600;
        margin-bottom: 16px;
        padding: 4px 8px;
        border-radius: 6px;
        display: inline-block;
      }

      .stat-change.positive {
        color: #059669;
        background: rgba(16, 185, 129, 0.1);
      }

      .stat-change.critical {
        color: #dc2626;
        background: rgba(239, 68, 68, 0.1);
      }

      .stat-change.neutral {
        color: var(--gray-600);
        background: rgba(107, 114, 128, 0.1);
      }

      .stat-progress {
        height: 6px;
        background: var(--gray-200);
        border-radius: 3px;
        overflow: hidden;
      }

      .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, var(--accent), var(--secondary));
        border-radius: 3px;
        transition: width 0.3s ease;
      }

      .progress-bar.critical {
        background: linear-gradient(90deg, #ef4444, #dc2626);
      }

      @media (max-width: 768px) {
        .header-content {
          flex-direction: column;
          gap: 16px;
        }

        .stats-grid {
          grid-template-columns: 1fr;
        }
      }

      /* Content Grid */
      .content-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 24px;
      }

      .content-card {
        background: var(--white);
        border-radius: var(--radius-md);
        box-shadow: var(--shadow-card);
        border: 1px solid var(--gray-200);
        overflow: hidden;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .content-card:hover {
        transform: translateY(-2px);
        box-shadow:
          0 12px 24px -4px rgba(0, 0, 0, 0.12),
          0 8px 16px -4px rgba(0, 0, 0, 0.08);
        border-color: rgba(59, 130, 246, 0.3);
      }

      .card-header {
        padding: 20px 24px;
        border-bottom: 1px solid var(--gray-200);
        background: var(--gray-50);
      }

      .card-title {
        font-weight: 600;
        font-size: 16px;
        color: var(--primary);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .card-body {
        padding: 24px;
      }

      /* Activity List */
      .activity-list {
        display: flex;
        flex-direction: column;
      }

      .activity-item {
        display: flex;
        gap: 16px;
        padding: 16px 0;
        border-bottom: 1px solid var(--gray-100);
      }

      .activity-item:last-child {
        border-bottom: none;
      }

      .activity-icon {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: rgba(0, 181, 204, 0.1);
        color: var(--accent);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        flex-shrink: 0;
      }

      .activity-content h4 {
        font-weight: 600;
        font-size: 14px;
        color: var(--gray-dark);
        margin-bottom: 4px;
      }

      .activity-content p {
        font-size: 13px;
        color: var(--gray-600);
        margin-bottom: 8px;
      }

      .activity-meta {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      /* Status Badges */
      .badge {
        display: inline-flex;
        align-items: center;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .badge-open {
        background: #fef3c7;
        color: #92400e;
      }

      .badge-progress {
        background: #dbeafe;
        color: #1e40af;
      }

      .badge-resolved {
        background: #d1fae5;
        color: #065f46;
      }

      .badge-urgent {
        background: #fecaca;
        color: #991b1b;
      }

      /* Buttons */
      .btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        border-radius: var(--radius);
        font-weight: 500;
        font-size: 13px;
        text-decoration: none;
        border: none;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .btn-primary {
        background: var(--primary);
        color: var(--white);
      }

      .btn-primary:hover {
        background: var(--secondary);
        color: var(--white);
      }

      .btn-primary:active {
        background: #001a2e;
        color: var(--white);
        transform: translateY(1px);
      }

      .btn-primary:focus {
        outline: 2px solid var(--accent);
        outline-offset: 2px;
        background: var(--secondary);
        color: var(--white);
      }

      .btn-secondary {
        background: var(--gray-100);
        color: var(--gray-700);
        border: 1px solid var(--gray-200);
      }

      .btn-secondary:hover {
        background: var(--gray-200);
        color: var(--gray-800);
        border-color: var(--gray-300);
      }

      .btn-secondary:active {
        background: var(--gray-300);
        color: var(--gray-900);
        border-color: var(--gray-400);
        transform: translateY(1px);
      }

      .btn-secondary:focus {
        outline: 2px solid var(--accent);
        outline-offset: 2px;
        background: var(--gray-200);
        color: var(--gray-800);
      }

      /* Disabled button states */
      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        pointer-events: none;
      }

      .btn-primary:disabled {
        background: var(--gray-400);
        color: var(--gray-600);
      }

      .btn-secondary:disabled {
        background: var(--gray-100);
        color: var(--gray-400);
        border-color: var(--gray-200);
      }

      /* Success button variant for admin actions */
      .btn-success {
        background: #10b981;
        color: var(--white);
      }

      .btn-success:hover {
        background: #059669;
        color: var(--white);
      }

      .btn-success:active {
        background: #047857;
        color: var(--white);
        transform: translateY(1px);
      }

      .btn-success:focus {
        outline: 2px solid #10b981;
        outline-offset: 2px;
        background: #059669;
        color: var(--white);
      }

      /* Quick Actions */
      .quick-actions {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .action-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 16px;
        border-radius: var(--radius);
        background: var(--gray-50);
        color: var(--gray-700);
        text-decoration: none;
        font-size: 13px;
        font-weight: 500;
        transition: all 0.2s ease;
      }

      .action-item:hover {
        background: rgba(0, 43, 76, 0.05);
        color: var(--primary);
      }

      .action-icon {
        width: 16px;
        text-align: center;
      }

      /* Responsive */
      @media (max-width: 1024px) {
        .content-grid {
          grid-template-columns: 1fr;
        }

        .stats-grid {
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }
      }

      @media (max-width: 768px) {
        .container {
          padding: 16px;
        }

        .stats-grid {
          grid-template-columns: 1fr;
        }

        .header-content {
          padding: 0 16px;
        }
      }

      /* Hide elements initially */
      .auth-section {
        display: none;
        margin-top: 20px;
      }

      .auth-section.active {
        display: block;
      }

      .form-group {
        margin-bottom: 16px;
      }

      .form-label {
        display: block;
        font-weight: 500;
        color: var(--gray-700);
        margin-bottom: 6px;
        font-size: 13px;
      }

      .form-input {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid var(--gray-300);
        border-radius: var(--radius);
        font-size: 14px;
        transition: border-color 0.2s ease;
      }

      .form-input:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(0, 181, 204, 0.1);
      }

      /* Admin Panel Styles */
      .admin-panel {
        display: flex;
        flex-direction: column;
        gap: 32px;
      }

      .logo-management h3,
      .system-settings h3 {
        color: var(--primary);
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 20px;
        border-bottom: 2px solid rgba(26, 46, 75, 0.1);
        padding-bottom: 8px;
      }

      .current-logos {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
        margin-bottom: 16px;
      }

      .logo-preview {
        border: 1px solid rgba(0, 0, 0, 0.1);
        border-radius: var(--radius);
        padding: 20px;
        background: white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .logo-preview h4 {
        font-size: 14px;
        font-weight: 600;
        color: var(--gray-700);
        margin-bottom: 16px;
        text-align: center;
      }

      .logo-container {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 80px;
        background: #f8f9fa;
        border-radius: var(--radius);
        margin-bottom: 16px;
        padding: 16px;
      }

      .preview-logo {
        max-width: 100%;
        max-height: 60px;
        object-fit: contain;
      }

      .upload-controls {
        text-align: center;
      }

      .hidden-input {
        display: none;
      }

      .upload-status {
        padding: 12px 16px;
        border-radius: var(--radius);
        margin-top: 16px;
        font-weight: 500;
        text-align: center;
      }

      .upload-status.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .upload-status.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .upload-status.info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }

      .settings-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        align-items: end;
      }

      .setting-item {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .setting-item label {
        font-weight: 600;
        color: var(--gray-700);
        font-size: 13px;
      }

      .form-control {
        padding: 12px 16px;
        border: 1px solid rgba(0, 0, 0, 0.2);
        border-radius: var(--radius);
        font-size: 14px;
        transition: all 0.2s ease;
      }

      .form-control:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(0, 181, 204, 0.1);
      }

      @media (max-width: 768px) {
        .current-logos {
          grid-template-columns: 1fr;
        }

        .settings-grid {
          grid-template-columns: 1fr;
        }
      }

      /* Enhanced Content Grid Styles */
      .enhanced-content-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 24px;
        margin: 24px 0;
      }

      .priority-panel {
        background: linear-gradient(135deg, #ffffff 0%, #fafbfc 100%);
        border: 1px solid #e2e8f0;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
      }

      .priority-panel .card-header {
        background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        color: white;
        padding: 20px 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .priority-panel .card-title {
        font-size: 18px;
        font-weight: 700;
        margin: 0;
      }

      .card-actions {
        display: flex;
        gap: 8px;
      }

      .btn-icon {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        background: rgba(255, 255, 255, 0.1);
        color: white;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .btn-icon:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: scale(1.05);
      }

      .activity-list.enhanced {
        display: flex;
        flex-direction: column;
        gap: 16px;
        padding: 24px;
      }

      .activity-item {
        display: flex;
        gap: 16px;
        padding: 20px;
        background: white;
        border: 1px solid #f1f5f9;
        border-radius: 12px;
        transition: all 0.3s ease;
        position: relative;
      }

      .activity-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        border-color: #e2e8f0;
      }

      .activity-item.critical {
        border-left: 4px solid #dc2626;
        background: linear-gradient(135deg, #fefefe 0%, #fef2f2 100%);
      }

      .activity-item.high {
        border-left: 4px solid #f59e0b;
        background: linear-gradient(135deg, #fefefe 0%, #fffbeb 100%);
      }

      .activity-item.medium {
        border-left: 4px solid #3b82f6;
        background: linear-gradient(135deg, #fefefe 0%, #eff6ff 100%);
      }

      .activity-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        flex-shrink: 0;
      }

      .critical-gradient {
        background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
        color: white;
        box-shadow: 0 4px 16px rgba(220, 38, 38, 0.3);
      }

      .high-gradient {
        background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
        color: white;
        box-shadow: 0 4px 16px rgba(245, 158, 11, 0.3);
      }

      .medium-gradient {
        background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%);
        color: white;
        box-shadow: 0 4px 16px rgba(59, 130, 246, 0.3);
      }

      .activity-content {
        flex: 1;
        min-width: 0;
      }

      .activity-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 8px;
        gap: 12px;
      }

      .activity-header h4 {
        font-size: 16px;
        font-weight: 700;
        color: #1e293b;
        margin: 0;
        line-height: 1.4;
      }

      .ticket-id {
        font-size: 12px;
        font-weight: 600;
        color: #64748b;
        background: #f1f5f9;
        padding: 4px 8px;
        border-radius: 6px;
        flex-shrink: 0;
      }

      .activity-content p {
        color: #475569;
        font-size: 14px;
        line-height: 1.5;
        margin: 8px 0 12px 0;
      }

      .activity-details {
        display: flex;
        gap: 16px;
        margin-bottom: 12px;
        flex-wrap: wrap;
      }

      .activity-details span {
        font-size: 12px;
        font-weight: 600;
        color: #64748b;
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .priority.critical {
        color: #dc2626;
      }

      .priority.high {
        color: #f59e0b;
      }

      .priority.medium {
        color: #3b82f6;
      }

      .activity-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
      }

      .badge.pulse {
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.7;
        }
      }

      .timestamp {
        font-size: 12px;
        color: #94a3b8;
        font-weight: 500;
      }

      /* Enhanced Quick Actions Grid */
      .quick-actions-panel {
        background: linear-gradient(135deg, #ffffff 0%, #fafbfc 100%);
        border: 1px solid #e2e8f0;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
      }

      .quick-actions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        padding: 4px;
      }

      .quick-action-btn {
        display: flex;
        align-items: center;
        gap: 16px;
        padding: 20px;
        background: white;
        border: 1px solid #f1f5f9;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: left;
        position: relative;
        overflow: hidden;
      }

      .quick-action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        border-color: #e2e8f0;
      }

      .quick-action-btn.critical {
        border-left: 4px solid #dc2626;
      }

      .quick-action-btn.critical:hover {
        background: linear-gradient(135deg, #fefefe 0%, #fef2f2 100%);
      }

      .quick-action-btn.high {
        border-left: 4px solid #f59e0b;
      }

      .quick-action-btn.high:hover {
        background: linear-gradient(135deg, #fefefe 0%, #fffbeb 100%);
      }

      .quick-action-btn.medium {
        border-left: 4px solid #3b82f6;
      }

      .quick-action-btn.medium:hover {
        background: linear-gradient(135deg, #fefefe 0%, #eff6ff 100%);
      }

      .quick-action-btn.normal {
        border-left: 4px solid #10b981;
      }

      .quick-action-btn.normal:hover {
        background: linear-gradient(135deg, #fefefe 0%, #f0fdf4 100%);
      }

      .quick-action-btn .action-icon {
        font-size: 24px;
        flex-shrink: 0;
      }

      .action-content {
        flex: 1;
        min-width: 0;
      }

      .action-label {
        font-size: 14px;
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 4px;
      }

      .action-desc {
        font-size: 12px;
        color: #64748b;
        line-height: 1.4;
      }

      @media (max-width: 768px) {
        .quick-actions-grid {
          grid-template-columns: 1fr;
        }

        .quick-action-btn {
          padding: 16px;
          gap: 12px;
        }
      }

      /* Inline Style Fixes */
      .header-poolsafe-logo {
        height: 28px;
        margin-right: 16px;
        filter: brightness(0) invert(1);
      }

      .logo-separator {
        border-left: 2px solid rgba(255, 255, 255, 0.3);
        height: 30px;
        margin: 0 16px;
      }

      .header-loungenie-logo {
        enable-background: new 0 0 348 101;
        height: 32px;
      }

      .header-portal-text {
        color: white;
        font-size: 14px;
        margin-left: 8px;
      }

      .user-menu-visible {
        display: flex;
      }

      .login-container-hidden {
        display: none;
      }

      .login-logo-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 16px;
      }

      .login-poolsafe-logo {
        height: 36px;
        width: auto;
        margin-bottom: 8px;
      }

      .login-separator {
        width: 60px;
        height: 1px;
        background: var(--gray-300);
        margin: 4px 0;
      }

      .login-loungenie-logo {
        enable-background: new 0 0 348 101;
        height: 48px;
        width: auto;
      }

      /* SVG gradient stops need inline styles for proper rendering */
      .gradient-stop-start {
        stop-color: #00b5cc !important;
        stop-opacity: 1 !important;
      }

      .gradient-stop-middle {
        stop-color: #52c7a3 !important;
        stop-opacity: 1 !important;
      }

      .gradient-stop-end {
        stop-color: #f4a261 !important;
        stop-opacity: 1 !important;
      }

      .btn-full-width {
        width: 100%;
      }

      .btn-full-width-spaced {
        width: 100%;
        margin-bottom: 12px;
      }

      .outlook-icon {
        margin-right: 8px;
        vertical-align: middle;
      }

      .timestamp-text {
        color: var(--gray-500);
        font-size: 12px;
      }

      .admin-settings-visible {
        display: block;
      }

      .file-input-hidden {
        display: none;
      }

      .upload-status-hidden {
        display: none;
      }

      /* Accessibility improvements for form elements */
      .visually-hidden {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      .login-loungenie-path {
        fill: url(#loginLoungenieGradOfficial);
      }

      /* Partner Map Styles */
      .map-section-hidden {
        display: none;
      }

      .section-card {
        background: white;
        border-radius: 16px;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        overflow: hidden;
        margin-bottom: 24px;
      }

      .section-header {
        background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        color: white;
        padding: 20px 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .section-header h2 {
        margin: 0;
        font-size: 20px;
        font-weight: 700;
      }

      .map-controls {
        display: flex;
        gap: 12px;
      }

      .map-filters {
        padding: 20px 24px;
        background: #f8fafc;
        border-bottom: 1px solid #e2e8f0;
        display: flex;
        gap: 24px;
        align-items: center;
        flex-wrap: wrap;
      }

      .filter-group {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .filter-group label {
        font-size: 14px;
        font-weight: 600;
        color: #475569;
      }

      .filter-group select {
        padding: 8px 12px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        background: white;
        font-size: 14px;
        min-width: 140px;
      }

      .partner-stats {
        font-size: 14px;
        color: #64748b;
        font-weight: 500;
      }

      .map-container {
        position: relative;
        padding: 24px;
      }

      .interactive-map {
        width: 100%;
        height: 600px;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        position: relative;
        background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
        overflow: hidden;
      }

      .leaflet-map {
        background: transparent;
        z-index: 1;
      }

      /* Leaflet popup styling */
      .leaflet-popup-content {
        margin: 8px 12px;
      }

      .map-popup h4 {
        margin: 0 0 8px 0;
        color: var(--primary);
        font-size: 14px;
      }

      .map-popup p {
        margin: 4px 0;
        font-size: 12px;
        color: var(--gray-dark);
      }

      .map-popup .status {
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 10px;
        font-weight: bold;
        text-transform: uppercase;
      }

      .map-popup .status.active {
        background: #10b981;
        color: white;
      }

      .map-popup .status.maintenance {
        background: #f59e0b;
        color: white;
      }

      .map-popup .status.offline {
        background: #ef4444;
        color: white;
      }

      .map-popup .btn {
        margin-top: 8px;
        padding: 4px 8px;
        font-size: 11px;
      }

      .map-legend {
        position: absolute;
        top: 40px;
        right: 40px;
        background: white;
        padding: 16px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        min-width: 150px;
      }

      .map-legend h4 {
        margin: 0 0 12px 0;
        font-size: 14px;
        font-weight: 700;
        color: #1e293b;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
        font-size: 12px;
        color: #475569;
      }

      .marker {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        border: 2px solid white;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .active-marker {
        background: #10b981;
      }

      .maintenance-marker {
        background: #f59e0b;
      }

      .offline-marker {
        background: #ef4444;
      }

      /* Partner Markers on Map */
      .partner-marker {
        position: absolute;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        border: 3px solid white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        cursor: pointer;
        transition: all 0.3s ease;
        z-index: 10;
      }

      .partner-marker:hover {
        transform: scale(1.3);
        z-index: 20;
      }

      .partner-marker.active {
        background: #10b981;
      }

      .partner-marker.maintenance {
        background: #f59e0b;
      }

      .partner-marker.offline {
        background: #ef4444;
      }

      .partner-marker.selected {
        transform: scale(1.5);
        box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.3);
        z-index: 30;
      }

      /* Partner Tooltip */
      .partner-tooltip {
        position: absolute;
        background: #1e293b;
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 500;
        pointer-events: none;
        z-index: 100;
        white-space: nowrap;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      }

      .partner-tooltip::after {
        content: "";
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        border: 5px solid transparent;
        border-top-color: #1e293b;
      }

      /* Partner Details Panel */
      .partner-details-panel {
        position: absolute;
        top: 20px;
        left: 20px;
        width: 350px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        z-index: 50;
        overflow: hidden;
      }

      .partner-details-hidden {
        display: none;
      }

      .panel-header {
        background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        color: white;
        padding: 16px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .panel-header h3 {
        margin: 0;
        font-size: 16px;
        font-weight: 700;
      }

      .close-btn {
        background: none;
        border: none;
        color: white;
        font-size: 20px;
        cursor: pointer;
        padding: 0;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 4px;
        transition: background 0.2s ease;
      }

      .close-btn:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      .panel-content {
        padding: 20px;
      }

      .partner-info {
        margin-bottom: 20px;
      }

      .info-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-size: 14px;
      }

      .info-row strong {
        color: #374151;
        min-width: 80px;
      }

      .info-row span {
        color: #6b7280;
        text-align: right;
      }

      .partner-actions {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      .partner-actions .btn {
        flex: 1;
        min-width: 100px;
        padding: 8px 12px;
        font-size: 12px;
      }

      @media (max-width: 768px) {
        .map-filters {
          flex-direction: column;
          align-items: flex-start;
          gap: 16px;
        }

        .partner-details-panel {
          width: calc(100% - 40px);
          left: 20px;
          right: 20px;
        }

        .interactive-map {
          height: 400px;
        }
      }

      /* Hidden State Classes */
      .map-section-hidden {
        display: none;
      }

      .partner-details-hidden {
        display: none;
      }

      /* Visual Map Styles */
      .visual-map-container {
        position: relative;
        height: 500px;
        border-radius: 8px;
        overflow: hidden;
        background: #f8fafc;
        border: 1px solid #e2e8f0;
      }

      .map-background {
        position: relative;
        width: 100%;
        height: 100%;
      }

      .partner-dot {
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .partner-dot:hover {
        r: 12;
        opacity: 0.8;
      }

      .map-legend {
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(255, 255, 255, 0.95);
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
      }

      .legend-item {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
        font-size: 12px;
        color: #374151;
      }

      .legend-item:last-child {
        margin-bottom: 0;
      }

      .legend-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 8px;
        border: 2px solid white;
      }

      .legend-dot.active {
        background-color: #10b981;
      }

      .legend-dot.maintenance {
        background-color: #f59e0b;
      }

      /* Enhanced Map Styles */
      .enhanced-map {
        transition: transform 0.3s ease;
      }

      .partner-marker-group {
        cursor: pointer;
        transition: transform 0.2s ease;
      }

      .partner-marker-group:hover {
        transform: scale(1.1);
        transform-origin: center;
      }

      .cluster-marker-group {
        cursor: pointer;
        transition: transform 0.2s ease;
      }

      .cluster-marker-group:hover {
        transform: scale(1.1);
        transform-origin: center;
      }

      .pulse-ring {
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% {
          opacity: 0.3;
        }
        50% {
          opacity: 0;
        }
        100% {
          opacity: 0.3;
        }
      }

      .enhanced-dot {
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
      }

      .cluster-dot {
        filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.25));
      }

      .partner-icon {
        pointer-events: none;
        -webkit-user-select: none;
        user-select: none;
      }

      .partner-name {
        pointer-events: none;
        -webkit-user-select: none;
        user-select: none;
        font-weight: 500;
      }

      /* Map Controls */
      .map-controls {
        position: absolute;
        top: 15px;
        left: 15px;
        display: flex;
        flex-direction: column;
        gap: 5px;
      }

      .map-control-btn {
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.95);
        border: none;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s ease;
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        color: #6b7280;
      }

      .map-control-btn:hover {
        background: white;
        color: #374151;
        transform: scale(1.05);
      }

      /* Enhanced Map Legend */
      .enhanced-legend {
        position: absolute;
        top: 15px;
        right: 15px;
        background: rgba(255, 255, 255, 0.95);
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
        min-width: 200px;
        max-width: 250px;
      }

      .legend-section {
        margin-bottom: 16px;
      }

      .legend-section:last-child {
        margin-bottom: 0;
      }

      .legend-section h4 {
        margin: 0 0 8px 0;
        font-size: 0.875rem;
        font-weight: 600;
        color: #374151;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .enhanced-legend .legend-item {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
        font-size: 0.875rem;
        color: #6b7280;
      }

      .enhanced-legend .legend-item:last-child {
        margin-bottom: 0;
      }

      .legend-marker {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        margin-right: 10px;
        border: 2px solid white;
        position: relative;
        flex-shrink: 0;
      }

      .legend-marker.water-park.active {
        background-color: #10b981;
      }

      .legend-marker.water-park.active::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 10px;
      }

      .legend-marker.resort.active {
        background-color: #10b981;
      }

      .legend-marker.resort.active::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 10px;
      }

      .legend-marker.maintenance {
        background-color: #f59e0b;
      }

      .legend-cluster {
        width: 24px;
        height: 24px;
        background-color: #6366f1;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: bold;
        margin-right: 10px;
        flex-shrink: 0;
      }

      /* Cluster Details */
      .cluster-info h4 {
        margin: 0 0 15px 0;
        color: #374151;
        font-size: 1rem;
        font-weight: 600;
      }

      .cluster-partner-item {
        padding: 12px;
        border-radius: 8px;
        background: #f8fafc;
        margin-bottom: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        border: 1px solid #e2e8f0;
      }

      .cluster-partner-item:hover {
        background: #e2e8f0;
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .partner-summary {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .partner-type-icon {
        font-size: 1.25rem;
        flex-shrink: 0;
      }

      .partner-summary-text {
        flex: 1;
      }

      .partner-summary-text strong {
        display: block;
        color: #1f2937;
        font-size: 0.875rem;
        margin-bottom: 2px;
      }

      .partner-summary-meta {
        font-size: 0.75rem;
        color: #6b7280;
        text-transform: capitalize;
      }

      /* Mini Chart Styles */
      .mini-chart {
        margin-top: 12px;
        height: 40px;
        position: relative;
      }

      .sparkline {
        width: 100%;
        height: 100%;
      }

      .chart-line {
        stroke-linecap: round;
        stroke-linejoin: round;
      }

      .stat-card:hover .chart-line {
        stroke-width: 2.5;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
      }

      /* Responsive Mini Charts */
      @media (max-width: 768px) {
        .mini-chart {
          height: 30px;
        }
      }

      /* SVG Gradient Definitions */
      .gradient-defs {
        position: absolute;
      }

      .ticket-stop-1 {
        stop-color: #3b82f6;
        stop-opacity: 0.3;
      }

      .ticket-stop-2 {
        stop-color: #3b82f6;
        stop-opacity: 0.05;
      }

      .partner-stop-1 {
        stop-color: #10b981;
        stop-opacity: 0.3;
      }

      .partner-stop-2 {
        stop-color: #10b981;
        stop-opacity: 0.05;
      }

      .resolution-stop-1 {
        stop-color: #f59e0b;
        stop-opacity: 0.3;
      }

      .resolution-stop-2 {
        stop-color: #f59e0b;
        stop-opacity: 0.05;
      }

      /* Global Search Bar */
      .search-container {
        flex: 1;
        max-width: 500px;
        margin: 0 40px;
        position: relative;
      }

      .search-input-wrapper {
        position: relative;
        display: flex;
        align-items: center;
      }

      .search-input {
        width: 100%;
        padding: 12px 16px 12px 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 25px;
        background: rgba(255, 255, 255, 0.15);
        color: white;
        font-size: 14px;
        font-weight: 500;
        outline: none;
        transition: all 0.3s ease;
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
      }

      .search-input::placeholder {
        color: rgba(255, 255, 255, 0.7);
      }

      .search-input:focus {
        border-color: rgba(255, 255, 255, 0.6);
        background: rgba(255, 255, 255, 0.2);
        box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
      }

      .search-button {
        position: absolute;
        right: 8px;
        background: rgba(255, 255, 255, 0.2);
        border: none;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .search-button:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: scale(1.05);
      }

      .search-results {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        margin-top: 8px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        border: 1px solid #e5e7eb;
        max-height: 400px;
        overflow-y: auto;
        z-index: 1000;
      }

      .search-results-hidden {
        display: none;
      }

      .search-result-item {
        padding: 12px 16px;
        border-bottom: 1px solid #f3f4f6;
        cursor: pointer;
        transition: background-color 0.2s ease;
      }

      .search-result-item:last-child {
        border-bottom: none;
      }

      .search-result-item:hover {
        background-color: #f9fafb;
      }

      .search-result-title {
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 4px;
      }

      .search-result-description {
        font-size: 13px;
        color: #6b7280;
      }

      .search-result-category {
        display: inline-block;
        background: #e0f2fe;
        color: #0891b2;
        font-size: 11px;
        font-weight: 600;
        padding: 2px 8px;
        border-radius: 12px;
        margin-bottom: 4px;
      }

      /* Responsive Search */
      @media (max-width: 768px) {
        .search-container {
          margin: 0 20px;
          max-width: 300px;
        }

        .search-input {
          font-size: 12px;
          padding: 10px 14px 10px 16px;
        }
      }

      /* Notification Center */
      .notification-center {
        position: relative;
        margin-right: 20px;
      }

      .notification-button {
        position: relative;
        background: rgba(255, 255, 255, 0.15);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        width: 44px;
        height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
      }

      .notification-button:hover {
        background: rgba(255, 255, 255, 0.25);
        border-color: rgba(255, 255, 255, 0.5);
        transform: scale(1.05);
      }

      .notification-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #ef4444;
        color: white;
        font-size: 11px;
        font-weight: 700;
        min-width: 18px;
        height: 18px;
        border-radius: 9px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid white;
      }

      .notification-panel {
        position: absolute;
        top: 100%;
        right: 0;
        margin-top: 12px;
        width: 380px;
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        border: 1px solid #e5e7eb;
        z-index: 1000;
        overflow: hidden;
      }

      .notification-panel-hidden {
        display: none;
      }

      .notification-header {
        padding: 20px 24px 16px;
        border-bottom: 1px solid #f3f4f6;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .notification-header h3 {
        font-size: 18px;
        font-weight: 700;
        color: #1f2937;
        margin: 0;
      }

      .clear-all-btn {
        background: none;
        border: none;
        color: #6b7280;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: color 0.2s ease;
      }

      .clear-all-btn:hover {
        color: #3b82f6;
      }

      .notification-list {
        max-height: 400px;
        overflow-y: auto;
      }

      .notification-item {
        padding: 16px 24px;
        border-bottom: 1px solid #f9fafb;
        cursor: pointer;
        transition: background-color 0.2s ease;
        position: relative;
      }

      .notification-item:last-child {
        border-bottom: none;
      }

      .notification-item:hover {
        background-color: #f9fafb;
      }

      .notification-item.unread::before {
        content: "";
        position: absolute;
        left: 8px;
        top: 50%;
        transform: translateY(-50%);
        width: 8px;
        height: 8px;
        background: #3b82f6;
        border-radius: 50%;
      }

      .notification-item.unread {
        padding-left: 32px;
        background: #f8fafc;
      }

      .notification-content {
        display: flex;
        align-items: flex-start;
        gap: 12px;
      }

      .notification-icon {
        width: 36px;
        height: 36px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        flex-shrink: 0;
      }

      .notification-icon.success {
        background: #dcfce7;
        color: #16a34a;
      }

      .notification-icon.warning {
        background: #fef3c7;
        color: #d97706;
      }

      .notification-icon.info {
        background: #dbeafe;
        color: #2563eb;
      }

      .notification-icon.error {
        background: #fee2e2;
        color: #dc2626;
      }

      .notification-text {
        flex: 1;
      }

      .notification-title {
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 4px;
        line-height: 1.3;
      }

      .notification-description {
        font-size: 13px;
        color: #6b7280;
        line-height: 1.4;
      }

      .notification-time {
        font-size: 11px;
        color: #9ca3af;
        margin-top: 4px;
      }

      /* Responsive Notifications */
      @media (max-width: 768px) {
        .notification-panel {
          width: 320px;
          right: -20px;
        }

        .notification-center {
          margin-right: 10px;
        }
      }

      /* Comprehensive Analytics Dashboard Styles */
      .analytics-section {
        background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
        border-radius: 20px;
        padding: 32px;
        margin: 32px 0;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        border: 1px solid #e2e8f0;
      }

      .analytics-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 32px;
        flex-wrap: wrap;
        gap: 20px;
      }

      .analytics-title-wrapper h2.analytics-title {
        font-size: 28px;
        font-weight: 800;
        background: linear-gradient(135deg, #1e293b, #3b82f6, #06b6d4);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin: 0 0 8px 0;
      }

      .analytics-subtitle {
        font-size: 16px;
        color: #64748b;
        margin: 0;
      }

      .analytics-controls {
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
      }

      .analytics-filter {
        padding: 10px 16px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        background: white;
        font-size: 14px;
        font-weight: 500;
        color: #374151;
        min-width: 140px;
      }

      /* KPI Overview Grid */
      .kpi-overview-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 24px;
        margin-bottom: 40px;
      }

      .kpi-card {
        background: white;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid #f1f5f9;
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
      }

      .kpi-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
      }

      .kpi-card.primary::before {
        background: linear-gradient(90deg, #3b82f6, #1d4ed8);
      }
      .kpi-card.success::before {
        background: linear-gradient(90deg, #10b981, #059669);
      }
      .kpi-card.warning::before {
        background: linear-gradient(90deg, #f59e0b, #d97706);
      }
      .kpi-card.info::before {
        background: linear-gradient(90deg, #06b6d4, #0891b2);
      }

      .kpi-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
      }

      .kpi-header {
        display: flex;
        align-items: flex-start;
        gap: 16px;
        margin-bottom: 20px;
      }

      .kpi-icon {
        width: 56px;
        height: 56px;
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        color: white;
        flex-shrink: 0;
      }

      .kpi-details {
        flex: 1;
      }

      .kpi-details h4 {
        font-size: 14px;
        font-weight: 600;
        color: #64748b;
        margin: 0 0 8px 0;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .kpi-value {
        font-size: 32px;
        font-weight: 800;
        color: #1e293b;
        line-height: 1;
        margin-bottom: 8px;
      }

      .kpi-change {
        font-size: 13px;
        font-weight: 600;
        padding: 4px 10px;
        border-radius: 20px;
        display: inline-block;
      }

      .kpi-change.positive {
        background: rgba(16, 185, 129, 0.1);
        color: #059669;
      }

      .kpi-change.neutral {
        background: rgba(107, 114, 128, 0.1);
        color: #6b7280;
      }

      .kpi-chart {
        height: 50px;
        margin-top: 16px;
      }

      .kpi-chart canvas {
        width: 100% !important;
        height: 50px !important;
      }

      /* Analytics Charts Grid */
      .analytics-charts-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        grid-template-rows: auto auto;
        gap: 24px;
        margin-bottom: 40px;
      }

      .chart-card {
        background: white;
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid #f1f5f9;
        overflow: hidden;
      }

      .chart-card.large {
        grid-column: 1 / 2;
      }

      .chart-card.medium {
        grid-column: 2 / 3;
      }

      .chart-header {
        background: linear-gradient(135deg, #f8fafc, #ffffff);
        padding: 20px 24px;
        border-bottom: 1px solid #f1f5f9;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .chart-header h3 {
        font-size: 18px;
        font-weight: 700;
        color: #1e293b;
        margin: 0;
      }

      .chart-controls {
        display: flex;
        gap: 8px;
      }

      .chart-btn {
        padding: 6px 12px;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        background: white;
        font-size: 12px;
        font-weight: 600;
        color: #64748b;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .chart-btn.active,
      .chart-btn:hover {
        background: #3b82f6;
        color: white;
        border-color: #3b82f6;
      }

      .chart-body {
        padding: 24px;
      }

      .chart-body canvas {
        width: 100% !important;
        max-height: 300px;
      }

      /* Performance Monitoring */
      .performance-monitoring {
        background: white;
        border-radius: 16px;
        padding: 32px;
        margin-bottom: 32px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid #f1f5f9;
      }

      .monitoring-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
      }

      .monitoring-header h3 {
        font-size: 24px;
        font-weight: 700;
        color: #1e293b;
        margin: 0;
      }

      .monitoring-status {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .status-indicator {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        background: rgba(16, 185, 129, 0.1);
        border-radius: 20px;
        font-size: 14px;
        font-weight: 600;
        color: #059669;
      }

      .pulse-dot {
        width: 8px;
        height: 8px;
        background: #10b981;
        border-radius: 50%;
        animation: pulse 2s infinite;
      }

      .monitoring-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 24px;
      }

      .monitor-card {
        background: #f8fafc;
        border-radius: 12px;
        padding: 20px;
        border: 1px solid #e2e8f0;
      }

      .monitor-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 20px;
      }

      .monitor-icon {
        font-size: 24px;
      }

      .monitor-header h4 {
        font-size: 16px;
        font-weight: 700;
        color: #1e293b;
        margin: 0;
      }

      .monitor-metrics {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .metric-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .metric-row span:first-child {
        font-size: 14px;
        font-weight: 500;
        color: #64748b;
        min-width: 80px;
      }

      .metric-bar {
        flex: 1;
        height: 8px;
        background: #e2e8f0;
        border-radius: 4px;
        position: relative;
        margin: 0 12px;
        overflow: hidden;
      }

      .metric-fill {
        height: 100%;
        background: linear-gradient(90deg, #3b82f6, #06b6d4);
        border-radius: 4px;
        transition: width 0.3s ease;
      }

      .metric-fill.good {
        background: linear-gradient(90deg, #10b981, #059669);
      }

      .metric-fill.excellent {
        background: linear-gradient(90deg, #059669, #047857);
      }

      .metric-value {
        font-size: 12px;
        font-weight: 600;
        color: #374151;
        min-width: 50px;
        text-align: right;
      }

      .security-indicators {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .security-item {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 14px;
        font-weight: 500;
      }

      .security-item.secure {
        color: #059669;
      }

      .security-icon {
        font-size: 16px;
      }

      /* Data Export Panel */
      .export-panel {
        background: white;
        border-radius: 16px;
        padding: 32px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid #f1f5f9;
      }

      .export-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        flex-wrap: wrap;
        gap: 20px;
      }

      .export-header h3 {
        font-size: 24px;
        font-weight: 700;
        color: #1e293b;
        margin: 0;
      }

      .export-quick-actions {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
      }

      .export-section {
        margin-bottom: 32px;
      }

      .export-section h4 {
        font-size: 18px;
        font-weight: 600;
        color: #374151;
        margin: 0 0 16px 0;
      }

      .report-builder {
        background: #f8fafc;
        border-radius: 12px;
        padding: 24px;
        border: 1px solid #e2e8f0;
      }

      .builder-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        align-items: end;
      }

      .builder-field {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .builder-field label {
        font-size: 14px;
        font-weight: 600;
        color: #374151;
      }

      .builder-field select {
        padding: 10px 12px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        background: white;
        font-size: 14px;
      }

      .builder-actions {
        display: flex;
        align-items: end;
      }

      /* Toggle Switch */
      .toggle-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
        margin-right: 8px;
      }

      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 24px;
      }

      .toggle-slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }

      input:checked + .toggle-slider {
        background-color: #3b82f6;
      }

      input:checked + .toggle-slider:before {
        transform: translateX(26px);
      }

      .metric-toggle {
        display: flex;
        align-items: center;
        font-size: 14px;
        color: #64748b;
      }

      /* Heatmap Legend */
      .heatmap-legend {
        display: flex;
        gap: 20px;
        align-items: center;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 12px;
        color: #64748b;
      }

      .legend-color {
        width: 12px;
        height: 12px;
        border-radius: 2px;
      }

      .legend-color.excellent {
        background: #10b981;
      }
      .legend-color.good {
        background: #f59e0b;
      }
      .legend-color.needs-attention {
        background: #ef4444;
      }

      /* Responsive Analytics */
      @media (max-width: 1200px) {
        .analytics-charts-grid {
          grid-template-columns: 1fr;
        }

        .chart-card.large,
        .chart-card.medium {
          grid-column: 1;
        }
      }

      @media (max-width: 768px) {
        .analytics-section {
          padding: 20px;
          margin: 20px 0;
        }

        .analytics-header {
          flex-direction: column;
          align-items: flex-start;
        }

        .kpi-overview-grid {
          grid-template-columns: 1fr;
          gap: 16px;
        }

        .monitoring-grid {
          grid-template-columns: 1fr;
        }

        .builder-row {
          grid-template-columns: 1fr;
        }

        .export-header {
          flex-direction: column;
          align-items: flex-start;
        }
      }

      /* Refresh Animation */
      .refresh-icon {
        display: inline-block;
        transition: transform 0.3s ease;
      }

      .refreshing .refresh-icon {
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      /* Export Animation */
      .export-icon {
        transition: transform 0.2s ease;
      }

      .exporting .export-icon {
        transform: scale(1.1);
      }

      /* Dynamic Metric Fills */
      .metric-45 {
        width: 45%;
      }
      .metric-62 {
        width: 62%;
      }
      .metric-28 {
        width: 28%;
      }
      .metric-15 {
        width: 15%;
      }
      .metric-85 {
        width: 85%;
      }
      .metric-99 {
        width: 99%;
      }

      /* Enhanced Admin Settings */
      .integration-settings {
        margin-bottom: 40px;
      }

      .integration-settings h3 {
        font-size: 20px;
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 20px;
        padding-bottom: 8px;
        border-bottom: 2px solid rgba(59, 130, 246, 0.2);
      }

      .integration-card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        border: 1px solid #e2e8f0;
      }

      .integration-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 1px solid #f1f5f9;
      }

      .integration-status {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        color: #374151;
      }

      .status-indicator {
        font-size: 12px;
      }

      .field-help {
        font-size: 12px;
        color: #6b7280;
        margin-top: 4px;
        display: block;
      }

      .integration-actions {
        display: flex;
        gap: 12px;
        margin-top: 24px;
        padding-top: 16px;
        border-top: 1px solid #f1f5f9;
      }

      .security-settings {
        margin-bottom: 40px;
      }

      .security-settings h3 {
        font-size: 20px;
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 20px;
        padding-bottom: 8px;
        border-bottom: 2px solid rgba(239, 68, 68, 0.2);
      }

      .security-card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        border: 1px solid #e2e8f0;
      }

      .security-section {
        margin-bottom: 32px;
      }

      .security-section:last-child {
        margin-bottom: 0;
      }

      .security-section h4 {
        font-size: 16px;
        font-weight: 600;
        color: #374151;
        margin-bottom: 16px;
      }

      .api-keys-list {
        background: #f8fafc;
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 16px;
      }

      .api-key-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid #e2e8f0;
      }

      .api-key-item:last-child {
        border-bottom: none;
      }

      .api-key-info {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .api-key-name {
        font-weight: 600;
        color: #374151;
      }

      .api-key-created {
        font-size: 12px;
        color: #6b7280;
      }

      .api-key-actions {
        display: flex;
        gap: 8px;
      }

      .btn-sm {
        padding: 6px 12px;
        font-size: 12px;
      }

      .access-controls {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .control-item {
        display: flex;
        align-items: center;
        gap: 16px;
        padding: 16px;
        background: #f8fafc;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
      }

      .control-info {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .control-label {
        font-weight: 600;
        color: #374151;
      }

      .control-desc {
        font-size: 12px;
        color: #6b7280;
      }

      /* Partner Management Styles */
      .partner-management {
        margin-bottom: 40px;
      }

      .partner-management h3 {
        font-size: 20px;
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 20px;
        padding-bottom: 8px;
        border-bottom: 2px solid rgba(16, 185, 129, 0.2);
      }

      .partner-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 24px;
      }

      .partner-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        border: 1px solid #e2e8f0;
        transition: all 0.3s ease;
      }

      .partner-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
      }

      .partner-card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 16px;
      }

      .partner-title {
        font-size: 18px;
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 4px;
      }

      .partner-type {
        font-size: 12px;
        color: #6b7280;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .partner-status-badge {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
      }

      .status-active {
        background: #d1fae5;
        color: #065f46;
      }

      .status-maintenance {
        background: #fef3c7;
        color: #92400e;
      }

      .status-offline {
        background: #fecaca;
        color: #991b1b;
      }

      .partner-details {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-bottom: 16px;
      }

      .partner-detail-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
      }

      .detail-label {
        color: #6b7280;
        font-weight: 500;
      }

      .detail-value {
        color: #374151;
        font-weight: 600;
      }

      .partner-actions {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      .security-key-section {
        background: #f8fafc;
        border-radius: 8px;
        padding: 16px;
        margin-top: 16px;
      }

      .security-keys {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .key-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 12px;
        background: white;
        border-radius: 6px;
        border: 1px solid #e2e8f0;
      }

      .key-info {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .key-icon {
        font-size: 16px;
      }

      .key-name {
        font-weight: 500;
        color: #374151;
      }

      .key-actions {
        display: flex;
        gap: 4px;
      }

      /* Add Partner Form */
      .add-partner-form {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        border: 1px solid #e2e8f0;
        margin-bottom: 24px;
      }

      .add-partner-form-hidden {
        display: none;
      }

      .form-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 16px;
        margin-bottom: 16px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .form-group label {
        font-weight: 600;
        color: #374151;
        font-size: 14px;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        padding: 10px 12px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 14px;
        transition: border-color 0.2s ease;
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      .form-actions {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        margin-top: 24px;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .integration-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 16px;
        }

        .integration-actions {
          flex-direction: column;
        }

        .api-key-item {
          flex-direction: column;
          align-items: flex-start;
          gap: 12px;
        }

        .api-key-actions {
          width: 100%;
          justify-content: flex-end;
        }

        .control-item {
          flex-direction: column;
          align-items: flex-start;
          gap: 12px;
        }

        .partner-grid {
          grid-template-columns: 1fr;
        }

        .form-row {
          grid-template-columns: 1fr;
        }
      }

      /* Training Videos Styles */
      .video-categories {
        display: flex;
        gap: 12px;
        margin-bottom: 32px;
        flex-wrap: wrap;
        border-bottom: 1px solid #e2e8f0;
        padding-bottom: 16px;
      }

      .category-btn {
        padding: 10px 20px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        background: white;
        color: #6b7280;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .category-btn:hover {
        background: #f8fafc;
        border-color: #9ca3af;
        color: #374151;
      }

      .category-btn.active {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border-color: var(--primary);
      }

      .video-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 24px;
        margin-top: 24px;
      }

      .video-card {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: var(--shadow-card);
        border: 1px solid #e2e8f0;
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .video-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-lg);
      }

      .video-thumbnail {
        position: relative;
        width: 100%;
        height: 180px;
        background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
      }

      .video-thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .video-thumbnail .placeholder-icon {
        font-size: 48px;
        color: #9ca3af;
      }

      .play-overlay {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 60px;
        height: 60px;
        background: rgba(0, 0, 0, 0.8);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 24px;
        transition: all 0.2s ease;
      }

      .video-card:hover .play-overlay {
        background: rgba(0, 0, 0, 0.9);
        transform: translate(-50%, -50%) scale(1.1);
      }

      .video-content {
        padding: 20px;
      }

      .video-title {
        font-size: 16px;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 8px;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .video-description {
        font-size: 14px;
        color: #6b7280;
        line-height: 1.5;
        margin-bottom: 16px;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .video-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 12px;
        color: #9ca3af;
      }

      .video-duration {
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-weight: 500;
      }

      .video-category {
        background: #f3f4f6;
        color: #6b7280;
        padding: 4px 8px;
        border-radius: 4px;
        font-weight: 500;
      }

      /* Video Modal Styles */
      .video-modal-content {
        max-width: 90vw;
        max-height: 90vh;
        width: auto;
      }

      .video-player-container {
        margin-bottom: 20px;
        border-radius: 8px;
        overflow: hidden;
      }

      .video-info {
        padding: 0 4px;
      }

      .video-info p {
        color: #6b7280;
        line-height: 1.6;
        margin-bottom: 16px;
      }

      .video-info .video-meta {
        display: flex;
        gap: 16px;
        align-items: center;
        font-size: 13px;
      }

      /* Empty State */
      .video-empty-state {
        text-align: center;
        padding: 80px 20px;
        color: #6b7280;
      }

      .video-empty-state .empty-icon {
        font-size: 64px;
        margin-bottom: 16px;
        opacity: 0.5;
      }

      .video-empty-state h3 {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 8px;
        color: #374151;
      }

      .video-empty-state p {
        font-size: 14px;
        line-height: 1.5;
      }

      /* Responsive Video Grid */
      @media (max-width: 768px) {
        .video-grid {
          grid-template-columns: 1fr;
          gap: 16px;
        }

        .video-categories {
          overflow-x: auto;
          padding-bottom: 20px;
          -ms-overflow-style: none;
        }

        .video-categories::-webkit-scrollbar {
          display: none;
        }

        .category-btn {
          white-space: nowrap;
          flex-shrink: 0;
        }

        .video-modal-content {
          margin: 20px;
          max-width: calc(100vw - 40px);
        }
      }
    </style>
  </head>
  <body>
    <!-- SVG Gradient Definitions -->
    <svg width="0" height="0" class="gradient-defs">
      <defs>
        <linearGradient id="ticketGradient" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" class="ticket-stop-1" />
          <stop offset="100%" class="ticket-stop-2" />
        </linearGradient>
        <linearGradient id="partnerGradient" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" class="partner-stop-1" />
          <stop offset="100%" class="partner-stop-2" />
        </linearGradient>
        <linearGradient id="resolutionGradient" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" class="resolution-stop-1" />
          <stop offset="100%" class="resolution-stop-2" />
        </linearGradient>
      </defs>
    </svg>

    <!-- Professional Header -->
    <header class="header">
      <div class="header-content">
        <button class="mobile-menu-btn" onclick="toggleSidebar()">
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
        </button>
        <div class="logo">
          <!-- Pool Safe Inc Company Logo - Official SVG -->
          <svg
            id="header-poolsafe-logo"
            class="logo-svg header-poolsafe-logo"
            viewBox="0 0 358.37 82.86"
            xmlns="http://www.w3.org/2000/svg"
            fill="#ffffff"
          >
            <g id="Layer_2" data-name="Layer 2">
              <g id="Layer_1-2" data-name="Layer 1">
                <path
                  d="M7.41,29.72H24.24c9.38,0,16,5.57,16,15.75,0,10.33-6.59,15.75-16,15.75H15.33v13H7.41ZM15.33,53.31H23.4c4.49,0,8.27-2.16,8.27-7.84s-3.78-7.84-8.27-7.84H15.33Z"
                />
                <path
                  d="M61,74.81c-14.2,0-22.32-10.18-22.32-22.61S46.8,29.59,61,29.59s22.32,10.18,22.32,22.61S75.2,74.81,61,74.81Zm0-37.31c-9.23,0-14.4,6.88-14.4,14.7s5.17,14.7,14.4,14.7,14.4-6.88,14.4-14.7S70.23,37.5,61,37.5Z"
                />
                <path
                  d="M109.35,74.81c-14.2,0-22.32-10.18-22.32-22.61S95.15,29.59,109.35,29.59s22.32,10.18,22.32,22.61S123.55,74.81,109.35,74.81Zm0-37.31c-9.23,0-14.4,6.88-14.4,14.7s5.17,14.7,14.4,14.7,14.4-6.88,14.4-14.7S118.58,37.5,109.35,37.5Z"
                />
                <path d="M135.48,30.27h7.92v36.88h23.61v6.07H135.48Z" />
                <path
                  d="M210.43,54.87c0,12-7.84,19.94-20.64,19.94s-20.64-7.92-20.64-19.94V44.88c0-12,7.84-19.94,20.64-19.94s20.64,7.92,20.64,19.94Zm-7.92-10c0-8.11-4.41-13-12.72-13s-12.72,4.86-12.72,13V54.87c0,8.11,4.41,13,12.72,13s12.72-4.86,12.72-13Z"
                />
                <path
                  d="M246.73,44c0-10.18,6.59-15.75,16-15.75H280.3v7.92H262.7c-4.49,0-8.27,2.16-8.27,7.84V46.6c0,5.68,3.78,7.84,8.27,7.84H280.3v7.92H262.7c-9.38,0-16-5.57-16-15.75Z"
                />
                <path d="M283.05,30.27H325v6.07H290.97v13H323v6.07H290.97v15.67H325v6.07H283.05Z" />
                <g>
                  <path
                    d="M336,7.92c4,0,7.2,3.24,7.2,7.2v52.62c0,4-3.24,7.2-7.2,7.2H22.41c-4,0-7.2-3.24-7.2-7.2V15.12c0-4,3.24-7.2,7.2-7.2H336m0-7.92H22.41C10.06,0,0,10.06,0,22.41V60.45C0,72.8,10.06,82.86,22.41,82.86H336c12.35,0,22.41-10.06,22.41-22.41V22.41C358.37,10.06,348.31,0,336,0Z"
                  />
                </g>
              </g>
            </g>
          </svg>
          <div class="logo-separator"></div>
          <!-- LounGenie Product Logo - Official SVG -->
          <svg
            class="logo-svg header-loungenie-logo"
            viewBox="0 0 348 101"
            xmlns="http://www.w3.org/2000/svg"
            xml:space="preserve"
            fill="url(#loungenieGradOfficial)"
          >
            <defs>
              <linearGradient id="loungenieGradOfficial" x1="0%" x2="100%" y1="0%" y2="0%">
                <stop offset="0%" stop-color="#00b5cc" />
                <stop offset="50%" stop-color="#52c7a3" />
                <stop offset="100%" stop-color="#f4a261" />
              </linearGradient>
            </defs>
            <path
              d="M0 67.9V0h8.5v59.3h20.3v8.6zM44.3 68.8c-8 0-13.9-5.5-13.9-14.2V20.8c0-8.7 5.9-14.2 13.9-14.2s13.9 5.5 13.9 14.2v33.8c0 8.7-5.9 14.2-13.9 14.2zm5.4-14.2V20.8c0-4.1-2.3-6.1-5.4-6.1s-5.4 2-5.4 6.1v33.8c0 4.1 2.3 6.1 5.4 6.1s5.4-2 5.4-6.1zM82 68.8c-7.5 0-13.5-5.4-13.5-14.2V20.8c0-8.7 6-14.2 13.5-14.2 7.8 0 13.4 5.5 13.4 14.2v13.4h-8.5V20.8c0-4.1-2.1-6.1-4.9-6.1s-5 2-5 6.1v33.8c0 4.1 2.2 6.1 5 6.1s4.9-2 4.9-6.1V46.8H82v-7.6h13.4v15.4c0 8.7-5.6 14.2-13.4 14.2zM119.1 68.8c-7.5 0-13.5-5.4-13.5-14.2V20.8c0-8.7 6-14.2 13.5-14.2 7.8 0 13.4 5.5 13.4 14.2v33.8c0 8.8-5.6 14.2-13.4 14.2zm4.9-14.2V20.8c0-4.1-2.1-6.1-4.9-6.1s-5 2-5 6.1v33.8c0 4.1 2.2 6.1 5 6.1s4.9-2 4.9-6.1zM171.4 67.9V15.5h-14.8v-8h38.2v8h-14.8v52.4zM207.5 68.8c-7.5 0-13.5-5.4-13.5-14.2V20.8c0-8.7 6-14.2 13.5-14.2 7.8 0 13.4 5.5 13.4 14.2v33.8c0 8.8-5.6 14.2-13.4 14.2zm4.9-14.2V20.8c0-4.1-2.1-6.1-4.9-6.1s-5 2-5 6.1v33.8c0 4.1 2.2 6.1 5 6.1s4.9-2 4.9-6.1zM256.4 68.8c-8 0-13.9-5.5-13.9-14.2V20.8c0-8.7 5.9-14.2 13.9-14.2s13.9 5.5 13.9 14.2v33.8c0 8.7-5.9 14.2-13.9 14.2zm5.4-14.2V20.8c0-4.1-2.3-6.1-5.4-6.1s-5.4 2-5.4 6.1v33.8c0 4.1 2.3 6.1 5.4 6.1s5.4-2 5.4-6.1zM295.7 68.8c-7.5 0-13.5-5.4-13.5-14.2V20.8c0-8.7 6-14.2 13.5-14.2 7.8 0 13.4 5.5 13.4 14.2v13.4h-8.5V20.8c0-4.1-2.1-6.1-4.9-6.1s-5 2-5 6.1v33.8c0 4.1 2.2 6.1 5 6.1s4.9-2 4.9-6.1V46.8h-4.9v-7.6h13.4v15.4c0 8.7-5.6 14.2-13.4 14.2zM323.8 67.9V7.5h22.1v8h-13.6v17.8h12.3v8h-12.3v18h13.6v8.6zM8.2 100.5V84.8h1.4v14.2h3.4v1.5zM22.2 100.5L18.4 91l-3.8 9.5h-1.6l4.5-10.9c.3-.7.6-1.3.6-2.1 0-.8-.3-1.4-.6-2.1l-4.5-10.9h1.6L18.4 85l3.8-9.5h1.6l-4.5 10.9c-.3.7-.6 1.3-.6 2.1 0 .8.3 1.4.6 2.1l4.5 10.9zM25.2 100.5V84.8h1.4v14.2h3.4v1.5zM38.6 100.7c-1.1 0-1.9-.8-1.9-2V87.5c0-1.2.8-2 1.9-2s1.9.8 1.9 2v11.2c0 1.2-.8 2-1.9 2zm.5-2V87.5c0-.4-.2-.6-.5-.6s-.5.2-.5.6v11.2c0 .4.2.6.5.6s.5-.2.5-.6zM50.5 100.5l-2.1-5.6c-.1-.3-.2-.4-.4-.4h-.7v6h-1.4V84.8h2.8c1.6 0 2.5.9 2.5 2.4v2.8c0 1-.4 1.7-1 2l2.2 5.8v2.7zm-3.2-7.4h1.3c.6 0 1.1-.4 1.1-1.1v-2.8c0-.7-.5-1.1-1.1-1.1h-1.3v5zM60.3 100.7c-1.1 0-1.9-.8-1.9-2V87.5c0-1.2.8-2 1.9-2 1.2 0 2 .8 2 2v4.8h-1.4v-4.8c0-.4-.3-.6-.6-.6s-.6.2-.6.6v11.2c0 .4.3.6.6.6s.6-.2.6-.6V94h-.6v-1.3h2v5.5c0 1.2-.8 2-2 2zM72.7 100.5V84.8h3.7v1.4h-2.3v4.7h2.1v1.3h-2.1v4.8h2.3v1.5zM84.9 100.5l-2.1-5.6c-.1-.3-.2-.4-.4-.4h-.7v6h-1.4V84.8H83c1.6 0 2.5.9 2.5 2.4v2.8c0 1-.4 1.7-1 2l2.2 5.8v2.7zm-3.2-7.4h1.3c.6 0 1.1-.4 1.1-1.1v-2.8c0-.7-.5-1.1-1.1-1.1h-1.3v5zM101.5 100.5V84.8h3.7v1.4h-2.3v4.7h2.1v1.3h-2.1v4.8h2.3v1.5zM114 100.7c-1.1 0-1.9-.8-1.9-2V87.5c0-1.2.8-2 1.9-2 1.2 0 2 .8 2 2v11.2c0 1.2-.8 2-2 2zm.5-2V87.5c0-.4-.3-.6-.5-.6s-.6.2-.6.6v11.2c0 .4.3.6.6.6s.5-.2.5-.6zM125.8 100.7c-1.1 0-1.9-.8-1.9-2V87.5c0-1.2.8-2 1.9-2 1.2 0 2 .8 2 2v4.8h-1.4v-4.8c0-.4-.3-.6-.6-.6s-.6.2-.6.6v11.2c0 .4.3.6.6.6s.6-.2.6-.6V94h-.6v-1.3h2v5.5c0 1.2-.8 2-2 2zM142.1 100.5V84.8h1.4v14.2h3.4v1.5zM148.8 100.5V84.8h1.4v15.7zM160.8 100.7c-1.1 0-1.9-.8-1.9-2V87.5c0-1.2.8-2 1.9-2 1.2 0 2 .8 2 2v11.2c0 1.2-.8 2-2 2zm.5-2V87.5c0-.4-.3-.6-.5-.6s-.6.2-.6.6v11.2c0 .4.3.6.6.6s.5-.2.5-.6zM171.8 100.5V84.8h1.4v15.7zM176.3 100.5V84.8h1.4v14.2h3.4v1.5zM189.7 100.5V84.8h1.4v14.2h3.4v1.5zM203.8 100.7c-1.1 0-1.9-.8-1.9-2V87.5c0-1.2.8-2 1.9-2 1.2 0 2 .8 2 2v11.2c0 1.2-.8 2-2 2zm.5-2V87.5c0-.4-.3-.6-.5-.6s-.6.2-.6.6v11.2c0 .4.3.6.6.6s.5-.2.5-.6zM214.7 100.7c-1.1 0-1.9-.8-1.9-2V87.5c0-1.2.8-2 1.9-2 1.2 0 2 .8 2 2v4.8h-1.4v-4.8c0-.4-.3-.6-.6-.6s-.6.2-.6.6v11.2c0 .4.3.6.6.6s.6-.2.6-.6V94h-.6v-1.3h2v5.5c0 1.2-.8 2-2 2zM224.4 100.5V92c0-.4-.3-.6-.6-.6s-.6.2-.6.6v8.5h-1.4V87.5c0-1.2.8-2 1.9-2 1.2 0 2 .8 2 2v13zM234.3 100.5v-6.7l-1.1 5.5c-.1.4-.2.6-.5.6s-.4-.2-.5-.6l-1.1-5.5v6.7h-1.4V84.8h1.9l1.1 6.6 1.1-6.6h1.9v15.7zM244.4 100.5v-6.7l-1.1 5.5c-.1.4-.2.6-.5.6s-.4-.2-.5-.6l-1.1-5.5v6.7h-1.4V84.8h1.9l1.1 6.6 1.1-6.6h1.9v15.7zM254.5 100.5v-6.7l-1.1 5.5c-.1.4-.2.6-.5.6s-.4-.2-.5-.6l-1.1-5.5v6.7h-1.4V84.8h1.9l1.1 6.6 1.1-6.6h1.9v15.7zM264.5 100.5v-6.7l-1.1 5.5c-.1.4-.2.6-.5.6s-.4-.2-.5-.6l-1.1-5.5v6.7H260V84.8h1.9l1.1 6.6 1.1-6.6h1.9v15.7zM267.5 100.5V84.8h3.7v1.4h-2.3v4.7h2.1v1.3h-2.1v4.8h2.3v1.5zM280 100.7c-1.1 0-1.9-.8-1.9-2V87.5c0-1.2.8-2 1.9-2 1.2 0 2 .8 2 2v4.8h-1.4v-4.8c0-.4-.3-.6-.6-.6s-.6.2-.6.6v11.2c0 .4.3.6.6.6s.6-.2.6-.6V94h-.6v-1.3h2v5.5c0 1.2-.8 2-2 2zM291 100.5V92c0-.4-.3-.6-.6-.6s-.6.2-.6.6v8.5h-1.4V87.5c0-1.2.8-2 1.9-2 1.2 0 2 .8 2 2v13zM300.9 100.5l-2.1-5.6c-.1-.3-.2-.4-.4-.4h-.7v6h-1.4V84.8h2.8c1.6 0 2.5.9 2.5 2.4v2.8c0 1-.4 1.7-1 2l2.2 5.8v2.7zm-3.2-7.4h1.3c.6 0 1.1-.4 1.1-1.1v-2.8c0-.7-.5-1.1-1.1-1.1h-1.3v5zM310.7 100.7c-1.1 0-1.9-.8-1.9-2V87.5c0-1.2.8-2 1.9-2 1.2 0 2 .8 2 2v4.8h-1.4v-4.8c0-.4-.3-.6-.6-.6s-.6.2-.6.6v11.2c0 .4.3.6.6.6s.6-.2.6-.6V94h-.6v-1.3h2v5.5c0 1.2-.8 2-2 2zM321.6 100.5V92c0-.4-.3-.6-.6-.6s-.6.2-.6.6v8.5h-1.4V87.5c0-1.2.8-2 1.9-2 1.2 0 2 .8 2 2v13zM331.5 100.5v-6.7l-1.1 5.5c-.1.4-.2.6-.5.6s-.4-.2-.5-.6l-1.1-5.5v6.7h-1.4V84.8h1.9l1.1 6.6 1.1-6.6h1.9v15.7zM341.6 100.5v-6.7l-1.1 5.5c-.1.4-.2.6-.5.6s-.4-.2-.5-.6l-1.1-5.5v6.7h-1.4V84.8h1.9l1.1 6.6 1.1-6.6h1.9v15.7z"
            />
          </svg>
          <span class="header-portal-text">Support Portal</span>
        </div>

        <!-- Global Search Bar -->
        <div class="search-container">
          <div class="search-input-wrapper">
            <input
              type="text"
              id="globalSearch"
              class="search-input"
              placeholder="Search tickets, partners, content..."
              maxlength="100"
            />
            <button class="search-button" onclick="performSearch()" title="Search">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
              </svg>
            </button>
          </div>
          <div id="searchResults" class="search-results search-results-hidden"></div>
        </div>

        <!-- Notification Center -->
        <div class="notification-center">
          <button class="notification-button" onclick="toggleNotifications()" title="Notifications">
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
              <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
            </svg>
            <span class="notification-badge" id="notificationBadge">3</span>
          </button>

          <div class="notification-panel notification-panel-hidden" id="notificationPanel">
            <div class="notification-header">
              <h3>Notifications</h3>
              <button class="clear-all-btn" onclick="clearAllNotifications()">Clear All</button>
            </div>
            <div class="notification-list" id="notificationList">
              <!-- Notifications will be populated by JavaScript -->
            </div>
          </div>
        </div>

        <div class="user-menu user-menu-visible" id="userMenu">
          <span id="userName">Pool Safe Admin</span>
          <div class="user-avatar">PA</div>
        </div>
      </div>
    </header>

    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-brand">
          <div class="nav-icon"></div>
          <h3>Portal</h3>
        </div>
        <button
          class="sidebar-toggle"
          onclick="toggleSidebarCollapse()"
          title="Toggle sidebar collapse"
        >
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M18 6L6 18M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <nav class="sidebar-nav">
        <!-- Main Navigation -->
        <div class="nav-section">
          <h4 class="nav-section-title">Main</h4>
          <ul class="nav-list">
            <li class="nav-item">
              <a class="nav-link active" onclick="showDashboard()">
                <div class="nav-icon"></div>
                <span class="nav-text">Dashboard</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" onclick="showAnalytics()">
                <div class="nav-icon"></div>
                <span class="nav-text">Analytics</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" onclick="showPartnerMap()">
                <div class="nav-icon"></div>
                <span class="nav-text">Partner Map</span>
              </a>
            </li>
          </ul>
        </div>

        <!-- Management -->
        <div class="nav-section">
          <h4 class="nav-section-title">Management</h4>
          <ul class="nav-list">
            <li class="nav-item">
              <a class="nav-link" onclick="showPartnerManagement()">
                <div class="nav-icon"></div>
                <span class="nav-text">Partners</span>
                <span class="nav-badge">89</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" onclick="showTickets()">
                <div class="nav-icon"></div>
                <span class="nav-text">Tickets</span>
                <span class="nav-badge">12</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" onclick="showReports()">
                <div class="nav-icon"></div>
                <span class="nav-text">Reports</span>
              </a>
            </li>
          </ul>
        </div>

        <!-- Administration -->
        <div class="nav-section">
          <h4 class="nav-section-title">Administration</h4>
          <ul class="nav-list">
            <li class="nav-item">
              <a class="nav-link" onclick="showAdminSettings()">
                <div class="nav-icon"></div>
                <span class="nav-text">Settings</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" onclick="showUserManagement()">
                <div class="nav-icon"></div>
                <span class="nav-text">Users</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" onclick="showSecuritySettings()">
                <div class="nav-icon"></div>
                <span class="nav-text">Security</span>
              </a>
            </li>
          </ul>
        </div>

        <!-- Support -->
        <div class="nav-section">
          <h4 class="nav-section-title">Support</h4>
          <ul class="nav-list">
            <li class="nav-item">
              <a class="nav-link" onclick="showHelpCenter()">
                <div class="nav-icon"></div>
                <span class="nav-text">Help Center</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" onclick="showVideos()">
                <div class="nav-icon"></div>
                <span class="nav-text">Training Videos</span>
                <span class="nav-badge" id="videoCount">15</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" onclick="showDocumentation()">
                <div class="nav-icon"></div>
                <span class="nav-text">Documentation</span>
              </a>
            </li>
          </ul>
        </div>
      </nav>

      <!-- Sidebar User Info -->
      <div class="sidebar-user">
        <div class="user-info">
          <div class="user-info-avatar">PA</div>
          <div class="user-info-details">
            <p class="user-info-name">Pool Safe Admin</p>
            <p class="user-info-role">Administrator</p>
          </div>
        </div>
      </div>
    </aside>

    <div class="container">
      <!-- Main Content Area -->
      <div class="main-content" id="mainContent">
        <!-- Login Selection -->
        <div class="login-container login-container-hidden" id="loginContainer">
          <div class="login-header">
            <!-- Company and Product Logos -->
            <div class="login-logo-container">
              <!-- Pool Safe Inc Company Logo - Official SVG -->
              <svg
                id="login-poolsafe-logo"
                class="login-poolsafe-logo"
                viewBox="0 0 358.37 82.86"
                xmlns="http://www.w3.org/2000/svg"
                fill="#1a2e4b"
              >
                <g id="Layer_2" data-name="Layer 2">
                  <g id="Layer_1-2" data-name="Layer 1">
                    <path
                      d="M7.41,29.72H24.24c9.38,0,16,5.57,16,15.75,0,10.33-6.59,15.75-16,15.75H15.33v13H7.41ZM15.33,53.31H23.4c4.49,0,8.27-2.16,8.27-7.84s-3.78-7.84-8.27-7.84H15.33Z"
                    />
                    <path
                      d="M61,74.81c-14.2,0-22.32-10.18-22.32-22.61S46.8,29.59,61,29.59s22.32,10.18,22.32,22.61S75.2,74.81,61,74.81Zm0-37.31c-9.23,0-14.4,6.88-14.4,14.7s5.17,14.7,14.4,14.7,14.4-6.88,14.4-14.7S70.23,37.5,61,37.5Z"
                    />
                    <path
                      d="M109.35,74.81c-14.2,0-22.32-10.18-22.32-22.61S95.15,29.59,109.35,29.59s22.32,10.18,22.32,22.61S123.55,74.81,109.35,74.81Zm0-37.31c-9.23,0-14.4,6.88-14.4,14.7s5.17,14.7,14.4,14.7,14.4-6.88,14.4-14.7S118.58,37.5,109.35,37.5Z"
                    />
                    <path d="M135.48,30.27h7.92v36.88h23.61v6.07H135.48Z" />
                    <path
                      d="M210.43,54.87c0,12-7.84,19.94-20.64,19.94s-20.64-7.92-20.64-19.94V44.88c0-12,7.84-19.94,20.64-19.94s20.64,7.92,20.64,19.94Zm-7.92-10c0-8.11-4.41-13-12.72-13s-12.72,4.86-12.72,13V54.87c0,8.11,4.41,13,12.72,13s12.72-4.86,12.72-13Z"
                    />
                    <path
                      d="M246.73,44c0-10.18,6.59-15.75,16-15.75H280.3v7.92H262.7c-4.49,0-8.27,2.16-8.27,7.84V46.6c0,5.68,3.78,7.84,8.27,7.84H280.3v7.92H262.7c-9.38,0-16-5.57-16-15.75Z"
                    />
                    <path
                      d="M283.05,30.27H325v6.07H290.97v13H323v6.07H290.97v15.67H325v6.07H283.05Z"
                    />
                    <g>
                      <path
                        d="M336,7.92c4,0,7.2,3.24,7.2,7.2v52.62c0,4-3.24,7.2-7.2,7.2H22.41c-4,0-7.2-3.24-7.2-7.2V15.12c0-4,3.24-7.2,7.2-7.2H336m0-7.92H22.41C10.06,0,0,10.06,0,22.41V60.45C0,72.8,10.06,82.86,22.41,82.86H336c12.35,0,22.41-10.06,22.41-22.41V22.41C358.37,10.06,348.31,0,336,0Z"
                      />
                    </g>
                  </g>
                </g>
              </svg>
              <!-- Separator -->
              <div class="login-separator"></div>
              <!-- LounGenie Product Logo - Official SVG -->
              <svg
                class="login-loungenie-logo"
                viewBox="0 0 348 101"
                xmlns="http://www.w3.org/2000/svg"
                xml:space="preserve"
              >
                <defs>
                  <linearGradient id="loginLoungenieGradOfficial" x1="0%" x2="100%" y1="0%" y2="0%">
                    <stop offset="0%" class="gradient-stop-start" />
                    <stop offset="50%" class="gradient-stop-middle" />
                    <stop offset="100%" class="gradient-stop-end" />
                  </linearGradient>
                </defs>
                <path
                  class="login-loungenie-path"
                  d="M0 67.9V0h8.5v59.3h20.3v8.6zM44.3 68.8c-8 0-13.9-5.5-13.9-14.2V20.8c0-8.7 5.9-14.2 13.9-14.2s13.9 5.5 13.9 14.2v33.8c0 8.7-5.9 14.2-13.9 14.2zm5.4-14.2V20.8c0-4.1-2.3-6.1-5.4-6.1s-5.4 2-5.4 6.1v33.8c0 4.1 2.3 6.1 5.4 6.1s5.4-2 5.4-6.1zM82 68.8c-7.5 0-13.5-5.4-13.5-14.2V20.8c0-8.7 6-14.2 13.5-14.2 7.8 0 13.4 5.5 13.4 14.2v13.4h-8.5V20.8c0-4.1-2.1-6.1-4.9-6.1s-5 2-5 6.1v33.8c0 4.1 2.2 6.1 5 6.1s4.9-2 4.9-6.1V46.8H82v-7.6h13.4v15.4c0 8.7-5.6 14.2-13.4 14.2zM119.1 68.8c-7.5 0-13.5-5.4-13.5-14.2V20.8c0-8.7 6-14.2 13.5-14.2 7.8 0 13.4 5.5 13.4 14.2v33.8c0 8.8-5.6 14.2-13.4 14.2zm4.9-14.2V20.8c0-4.1-2.1-6.1-4.9-6.1s-5 2-5 6.1v33.8c0 4.1 2.2 6.1 5 6.1s4.9-2 4.9-6.1zM171.4 67.9V15.5h-14.8v-8h38.2v8h-14.8v52.4zM207.5 68.8c-7.5 0-13.5-5.4-13.5-14.2V20.8c0-8.7 6-14.2 13.5-14.2 7.8 0 13.4 5.5 13.4 14.2v33.8c0 8.8-5.6 14.2-13.4 14.2zm4.9-14.2V20.8c0-4.1-2.1-6.1-4.9-6.1s-5 2-5 6.1v33.8c0 4.1 2.2 6.1 5 6.1s4.9-2 4.9-6.1zM256.4 68.8c-8 0-13.9-5.5-13.9-14.2V20.8c0-8.7 5.9-14.2 13.9-14.2s13.9 5.5 13.9 14.2v33.8c0 8.7-5.9 14.2-13.9 14.2zm5.4-14.2V20.8c0-4.1-2.3-6.1-5.4-6.1s-5.4 2-5.4 6.1v33.8c0 4.1 2.3 6.1 5.4 6.1s5.4-2 5.4-6.1zM295.7 68.8c-7.5 0-13.5-5.4-13.5-14.2V20.8c0-8.7 6-14.2 13.5-14.2 7.8 0 13.4 5.5 13.4 14.2v13.4h-8.5V20.8c0-4.1-2.1-6.1-4.9-6.1s-5 2-5 6.1v33.8c0 4.1 2.2 6.1 5 6.1s4.9-2 4.9-6.1V46.8h-4.9v-7.6h13.4v15.4c0 8.7-5.6 14.2-13.4 14.2zM323.8 67.9V7.5h22.1v8h-13.6v17.8h12.3v8h-12.3v18h13.6v8.6zM8.2 100.5V84.8h1.4v14.2h3.4v1.5zM22.2 100.5L18.4 91l-3.8 9.5h-1.6l4.5-10.9c.3-.7.6-1.3.6-2.1 0-.8-.3-1.4-.6-2.1l-4.5-10.9h1.6L18.4 85l3.8-9.5h1.6l-4.5 10.9c-.3.7-.6 1.3-.6 2.1 0 .8.3 1.4.6 2.1l4.5 10.9zM25.2 100.5V84.8h1.4v14.2h3.4v1.5zM38.6 100.7c-1.1 0-1.9-.8-1.9-2V87.5c0-1.2.8-2 1.9-2s1.9.8 1.9 2v11.2c0 1.2-.8 2-1.9 2zm.5-2V87.5c0-.4-.2-.6-.5-.6s-.5.2-.5.6v11.2c0 .4.2.6.5.6s.5-.2.5-.6zM50.5 100.5l-2.1-5.6c-.1-.3-.2-.4-.4-.4h-.7v6h-1.4V84.8h2.8c1.6 0 2.5.9 2.5 2.4v2.8c0 1-.4 1.7-1 2l2.2 5.8v2.7zm-3.2-7.4h1.3c.6 0 1.1-.4 1.1-1.1v-2.8c0-.7-.5-1.1-1.1-1.1h-1.3v5zM60.3 100.7c-1.1 0-1.9-.8-1.9-2V87.5c0-1.2.8-2 1.9-2 1.2 0 2 .8 2 2v4.8h-1.4v-4.8c0-.4-.3-.6-.6-.6s-.6.2-.6.6v11.2c0 .4.3.6.6.6s.6-.2.6-.6V94h-.6v-1.3h2v5.5c0 1.2-.8 2-2 2zM72.7 100.5V84.8h3.7v1.4h-2.3v4.7h2.1v1.3h-2.1v4.8h2.3v1.5zM84.9 100.5l-2.1-5.6c-.1-.3-.2-.4-.4-.4h-.7v6h-1.4V84.8H83c1.6 0 2.5.9 2.5 2.4v2.8c0 1-.4 1.7-1 2l2.2 5.8v2.7zm-3.2-7.4h1.3c.6 0 1.1-.4 1.1-1.1v-2.8c0-.7-.5-1.1-1.1-1.1h-1.3v5zM101.5 100.5V84.8h3.7v1.4h-2.3v4.7h2.1v1.3h-2.1v4.8h2.3v1.5zM114 100.7c-1.1 0-1.9-.8-1.9-2V87.5c0-1.2.8-2 1.9-2 1.2 0 2 .8 2 2v11.2c0 1.2-.8 2-2 2zm.5-2V87.5c0-.4-.3-.6-.5-.6s-.6.2-.6.6v11.2c0 .4.3.6.6.6s.5-.2.5-.6zM125.8 100.7c-1.1 0-1.9-.8-1.9-2V87.5c0-1.2.8-2 1.9-2 1.2 0 2 .8 2 2v4.8h-1.4v-4.8c0-.4-.3-.6-.6-.6s-.6.2-.6.6v11.2c0 .4.3.6.6.6s.6-.2.6-.6V94h-.6v-1.3h2v5.5c0 1.2-.8 2-2 2zM142.1 100.5V84.8h1.4v14.2h3.4v1.5zM148.8 100.5V84.8h1.4v15.7zM160.8 100.7c-1.1 0-1.9-.8-1.9-2V87.5c0-1.2.8-2 1.9-2 1.2 0 2 .8 2 2v11.2c0 1.2-.8 2-2 2zm.5-2V87.5c0-.4-.3-.6-.5-.6s-.6.2-.6.6v11.2c0 .4.3.6.6.6s.5-.2.5-.6zM171.8 100.5V84.8h1.4v15.7zM176.3 100.5V84.8h1.4v14.2h3.4v1.5zM189.7 100.5V84.8h1.4v14.2h3.4v1.5zM203.8 100.7c-1.1 0-1.9-.8-1.9-2V87.5c0-1.2.8-2 1.9-2 1.2 0 2 .8 2 2v11.2c0 1.2-.8 2-2 2zm.5-2V87.5c0-.4-.3-.6-.5-.6s-.6.2-.6.6v11.2c0 .4.3.6.6.6s.5-.2.5-.6zM214.7 100.7c-1.1 0-1.9-.8-1.9-2V87.5c0-1.2.8-2 1.9-2 1.2 0 2 .8 2 2v4.8h-1.4v-4.8c0-.4-.3-.6-.6-.6s-.6.2-.6.6v11.2c0 .4.3.6.6.6s.6-.2.6-.6V94h-.6v-1.3h2v5.5c0 1.2-.8 2-2 2zM224.4 100.5V92c0-.4-.3-.6-.6-.6s-.6.2-.6.6v8.5h-1.4V87.5c0-1.2.8-2 1.9-2 1.2 0 2 .8 2 2v13zM234.3 100.5v-6.7l-1.1 5.5c-.1.4-.2.6-.5.6s-.4-.2-.5-.6l-1.1-5.5v6.7h-1.4V84.8h1.9l1.1 6.6 1.1-6.6h1.9v15.7zM244.4 100.5v-6.7l-1.1 5.5c-.1.4-.2.6-.5.6s-.4-.2-.5-.6l-1.1-5.5v6.7h-1.4V84.8h1.9l1.1 6.6 1.1-6.6h1.9v15.7zM254.5 100.5v-6.7l-1.1 5.5c-.1.4-.2.6-.5.6s-.4-.2-.5-.6l-1.1-5.5v6.7h-1.4V84.8h1.9l1.1 6.6 1.1-6.6h1.9v15.7zM264.5 100.5v-6.7l-1.1 5.5c-.1.4-.2.6-.5.6s-.4-.2-.5-.6l-1.1-5.5v6.7H260V84.8h1.9l1.1 6.6 1.1-6.6h1.9v15.7zM267.5 100.5V84.8h3.7v1.4h-2.3v4.7h2.1v1.3h-2.1v4.8h2.3v1.5zM280 100.7c-1.1 0-1.9-.8-1.9-2V87.5c0-1.2.8-2 1.9-2 1.2 0 2 .8 2 2v4.8h-1.4v-4.8c0-.4-.3-.6-.6-.6s-.6.2-.6.6v11.2c0 .4.3.6.6.6s.6-.2.6-.6V94h-.6v-1.3h2v5.5c0 1.2-.8 2-2 2zM291 100.5V92c0-.4-.3-.6-.6-.6s-.6.2-.6.6v8.5h-1.4V87.5c0-1.2.8-2 1.9-2 1.2 0 2 .8 2 2v13zM300.9 100.5l-2.1-5.6c-.1-.3-.2-.4-.4-.4h-.7v6h-1.4V84.8h2.8c1.6 0 2.5.9 2.5 2.4v2.8c0 1-.4 1.7-1 2l2.2 5.8v2.7zm-3.2-7.4h1.3c.6 0 1.1-.4 1.1-1.1v-2.8c0-.7-.5-1.1-1.1-1.1h-1.3v5zM310.7 100.7c-1.1 0-1.9-.8-1.9-2V87.5c0-1.2.8-2 1.9-2 1.2 0 2 .8 2 2v4.8h-1.4v-4.8c0-.4-.3-.6-.6-.6s-.6.2-.6.6v11.2c0 .4.3.6.6.6s.6-.2.6-.6V94h-.6v-1.3h2v5.5c0 1.2-.8 2-2 2zM321.6 100.5V92c0-.4-.3-.6-.6-.6s-.6.2-.6.6v8.5h-1.4V87.5c0-1.2.8-2 1.9-2 1.2 0 2 .8 2 2v13zM331.5 100.5v-6.7l-1.1 5.5c-.1.4-.2.6-.5.6s-.4-.2-.5-.6l-1.1-5.5v6.7h-1.4V84.8h1.9l1.1 6.6 1.1-6.6h1.9v15.7zM341.6 100.5v-6.7l-1.1 5.5c-.1.4-.2.6-.5.6s-.4-.2-.5-.6l-1.1-5.5v6.7h-1.4V84.8h1.9l1.1 6.6 1.1-6.6h1.9v15.7z"
                />
              </svg>
            </div>
            <h1 class="login-title">Support Portal</h1>
            <p class="login-subtitle">
              Secure access to your professional B2B support platform.<br />Choose your login method
              below.
            </p>
          </div>

          <div class="role-cards">
            <div class="role-card" onclick="selectRole('partner')">
              <div class="role-header">
                <div class="role-icon"></div>
                <div class="role-title">Partner Access</div>
              </div>
              <div class="role-description">
                Company account for resorts, hotels, and waterparks. Submit tickets, view status,
                access training materials.
              </div>
            </div>

            <div class="role-card" onclick="selectRole('support')">
              <div class="role-header">
                <div class="role-icon"></div>
                <div class="role-title">Support Team</div>
              </div>
              <div class="role-description">
                Support staff access via Outlook SSO. Manage tickets, track service, update
                calendars, assist partners.
              </div>
            </div>

            <div class="role-card" onclick="selectRole('admin')">
              <div class="role-header">
                <div class="role-icon"></div>
                <div class="role-title">Administrator</div>
              </div>
              <div class="role-description">
                Full administrative control. Partner management, analytics, secure access, HubSpot
                integration.
              </div>
            </div>
          </div>

          <!-- Partner Login -->
          <div class="auth-section" id="partnerAuth">
            <div class="form-group">
              <label class="form-label">Company Username</label>
              <input type="text" class="form-input" placeholder="Enter company username" />
            </div>
            <div class="form-group">
              <label class="form-label">Password</label>
              <input type="password" class="form-input" placeholder="Enter password" />
            </div>
            <button class="btn btn-primary btn-full-width" onclick="login('partner')">
              Sign In as Partner
            </button>
          </div>

          <!-- Support/Admin Login -->
          <div class="auth-section" id="staffAuth">
            <div class="form-group">
              <label class="form-label">Email</label>
              <input
                type="email"
                class="form-input"
                placeholder="support@poolsafeinc.com"
                value="support@poolsafeinc.com"
              />
            </div>
            <div class="form-group">
              <label class="form-label">Password</label>
              <input
                type="password"
                class="form-input"
                placeholder="Enter password"
                value="LounGenie123!!"
              />
            </div>
            <button class="btn btn-primary btn-full-width-spaced" onclick="login('staff')">
              Sign In with Credentials
            </button>
            <button class="btn btn-secondary btn-full-width" onclick="loginWithOutlook()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" class="outlook-icon">
                <path
                  d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"
                  fill="currentColor"
                />
              </svg>
              Sign In with Outlook
            </button>
          </div>
        </div>

        <!-- Partner Dashboard -->
        <div class="dashboard" id="partnerDashboard">
          <div class="dashboard-header">
            <h1 class="dashboard-title">Partner Dashboard</h1>
            <p class="dashboard-subtitle">
              Comfort Solutions Inc  24 LounGenie Units  Classic Blue
            </p>
          </div>

          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon"></div>
                <div class="stat-label">Open Tickets</div>
              </div>
              <div class="stat-value">8</div>
              <div class="stat-change">2 new this week</div>
            </div>

            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon"></div>
                <div class="stat-label">Avg Response</div>
              </div>
              <div class="stat-value">1.2h</div>
              <div class="stat-change">Within SLA</div>
            </div>

            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon"></div>
                <div class="stat-label">Resolved</div>
              </div>
              <div class="stat-value">42</div>
              <div class="stat-change">This month</div>
            </div>

            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon"></div>
                <div class="stat-label">Satisfaction</div>
              </div>
              <div class="stat-value">4.9</div>
              <div class="stat-change">Out of 5.0</div>
            </div>
          </div>

          <!-- Comprehensive Analytics Dashboard Section -->
          <div class="analytics-section">
            <div class="analytics-header">
              <div class="analytics-title-wrapper">
                <h2 class="analytics-title"> Comprehensive Analytics Dashboard</h2>
                <p class="analytics-subtitle">Real-time insights and performance metrics</p>
              </div>
              <div class="analytics-controls">
                <select class="analytics-filter" id="timeRangeFilter">
                  <option value="7d">Last 7 Days</option>
                  <option value="30d" selected>Last 30 Days</option>
                  <option value="90d">Last 90 Days</option>
                  <option value="1y">Last Year</option>
                </select>
                <button class="btn btn-primary" onclick="refreshAnalytics()">
                  <span class="refresh-icon"></span>
                  Refresh Data
                </button>
                <button class="btn btn-secondary" onclick="exportAnalytics()">
                  <span class="export-icon"></span>
                  Export Report
                </button>
              </div>
            </div>

            <!-- KPI Overview Grid -->
            <div class="kpi-overview-grid">
              <div class="kpi-card primary">
                <div class="kpi-header">
                  <div class="kpi-icon gradient-blue"></div>
                  <div class="kpi-details">
                    <h4>Ticket Volume</h4>
                    <div class="kpi-value" id="ticketVolume">324</div>
                    <div class="kpi-change positive">+12% vs last month</div>
                  </div>
                </div>
                <div class="kpi-chart">
                  <canvas id="ticketVolumeChart" width="100" height="40"></canvas>
                </div>
              </div>

              <div class="kpi-card success">
                <div class="kpi-header">
                  <div class="kpi-icon gradient-green"></div>
                  <div class="kpi-details">
                    <h4>Avg Response Time</h4>
                    <div class="kpi-value" id="avgResponseTime">1.2h</div>
                    <div class="kpi-change positive">-8% faster</div>
                  </div>
                </div>
                <div class="kpi-chart">
                  <canvas id="responseTimeChart" width="100" height="40"></canvas>
                </div>
              </div>

              <div class="kpi-card warning">
                <div class="kpi-header">
                  <div class="kpi-icon gradient-orange"></div>
                  <div class="kpi-details">
                    <h4>Resolution Rate</h4>
                    <div class="kpi-value" id="resolutionRate">94.2%</div>
                    <div class="kpi-change positive">+3.1% improvement</div>
                  </div>
                </div>
                <div class="kpi-chart">
                  <canvas id="resolutionChart" width="100" height="40"></canvas>
                </div>
              </div>

              <div class="kpi-card info">
                <div class="kpi-header">
                  <div class="kpi-icon gradient-cyan"></div>
                  <div class="kpi-details">
                    <h4>System Uptime</h4>
                    <div class="kpi-value" id="systemUptime">99.8%</div>
                    <div class="kpi-change neutral">Excellent</div>
                  </div>
                </div>
                <div class="kpi-chart">
                  <canvas id="uptimeChart" width="100" height="40"></canvas>
                </div>
              </div>
            </div>

            <!-- Main Analytics Charts Grid -->
            <div class="analytics-charts-grid">
              <!-- Ticket Trends Chart -->
              <div class="chart-card large">
                <div class="chart-header">
                  <h3> Ticket Trends & Volume Analysis</h3>
                  <div class="chart-controls">
                    <button class="chart-btn active" onclick="toggleChartView('tickets', 'line')">
                      Line
                    </button>
                    <button class="chart-btn" onclick="toggleChartView('tickets', 'bar')">
                      Bar
                    </button>
                    <button class="chart-btn" onclick="toggleChartView('tickets', 'area')">
                      Area
                    </button>
                  </div>
                </div>
                <div class="chart-body">
                  <canvas id="ticketTrendsChart" height="300"></canvas>
                </div>
              </div>

              <!-- Performance Metrics -->
              <div class="chart-card medium">
                <div class="chart-header">
                  <h3> Performance Metrics</h3>
                  <div class="metric-toggle">
                    <label class="toggle-switch">
                      <input type="checkbox" id="realTimeToggle" checked />
                      <span class="toggle-slider"></span>
                    </label>
                    <span>Real-time Updates</span>
                  </div>
                </div>
                <div class="chart-body">
                  <canvas id="performanceChart" height="200"></canvas>
                </div>
              </div>

              <!-- Category Distribution -->
              <div class="chart-card medium">
                <div class="chart-header">
                  <h3> Issue Categories</h3>
                  <button class="btn-icon" onclick="refreshCategoryData()"></button>
                </div>
                <div class="chart-body">
                  <canvas id="categoryChart" height="200"></canvas>
                </div>
              </div>

              <!-- Geographic Heatmap -->
              <div class="chart-card large">
                <div class="chart-header">
                  <h3> Geographic Performance Heatmap</h3>
                  <div class="heatmap-legend">
                    <div class="legend-item">
                      <span class="legend-color excellent"></span>
                      <span>Excellent (95-100%)</span>
                    </div>
                    <div class="legend-item">
                      <span class="legend-color good"></span>
                      <span>Good (85-94%)</span>
                    </div>
                    <div class="legend-item">
                      <span class="legend-color needs-attention"></span>
                      <span>Needs Attention (&lt;85%)</span>
                    </div>
                  </div>
                </div>
                <div class="chart-body">
                  <canvas id="heatmapChart" height="250"></canvas>
                </div>
              </div>
            </div>

            <!-- Performance Monitoring Section -->
            <div class="performance-monitoring">
              <div class="monitoring-header">
                <h3> System Performance Monitoring</h3>
                <div class="monitoring-status">
                  <div class="status-indicator active">
                    <div class="pulse-dot"></div>
                    <span>All Systems Operational</span>
                  </div>
                </div>
              </div>

              <div class="monitoring-grid">
                <div class="monitor-card">
                  <div class="monitor-header">
                    <span class="monitor-icon"></span>
                    <h4>Server Health</h4>
                  </div>
                  <div class="monitor-metrics">
                    <div class="metric-row">
                      <span>CPU Usage</span>
                      <div class="metric-bar">
                        <div class="metric-fill metric-45"></div>
                        <span class="metric-value">45%</span>
                      </div>
                    </div>
                    <div class="metric-row">
                      <span>Memory</span>
                      <div class="metric-bar">
                        <div class="metric-fill metric-62"></div>
                        <span class="metric-value">62%</span>
                      </div>
                    </div>
                    <div class="metric-row">
                      <span>Disk I/O</span>
                      <div class="metric-bar">
                        <div class="metric-fill metric-28"></div>
                        <span class="metric-value">28%</span>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="monitor-card">
                  <div class="monitor-header">
                    <span class="monitor-icon"></span>
                    <h4>Network Status</h4>
                  </div>
                  <div class="monitor-metrics">
                    <div class="metric-row">
                      <span>Latency</span>
                      <div class="metric-bar">
                        <div class="metric-fill good metric-15"></div>
                        <span class="metric-value">12ms</span>
                      </div>
                    </div>
                    <div class="metric-row">
                      <span>Throughput</span>
                      <div class="metric-bar">
                        <div class="metric-fill excellent metric-85"></div>
                        <span class="metric-value">850MB/s</span>
                      </div>
                    </div>
                    <div class="metric-row">
                      <span>Uptime</span>
                      <div class="metric-bar">
                        <div class="metric-fill excellent metric-99"></div>
                        <span class="metric-value">99.8%</span>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="monitor-card">
                  <div class="monitor-header">
                    <span class="monitor-icon"></span>
                    <h4>Security Status</h4>
                  </div>
                  <div class="security-indicators">
                    <div class="security-item secure">
                      <span class="security-icon"></span>
                      <span>SSL Certificate Valid</span>
                    </div>
                    <div class="security-item secure">
                      <span class="security-icon"></span>
                      <span>Firewall Active</span>
                    </div>
                    <div class="security-item secure">
                      <span class="security-icon"></span>
                      <span>No Threats Detected</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Data Export Panel -->
            <div class="export-panel">
              <div class="export-header">
                <h3> Data Export & Reports</h3>
                <div class="export-quick-actions">
                  <button class="btn btn-success" onclick="generateReport('summary')">
                     Generate Summary Report
                  </button>
                  <button class="btn btn-primary" onclick="scheduleReport()">
                     Schedule Automated Reports
                  </button>
                </div>
              </div>

              <div class="export-options">
                <div class="export-section">
                  <h4> Custom Report Builder</h4>
                  <div class="report-builder">
                    <div class="builder-row">
                      <div class="builder-field">
                        <label>Report Type:</label>
                        <select id="reportType">
                          <option value="analytics">Analytics Summary</option>
                          <option value="tickets">Ticket Analysis</option>
                          <option value="performance">Performance Report</option>
                          <option value="partner">Partner Overview</option>
                        </select>
                      </div>
                      <div class="builder-field">
                        <label>Date Range:</label>
                        <select id="reportDateRange">
                          <option value="7d">Last 7 Days</option>
                          <option value="30d">Last 30 Days</option>
                          <option value="90d">Last 90 Days</option>
                          <option value="custom">Custom Range</option>
                        </select>
                      </div>
                      <div class="builder-field">
                        <label>Format:</label>
                        <select id="reportFormat">
                          <option value="pdf">PDF Report</option>
                          <option value="csv">CSV Data</option>
                          <option value="excel">Excel Workbook</option>
                          <option value="json">JSON Export</option>
                        </select>
                      </div>
                      <div class="builder-actions">
                        <button class="btn btn-primary" onclick="buildCustomReport()">
                           Generate Report
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="content-grid">
            <div class="content-card">
              <div class="card-header">
                <h3 class="card-title"> Recent Tickets</h3>
              </div>
              <div class="card-body">
                <div class="activity-list">
                  <div class="activity-item">
                    <div class="activity-icon"></div>
                    <div class="activity-content">
                      <h4>LounGenie Call Button Not Responding</h4>
                      <p>Unit #12 call button unresponsive, guests cannot request service</p>
                      <div class="activity-meta">
                        <span class="badge badge-open">Open</span>
                        <span class="timestamp-text">2 hours ago</span>
                      </div>
                    </div>
                  </div>

                  <div class="activity-item medium">
                    <div class="activity-icon medium-gradient"></div>
                    <div class="activity-content">
                      <div class="activity-header">
                        <h4>Sheraton Bay - Battery Management Alert</h4>
                        <span class="ticket-id">#LG-2024-1241</span>
                      </div>
                      <p>
                        Units #5, #8, #15 showing reduced battery capacity. Proactive replacement
                        scheduled for tomorrow morning.
                      </p>
                      <div class="activity-details">
                        <span class="location"> Tampa Bay, FL</span>
                        <span class="priority medium"> Maintenance</span>
                        <span class="assigned"> Lisa Martinez</span>
                      </div>
                      <div class="activity-meta">
                        <span class="badge badge-progress">SCHEDULED</span>
                        <span class="timestamp"> 4 hours ago</span>
                      </div>
                    </div>
                  </div>

                  <div class="activity-item medium">
                    <div class="activity-icon medium-gradient"></div>
                    <div class="activity-content">
                      <div class="activity-header">
                        <h4>Westin Resort - Display Enhancement</h4>
                        <span class="ticket-id">#LG-2024-1235</span>
                      </div>
                      <p>
                        Screen display optimization complete. Updated UI with better visibility in
                        direct sunlight. Guest satisfaction improved.
                      </p>
                      <div class="activity-details">
                        <span class="location"> Key West, FL</span>
                        <span class="priority medium"> Enhancement</span>
                        <span class="assigned"> UI Team</span>
                      </div>
                      <div class="activity-meta">
                        <span class="badge badge-resolved">COMPLETED</span>
                        <span class="timestamp"> 1 day ago</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Enhanced Quick Actions Panel -->
            <div class="content-card quick-actions-panel">
              <div class="card-header">
                <h3 class="card-title"> Quick Actions & Resources</h3>
                <div class="card-actions">
                  <button class="btn-icon" title="Refresh"></button>
                  <button class="btn-icon" title="Settings"></button>
                </div>
              </div>
              <div class="card-body">
                <div class="quick-actions-grid">
                  <button class="quick-action-btn critical" onclick="createEmergencyTicket()">
                    <div class="action-icon"></div>
                    <div class="action-content">
                      <div class="action-label">Emergency Support</div>
                      <div class="action-desc">Critical system issues</div>
                    </div>
                  </button>
                  <button class="quick-action-btn high" onclick="createTicket()">
                    <div class="action-icon"></div>
                    <div class="action-content">
                      <div class="action-label">New Ticket</div>
                      <div class="action-desc">Submit support request</div>
                    </div>
                  </button>
                  <button class="quick-action-btn medium" onclick="viewTickets()">
                    <div class="action-icon"></div>
                    <div class="action-content">
                      <div class="action-label">My Tickets</div>
                      <div class="action-desc">Track all requests</div>
                    </div>
                  </button>
                  <button class="quick-action-btn normal" onclick="viewTraining()">
                    <div class="action-icon"></div>
                    <div class="action-content">
                      <div class="action-label">Training Center</div>
                      <div class="action-desc">Video tutorials</div>
                    </div>
                  </button>
                  <button class="quick-action-btn normal" onclick="viewManuals()">
                    <div class="action-icon"></div>
                    <div class="action-content">
                      <div class="action-label">Documentation</div>
                      <div class="action-desc">User guides & manuals</div>
                    </div>
                  </button>
                  <button class="quick-action-btn normal" onclick="viewProfile()">
                    <div class="action-icon"></div>
                    <div class="action-content">
                      <div class="action-label">Company Profile</div>
                      <div class="action-desc">Account settings</div>
                    </div>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Support/Admin Dashboard -->
        <div class="dashboard active" id="staffDashboard">
          <div class="dashboard-header">
            <h1 class="dashboard-title">Support Operations Center</h1>
            <p class="dashboard-subtitle">Welcome, Support Team  Full operational access</p>
          </div>

          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon"></div>
                <div class="stat-label">Active Tickets</div>
              </div>
              <div class="stat-value">127</div>
              <div class="stat-change">+8 today</div>
              <div class="mini-chart">
                <svg width="100%" height="40" viewBox="0 0 200 40" class="sparkline">
                  <path
                    d="M10,30 L30,25 L50,35 L70,20 L90,28 L110,15 L130,22 L150,18 L170,12 L190,8"
                    stroke="#3b82f6"
                    stroke-width="2"
                    fill="none"
                    class="chart-line"
                  />
                  <path
                    d="M10,30 L30,25 L50,35 L70,20 L90,28 L110,15 L130,22 L150,18 L170,12 L190,8 L190,40 L10,40 Z"
                    fill="url(#ticketGradient)"
                    opacity="0.2"
                  />
                </svg>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon"></div>
                <div class="stat-label">Partners</div>
              </div>
              <div class="stat-value">89</div>
              <div class="stat-change">2,340 units total</div>
              <div class="mini-chart">
                <svg width="100%" height="40" viewBox="0 0 200 40" class="sparkline">
                  <path
                    d="M10,25 L30,22 L50,20 L70,23 L90,25 L110,28 L130,26 L150,24 L170,22 L190,20"
                    stroke="#10b981"
                    stroke-width="2"
                    fill="none"
                    class="chart-line"
                  />
                  <path
                    d="M10,25 L30,22 L50,20 L70,23 L90,25 L110,28 L130,26 L150,24 L170,22 L190,20 L190,40 L10,40 Z"
                    fill="url(#partnerGradient)"
                    opacity="0.2"
                  />
                </svg>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon"></div>
                <div class="stat-label">Avg Resolution</div>
              </div>
              <div class="stat-value">4.2h</div>
              <div class="stat-change">-12% this month</div>
              <div class="mini-chart">
                <svg width="100%" height="40" viewBox="0 0 200 40" class="sparkline">
                  <path
                    d="M10,35 L30,30 L50,28 L70,32 L90,25 L110,22 L130,18 L150,15 L170,12 L190,10"
                    stroke="#f59e0b"
                    stroke-width="2"
                    fill="none"
                    class="chart-line"
                  />
                  <path
                    d="M10,35 L30,30 L50,28 L70,32 L90,25 L110,22 L130,18 L150,15 L170,12 L190,10 L190,40 L10,40 Z"
                    fill="url(#resolutionGradient)"
                    opacity="0.2"
                  />
                </svg>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon"></div>
                <div class="stat-label">Urgent Issues</div>
              </div>
              <div class="stat-value">3</div>
              <div class="stat-change">Needs attention</div>
            </div>
          </div>

          <!-- Enhanced Content Grid -->
          <div class="enhanced-content-grid">
            <!-- Priority Tickets Panel -->
            <div class="content-card priority-panel">
              <div class="card-header">
                <h3 class="card-title"> Critical Support Queue</h3>
                <div class="card-actions">
                  <button class="btn-icon"></button>
                  <button class="btn-icon"></button>
                </div>
              </div>
              <div class="card-body">
                <div class="activity-list enhanced">
                  <div class="activity-item critical">
                    <div class="activity-icon critical-gradient"></div>
                    <div class="activity-content">
                      <div class="activity-header">
                        <h4>Marriott Downtown - Power System Failure</h4>
                        <span class="ticket-id">#LG-2024-1247</span>
                      </div>
                      <p>
                        Complete power loss affecting 47 LounGenie units in poolside area. Backup
                        systems activated. Estimated 200+ guests impacted.
                      </p>
                      <div class="activity-details">
                        <span class="location"> Miami, FL</span>
                        <span class="priority critical"> Critical</span>
                        <span class="assigned"> Sarah Chen</span>
                      </div>
                      <div class="activity-meta">
                        <span class="badge badge-urgent pulse">URGENT</span>
                        <span class="timestamp"> 18 min ago</span>
                      </div>
                    </div>
                  </div>

                  <div class="activity-item high">
                    <div class="activity-icon high-gradient"></div>
                    <div class="activity-content">
                      <div class="activity-header">
                        <h4>Hilton Resort & Spa - Security Override</h4>
                        <span class="ticket-id">#LG-2024-1245</span>
                      </div>
                      <p>
                        Master code compromised on 12 units. Emergency rekey required for guest
                        safety. Security team on standby.
                      </p>
                      <div class="activity-details">
                        <span class="location"> Orlando, FL</span>
                        <span class="priority high"> High</span>
                        <span class="assigned"> Mike Rodriguez</span>
                      </div>
                      <div class="activity-meta">
                        <span class="badge badge-open">IN PROGRESS</span>
                        <span class="timestamp"> 45 min ago</span>
                      </div>
                    </div>
                  </div>

                  <div class="activity-item medium">
                    <div class="activity-icon medium-gradient"></div>
                    <div class="activity-content">
                      <div class="activity-header">
                        <h4>Four Seasons - Connectivity Issues</h4>
                        <span class="ticket-id">#LG-2024-1243</span>
                      </div>
                      <p>
                        Intermittent LoRa network connection causing sync delays. 8 units affected.
                        Diagnostics in progress.
                      </p>
                      <div class="activity-details">
                        <span class="location"> Las Vegas, NV</span>
                        <span class="priority medium"> Medium</span>
                        <span class="assigned"> Alex Johnson</span>
                      </div>
                      <div class="activity-meta">
                        <span class="badge badge-progress">INVESTIGATING</span>
                        <span class="timestamp"> 1.2 hours ago</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="content-card">
              <div class="card-header">
                <h3 class="card-title"> Operations</h3>
              </div>
              <div class="card-body">
                <div class="quick-actions">
                  <a href="#" class="action-item">
                    <span class="action-icon"></span>
                    Manage All Tickets
                  </a>
                  <a href="#" class="action-item">
                    <span class="action-icon"></span>
                    Partner Management
                  </a>
                  <a href="#" class="action-item" onclick="showPartnerMap()">
                    <span class="action-icon"></span>
                    Partner Map
                  </a>
                  <a href="#" class="action-item">
                    <span class="action-icon"></span>
                    Service Calendar
                  </a>
                  <a href="#" class="action-item">
                    <span class="action-icon"></span>
                    Analytics & Reports
                  </a>
                  <a href="#" class="action-item">
                    <span class="action-icon"></span>
                    Security Center
                  </a>
                </div>
              </div>
            </div>

            <!-- Partner Management Panel - Visible to Support and Admin -->
            <div id="partner-management" class="dashboard-section">
              <div class="section-card">
                <div class="section-header">
                  <h2> Partner Management</h2>
                  <div class="section-actions">
                    <button class="btn btn-primary" onclick="showAddPartnerForm()">
                      <span></span>
                      Add New Partner
                    </button>
                    <button class="btn btn-secondary" onclick="exportPartners()">
                      <span></span>
                      Export List
                    </button>
                  </div>
                </div>
                <div class="section-content">
                  <!-- Add Partner Form (Initially Hidden) -->
                  <div id="add-partner-form" class="add-partner-form add-partner-form-hidden">
                    <h4>Add New Partner</h4>
                    <form onsubmit="addNewPartner(event)">
                      <div class="form-row">
                        <div class="form-group">
                          <label for="partner-name">Company Name *</label>
                          <input
                            type="text"
                            id="partner-name"
                            name="partnerName"
                            required
                            placeholder="Enter company name"
                            title="Partner company name"
                          />
                        </div>
                        <div class="form-group">
                          <label for="partner-type">Partner Type *</label>
                          <select
                            id="partner-type"
                            name="partnerType"
                            required
                            title="Select partner type"
                          >
                            <option value="">Select partner type</option>
                            <option value="resort">Resort & Hotel</option>
                            <option value="waterpark">Water Park</option>
                            <option value="cruise">Cruise Line</option>
                            <option value="pool">Pool Facility</option>
                            <option value="spa">Spa & Wellness</option>
                            <option value="other">Other</option>
                          </select>
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="form-group">
                          <label for="partner-location">Location *</label>
                          <input
                            type="text"
                            id="partner-location"
                            name="partnerLocation"
                            required
                            placeholder="City, State/Country"
                            title="Partner location"
                          />
                        </div>
                        <div class="form-group">
                          <label for="partner-units">Number of Units</label>
                          <input
                            type="number"
                            id="partner-units"
                            name="partnerUnits"
                            min="1"
                            placeholder="e.g., 24"
                            title="Number of LounGenie units"
                          />
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="form-group">
                          <label for="partner-contact-name">Primary Contact *</label>
                          <input
                            type="text"
                            id="partner-contact-name"
                            name="contactName"
                            required
                            placeholder="Contact person name"
                            title="Primary contact name"
                          />
                        </div>
                        <div class="form-group">
                          <label for="partner-contact-email">Contact Email *</label>
                          <input
                            type="email"
                            id="partner-contact-email"
                            name="contactEmail"
                            required
                            placeholder="contact@company.com"
                            title="Primary contact email"
                          />
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="form-group">
                          <label for="partner-phone">Phone Number</label>
                          <input
                            type="tel"
                            id="partner-phone"
                            name="partnerPhone"
                            placeholder="(555) 123-4567"
                            title="Contact phone number"
                          />
                        </div>
                        <div class="form-group">
                          <label for="partner-status">Status</label>
                          <select id="partner-status" name="partnerStatus" title="Partner status">
                            <option value="active">Active</option>
                            <option value="maintenance">Maintenance</option>
                            <option value="offline">Offline</option>
                            <option value="pending">Pending Setup</option>
                          </select>
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="form-group">
                          <label for="partner-notes">Notes</label>
                          <textarea
                            id="partner-notes"
                            name="partnerNotes"
                            rows="3"
                            placeholder="Additional notes about this partner"
                            title="Partner notes"
                          ></textarea>
                        </div>
                      </div>
                      <div class="form-actions">
                        <button
                          type="button"
                          class="btn btn-secondary"
                          onclick="hideAddPartnerForm()"
                        >
                          Cancel
                        </button>
                        <button type="submit" class="btn btn-success">Add Partner</button>
                      </div>
                    </form>
                  </div>

                  <!-- Partners Grid -->
                  <div class="partner-management">
                    <div class="partner-grid" id="partners-grid">
                      <!-- Sheraton Bay Resort -->
                      <div class="partner-card">
                        <div class="partner-card-header">
                          <div>
                            <div class="partner-title">Sheraton Bay Resort</div>
                            <div class="partner-type">Resort & Hotel</div>
                          </div>
                          <div class="partner-status-badge status-active">Active</div>
                        </div>
                        <div class="partner-details">
                          <div class="partner-detail-row">
                            <span class="detail-label">Location:</span>
                            <span class="detail-value">Tampa Bay, FL</span>
                          </div>
                          <div class="partner-detail-row">
                            <span class="detail-label">Units:</span>
                            <span class="detail-value">24 LounGenie</span>
                          </div>
                          <div class="partner-detail-row">
                            <span class="detail-label">Contact:</span>
                            <span class="detail-value">Lisa Martinez</span>
                          </div>
                          <div class="partner-detail-row">
                            <span class="detail-label">Last Update:</span>
                            <span class="detail-value">2 hours ago</span>
                          </div>
                        </div>
                        <div class="security-key-section">
                          <h5> Security Keys & Access</h5>
                          <div class="security-keys">
                            <div class="key-item">
                              <div class="key-info">
                                <span class="key-icon"></span>
                                <span class="key-name">Master Key</span>
                              </div>
                              <div class="key-actions">
                                <button
                                  class="btn btn-secondary btn-sm"
                                  onclick="editKey('master', 'sheraton')"
                                >
                                  Edit
                                </button>
                                <button
                                  class="btn btn-danger btn-sm"
                                  onclick="revokeKey('master', 'sheraton')"
                                >
                                  Revoke
                                </button>
                              </div>
                            </div>
                            <div class="key-item">
                              <div class="key-info">
                                <span class="key-icon"></span>
                                <span class="key-name">Property Access</span>
                              </div>
                              <div class="key-actions">
                                <button
                                  class="btn btn-secondary btn-sm"
                                  onclick="editKey('property', 'sheraton')"
                                >
                                  Edit
                                </button>
                                <button
                                  class="btn btn-danger btn-sm"
                                  onclick="revokeKey('property', 'sheraton')"
                                >
                                  Revoke
                                </button>
                              </div>
                            </div>
                          </div>
                          <button class="btn btn-primary btn-sm" onclick="addNewKey('sheraton')">
                            + Add New Key
                          </button>
                        </div>
                        <div class="partner-actions">
                          <button class="btn btn-primary btn-sm" onclick="editPartner('sheraton')">
                            Edit Details
                          </button>
                          <button
                            class="btn btn-secondary btn-sm"
                            onclick="viewPartnerAnalytics('sheraton')"
                          >
                            Analytics
                          </button>
                          <button
                            class="btn btn-success btn-sm"
                            onclick="contactPartner('sheraton')"
                          >
                            Contact
                          </button>
                        </div>
                      </div>

                      <!-- Westin Resort -->
                      <div class="partner-card">
                        <div class="partner-card-header">
                          <div>
                            <div class="partner-title">Westin Resort</div>
                            <div class="partner-type">Resort & Hotel</div>
                          </div>
                          <div class="partner-status-badge status-active">Active</div>
                        </div>
                        <div class="partner-details">
                          <div class="partner-detail-row">
                            <span class="detail-label">Location:</span>
                            <span class="detail-value">Key West, FL</span>
                          </div>
                          <div class="partner-detail-row">
                            <span class="detail-label">Units:</span>
                            <span class="detail-value">18 LounGenie</span>
                          </div>
                          <div class="partner-detail-row">
                            <span class="detail-label">Contact:</span>
                            <span class="detail-value">James Wilson</span>
                          </div>
                          <div class="partner-detail-row">
                            <span class="detail-label">Last Update:</span>
                            <span class="detail-value">1 day ago</span>
                          </div>
                        </div>
                        <div class="security-key-section">
                          <h5> Security Keys & Access</h5>
                          <div class="security-keys">
                            <div class="key-item">
                              <div class="key-info">
                                <span class="key-icon"></span>
                                <span class="key-name">Master Key</span>
                              </div>
                              <div class="key-actions">
                                <button
                                  class="btn btn-secondary btn-sm"
                                  onclick="editKey('master', 'westin')"
                                >
                                  Edit
                                </button>
                                <button
                                  class="btn btn-danger btn-sm"
                                  onclick="revokeKey('master', 'westin')"
                                >
                                  Revoke
                                </button>
                              </div>
                            </div>
                            <div class="key-item">
                              <div class="key-info">
                                <span class="key-icon"></span>
                                <span class="key-name">Security Lock</span>
                              </div>
                              <div class="key-actions">
                                <button
                                  class="btn btn-secondary btn-sm"
                                  onclick="editKey('security', 'westin')"
                                >
                                  Edit
                                </button>
                                <button
                                  class="btn btn-danger btn-sm"
                                  onclick="revokeKey('security', 'westin')"
                                >
                                  Revoke
                                </button>
                              </div>
                            </div>
                          </div>
                          <button class="btn btn-primary btn-sm" onclick="addNewKey('westin')">
                            + Add New Key
                          </button>
                        </div>
                        <div class="partner-actions">
                          <button class="btn btn-primary btn-sm" onclick="editPartner('westin')">
                            Edit Details
                          </button>
                          <button
                            class="btn btn-secondary btn-sm"
                            onclick="viewPartnerAnalytics('westin')"
                          >
                            Analytics
                          </button>
                          <button class="btn btn-success btn-sm" onclick="contactPartner('westin')">
                            Contact
                          </button>
                        </div>
                      </div>

                      <!-- Comfort Solutions Inc -->
                      <div class="partner-card">
                        <div class="partner-card-header">
                          <div>
                            <div class="partner-title">Comfort Solutions Inc</div>
                            <div class="partner-type">Pool Facility</div>
                          </div>
                          <div class="partner-status-badge status-maintenance">Maintenance</div>
                        </div>
                        <div class="partner-details">
                          <div class="partner-detail-row">
                            <span class="detail-label">Location:</span>
                            <span class="detail-value">Miami, FL</span>
                          </div>
                          <div class="partner-detail-row">
                            <span class="detail-label">Units:</span>
                            <span class="detail-value">12 LounGenie</span>
                          </div>
                          <div class="partner-detail-row">
                            <span class="detail-label">Contact:</span>
                            <span class="detail-value">Sarah Chen</span>
                          </div>
                          <div class="partner-detail-row">
                            <span class="detail-label">Last Update:</span>
                            <span class="detail-value">3 hours ago</span>
                          </div>
                        </div>
                        <div class="security-key-section">
                          <h5> Security Keys & Access</h5>
                          <div class="security-keys">
                            <div class="key-item">
                              <div class="key-info">
                                <span class="key-icon"></span>
                                <span class="key-name">Master Key</span>
                              </div>
                              <div class="key-actions">
                                <button
                                  class="btn btn-secondary btn-sm"
                                  onclick="editKey('master', 'comfort')"
                                >
                                  Edit
                                </button>
                                <button
                                  class="btn btn-danger btn-sm"
                                  onclick="revokeKey('master', 'comfort')"
                                >
                                  Revoke
                                </button>
                              </div>
                            </div>
                          </div>
                          <button class="btn btn-primary btn-sm" onclick="addNewKey('comfort')">
                            + Add New Key
                          </button>
                        </div>
                        <div class="partner-actions">
                          <button class="btn btn-primary btn-sm" onclick="editPartner('comfort')">
                            Edit Details
                          </button>
                          <button
                            class="btn btn-secondary btn-sm"
                            onclick="viewPartnerAnalytics('comfort')"
                          >
                            Analytics
                          </button>
                          <button
                            class="btn btn-warning btn-sm"
                            onclick="scheduleService('comfort')"
                          >
                            Schedule Service
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Admin Settings Panel - Only visible to Admin role -->
            <div id="admin-settings" class="dashboard-section admin-settings-visible">
              <div class="section-card">
                <div class="section-header">
                  <h2>Admin Settings</h2>
                </div>
                <div class="section-content">
                  <div class="admin-panel">
                    <div class="logo-management">
                      <h3>Logo Management</h3>
                      <div class="logo-upload-section">
                        <div class="current-logos">
                          <div class="logo-preview">
                            <h4>Current Company Logo</h4>
                            <div class="logo-container">
                              <img
                                src="Pool Safe Logo (2).svg"
                                alt="Pool Safe Inc Logo"
                                class="preview-logo"
                              />
                            </div>
                            <div class="upload-controls">
                              <label for="company-logo-upload" class="visually-hidden"
                                >Upload Company Logo</label
                              >
                              <input
                                type="file"
                                id="company-logo-upload"
                                accept=".svg,.png,.jpg,.jpeg"
                                class="file-input-hidden"
                                title="Choose company logo file"
                              />
                              <button
                                class="btn btn-primary"
                                onclick="document.getElementById('company-logo-upload').click()"
                              >
                                Update Company Logo
                              </button>
                            </div>
                          </div>
                          <div class="logo-preview">
                            <h4>Current Product Logo</h4>
                            <div class="logo-container">
                              <img
                                src="LounGenie Logo.svg"
                                alt="LounGenie Logo"
                                class="preview-logo"
                              />
                            </div>
                            <div class="upload-controls">
                              <label for="product-logo-upload" class="visually-hidden"
                                >Upload Product Logo</label
                              >
                              <input
                                type="file"
                                id="product-logo-upload"
                                accept=".svg,.png,.jpg,.jpeg"
                                class="file-input-hidden"
                                title="Choose product logo file"
                              />
                              <button
                                class="btn btn-primary"
                                onclick="document.getElementById('product-logo-upload').click()"
                              >
                                Update Product Logo
                              </button>
                            </div>
                          </div>
                        </div>
                        <div class="upload-status upload-status-hidden" id="upload-status"></div>
                      </div>
                    </div>

                    <!-- HubSpot Integration Settings -->
                    <div class="integration-settings">
                      <h3> HubSpot Integration</h3>
                      <div class="integration-card">
                        <div class="integration-header">
                          <div class="integration-status">
                            <span class="status-indicator" id="hubspot-status"></span>
                            <span>HubSpot Connection</span>
                          </div>
                          <button class="btn btn-primary" onclick="testHubSpotConnection()">
                            Test Connection
                          </button>
                        </div>
                        <div class="settings-grid">
                          <div class="setting-item">
                            <label for="hubspot-api-key">HubSpot API Key</label>
                            <input
                              type="password"
                              id="hubspot-api-key"
                              class="form-control"
                              placeholder="Enter HubSpot API key"
                              title="HubSpot API key for integration"
                            />
                            <small class="field-help"
                              >Required for syncing contacts and tickets</small
                            >
                          </div>
                          <div class="setting-item">
                            <label for="hubspot-portal-id">Portal ID</label>
                            <input
                              type="text"
                              id="hubspot-portal-id"
                              class="form-control"
                              placeholder="Enter Portal ID"
                              title="HubSpot Portal ID"
                            />
                            <small class="field-help">Found in HubSpot account settings</small>
                          </div>
                          <div class="setting-item">
                            <label for="hubspot-app-id">App ID</label>
                            <input
                              type="text"
                              id="hubspot-app-id"
                              class="form-control"
                              placeholder="Enter App ID"
                              title="HubSpot App ID"
                            />
                            <small class="field-help">Private app ID from HubSpot developers</small>
                          </div>
                          <div class="setting-item">
                            <label for="hubspot-client-secret">Client Secret</label>
                            <input
                              type="password"
                              id="hubspot-client-secret"
                              class="form-control"
                              placeholder="Enter Client Secret"
                              title="HubSpot Client Secret"
                            />
                            <small class="field-help">Keep this secure and private</small>
                          </div>
                        </div>
                        <div class="integration-actions">
                          <button class="btn btn-success" onclick="saveHubSpotSettings()">
                            Save HubSpot Settings
                          </button>
                          <button class="btn btn-secondary" onclick="syncHubSpotData()">
                            Sync Data Now
                          </button>
                        </div>
                      </div>
                    </div>

                    <!-- Microsoft Outlook Integration Settings -->
                    <div class="integration-settings">
                      <h3> Microsoft Outlook Integration</h3>
                      <div class="integration-card">
                        <div class="integration-header">
                          <div class="integration-status">
                            <span class="status-indicator" id="outlook-status"></span>
                            <span>Outlook Connection</span>
                          </div>
                          <button class="btn btn-primary" onclick="testOutlookConnection()">
                            Test Connection
                          </button>
                        </div>
                        <div class="settings-grid">
                          <div class="setting-item">
                            <label for="outlook-client-id">Client ID</label>
                            <input
                              type="text"
                              id="outlook-client-id"
                              class="form-control"
                              placeholder="Enter Azure App Client ID"
                              title="Azure AD Application Client ID"
                            />
                            <small class="field-help"
                              >Azure AD registered application client ID</small
                            >
                          </div>
                          <div class="setting-item">
                            <label for="outlook-client-secret">Client Secret</label>
                            <input
                              type="password"
                              id="outlook-client-secret"
                              class="form-control"
                              placeholder="Enter Client Secret"
                              title="Azure AD Application Client Secret"
                            />
                            <small class="field-help">Generated in Azure AD app registration</small>
                          </div>
                          <div class="setting-item">
                            <label for="outlook-tenant-id">Tenant ID</label>
                            <input
                              type="text"
                              id="outlook-tenant-id"
                              class="form-control"
                              placeholder="Enter Tenant ID"
                              title="Azure AD Tenant ID"
                            />
                            <small class="field-help">Your organization's Azure AD tenant ID</small>
                          </div>
                          <div class="setting-item">
                            <label for="outlook-redirect-uri">Redirect URI</label>
                            <input
                              type="url"
                              id="outlook-redirect-uri"
                              class="form-control"
                              placeholder="https://your-domain.com/auth/callback"
                              title="OAuth redirect URI"
                            />
                            <small class="field-help">Must match Azure AD app registration</small>
                          </div>
                        </div>
                        <div class="integration-actions">
                          <button class="btn btn-success" onclick="saveOutlookSettings()">
                            Save Outlook Settings
                          </button>
                          <button class="btn btn-secondary" onclick="authorizeOutlook()">
                            Authorize Access
                          </button>
                        </div>
                      </div>
                    </div>

                    <!-- Security & API Management -->
                    <div class="security-settings">
                      <h3> Security & API Management</h3>
                      <div class="security-card">
                        <div class="security-section">
                          <h4>API Keys & Tokens</h4>
                          <div class="api-keys-list">
                            <div class="api-key-item">
                              <div class="api-key-info">
                                <span class="api-key-name">Portal API Key</span>
                                <span class="api-key-created">Created: Sept 30, 2025</span>
                              </div>
                              <div class="api-key-actions">
                                <button
                                  class="btn btn-secondary btn-sm"
                                  onclick="copyApiKey('portal')"
                                >
                                  Copy
                                </button>
                                <button
                                  class="btn btn-warning btn-sm"
                                  onclick="regenerateApiKey('portal')"
                                >
                                  Regenerate
                                </button>
                                <button
                                  class="btn btn-danger btn-sm"
                                  onclick="revokeApiKey('portal')"
                                >
                                  Revoke
                                </button>
                              </div>
                            </div>
                            <div class="api-key-item">
                              <div class="api-key-info">
                                <span class="api-key-name">Mobile App Key</span>
                                <span class="api-key-created">Created: Sept 25, 2025</span>
                              </div>
                              <div class="api-key-actions">
                                <button
                                  class="btn btn-secondary btn-sm"
                                  onclick="copyApiKey('mobile')"
                                >
                                  Copy
                                </button>
                                <button
                                  class="btn btn-warning btn-sm"
                                  onclick="regenerateApiKey('mobile')"
                                >
                                  Regenerate
                                </button>
                                <button
                                  class="btn btn-danger btn-sm"
                                  onclick="revokeApiKey('mobile')"
                                >
                                  Revoke
                                </button>
                              </div>
                            </div>
                          </div>
                          <button class="btn btn-primary" onclick="generateNewApiKey()">
                            + Generate New API Key
                          </button>
                        </div>

                        <div class="security-section">
                          <h4>Access Control</h4>
                          <div class="access-controls">
                            <div class="control-item">
                              <label class="toggle-switch" for="two-factor-auth">
                                <input
                                  type="checkbox"
                                  id="two-factor-auth"
                                  checked
                                  aria-label="Two-Factor Authentication"
                                />
                                <span class="toggle-slider"></span>
                              </label>
                              <div class="control-info">
                                <span class="control-label">Two-Factor Authentication</span>
                                <span class="control-desc">Require 2FA for admin access</span>
                              </div>
                            </div>
                            <div class="control-item">
                              <label class="toggle-switch" for="ip-restrictions">
                                <input
                                  type="checkbox"
                                  id="ip-restrictions"
                                  aria-label="IP Address Restrictions"
                                />
                                <span class="toggle-slider"></span>
                              </label>
                              <div class="control-info">
                                <span class="control-label">IP Address Restrictions</span>
                                <span class="control-desc">Limit access to specific IP ranges</span>
                              </div>
                            </div>
                            <div class="control-item">
                              <label class="toggle-switch" for="session-timeout">
                                <input
                                  type="checkbox"
                                  id="session-timeout"
                                  checked
                                  aria-label="Auto Session Timeout"
                                />
                                <span class="toggle-slider"></span>
                              </label>
                              <div class="control-info">
                                <span class="control-label">Auto Session Timeout</span>
                                <span class="control-desc"
                                  >Automatically log out inactive users</span
                                >
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="system-settings">
                      <h3> System Configuration</h3>
                      <div class="settings-grid">
                        <div class="setting-item">
                          <label for="portal-title">Portal Title</label>
                          <input
                            type="text"
                            id="portal-title"
                            value="LounGenie Support Portal"
                            class="form-control"
                            placeholder="Enter portal title"
                            title="Portal display title"
                          />
                        </div>
                        <div class="setting-item">
                          <label for="company-name">Company Name</label>
                          <input
                            type="text"
                            id="company-name"
                            value="Pool Safe Inc"
                            class="form-control"
                            placeholder="Enter company name"
                            title="Company name"
                          />
                        </div>
                        <div class="setting-item">
                          <label for="support-email">Support Email</label>
                          <input
                            type="email"
                            id="support-email"
                            value="support@poolsafeinc.com"
                            class="form-control"
                            placeholder="Enter support email"
                            title="Support contact email"
                          />
                        </div>
                        <div class="setting-item">
                          <button class="btn btn-success" onclick="saveSettings()">
                            Save Settings
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Partner Map Section -->
            <div id="partner-map-section" class="dashboard-section map-section-hidden">
              <div class="section-card">
                <div class="section-header">
                  <h2> Partner Location Map</h2>
                  <div class="map-controls">
                    <button class="btn btn-secondary" onclick="resetMapView()">Reset View</button>
                    <button class="btn btn-primary" onclick="toggleMapSection()">Close Map</button>
                  </div>
                </div>
                <div class="section-content">
                  <div class="map-filters">
                    <div class="filter-group">
                      <label for="partner-type-filter">Filter by Type:</label>
                      <select id="partner-type-filter" onchange="filterPartners()">
                        <option value="all">All Partners</option>
                        <option value="hotel">Hotels & Resorts</option>
                        <option value="waterpark">Water Parks</option>
                        <option value="cruise">Cruise Terminals</option>
                        <option value="recreation">Recreation Centers</option>
                      </select>
                    </div>
                    <div class="filter-group">
                      <label for="status-filter">Filter by Status:</label>
                      <select id="status-filter" onchange="filterPartners()">
                        <option value="all">All Statuses</option>
                        <option value="active">Active</option>
                        <option value="maintenance">Maintenance</option>
                        <option value="offline">Offline</option>
                      </select>
                    </div>
                    <div class="partner-stats">
                      <span id="visible-partners">89</span> partners shown
                    </div>
                  </div>

                  <div class="map-container">
                    <div id="partner-map" class="interactive-map leaflet-map"></div>
                    <div class="map-legend">
                      <h4>Legend</h4>
                      <div class="legend-item">
                        <div class="marker active-marker"></div>
                        <span>Active Partners</span>
                      </div>
                      <div class="legend-item">
                        <div class="marker maintenance-marker"></div>
                        <span>Maintenance</span>
                      </div>
                      <div class="legend-item">
                        <div class="marker offline-marker"></div>
                        <span>Offline</span>
                      </div>
                    </div>
                  </div>

                  <!-- Partner Details Panel -->
                  <div
                    id="partner-details-panel"
                    class="partner-details-panel partner-details-hidden"
                  >
                    <div class="panel-header">
                      <h3 id="partner-name">Partner Details</h3>
                      <button class="close-btn" onclick="closePartnerDetails()"></button>
                    </div>
                    <div class="panel-content">
                      <div class="partner-info">
                        <div class="info-row">
                          <strong>Type:</strong> <span id="partner-type"></span>
                        </div>
                        <div class="info-row">
                          <strong>Location:</strong> <span id="partner-location"></span>
                        </div>
                        <div class="info-row">
                          <strong>Units:</strong> <span id="partner-units"></span>
                        </div>
                        <div class="info-row">
                          <strong>Status:</strong> <span id="partner-status"></span>
                        </div>
                        <div class="info-row">
                          <strong>Contact:</strong> <span id="partner-contact"></span>
                        </div>
                        <div class="info-row">
                          <strong>Last Update:</strong> <span id="partner-updated"></span>
                        </div>
                      </div>
                      <div class="partner-actions">
                        <button class="btn btn-primary" onclick="viewPartnerTickets()">
                          View Tickets
                        </button>
                        <button class="btn btn-secondary" onclick="contactPartner()">
                          Contact
                        </button>
                        <button class="btn btn-success" onclick="scheduleService()">
                          Schedule Service
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- End main-content -->
    </div>
    <!-- End container -->

    <script>
      // Microsoft Authentication Configuration
      const msalConfig = {
        auth: {
          clientId: "44a618a3-1808-45cb-a282-fcf587fb402a", // Pool Safe Inc Azure AD App
          authority: "https://login.microsoftonline.com/common",
          redirectUri: window.location.origin + "/public/loungenie-portal.html",
        },
        cache: {
          cacheLocation: "localStorage",
          storeAuthStateInCookie: false,
        },
      };

      const loginRequest = {
        scopes: ["openid", "profile", "email", "User.Read"],
        prompt: "select_account",
      };

      // Configurable Backend API base:
      // - Defaults to same-origin relative paths ("")
      // - To target a different backend domain, set window.__API_BASE__ before this script runs
      //   Example:
      //   <script>window.__API_BASE__ = "https://api.your-domain.com";<\/script>
      const API_BASE = (typeof window.__API_BASE__ === "string" ? window.__API_BASE__ : "").replace(/\/$/, "");

      // Initialize MSAL instance
      let msalInstance = null;
      if (typeof msal !== "undefined") {
        msalInstance = new msal.PublicClientApplication(msalConfig);
      }

      let selectedRole = null;
      let currentUser = null;

      // Outlook/Microsoft Authentication Functions
      async function loginWithOutlook() {
        if (!msalInstance) {
          alert("Microsoft Authentication is not available. Please contact your administrator.");
          return;
        }

        try {
          // Show loading state with proper button handling
          const outlookBtn = event.target;
          const originalText = outlookBtn.innerHTML;
          const originalClass = outlookBtn.className;

          // Update button to loading state with good contrast
          outlookBtn.innerHTML = " Connecting to Outlook...";
          outlookBtn.disabled = true;
          outlookBtn.className = originalClass; // Keep original styling

          // Attempt silent sign-in first
          const accounts = msalInstance.getAllAccounts();
          let result = null;

          if (accounts.length > 0) {
            const silentRequest = {
              ...loginRequest,
              account: accounts[0],
            };

            try {
              result = await msalInstance.acquireTokenSilent(silentRequest);
            } catch (silentError) {
              console.log("Silent token acquisition failed, using redirect");
            }
          }

          // If silent authentication fails, use redirect
          if (!result) {
            result = await msalInstance.loginPopup(loginRequest);
          }

          // Process the authentication result
          if (result && result.account) {
            await handleOutlookLoginSuccess(result);
          } else {
            throw new Error("No account information received");
          }
        } catch (error) {
          console.error("Outlook login failed:", error);

          // Restore button state properly
          const outlookBtn = event ? event.target : document.querySelector(".btn-secondary");
          if (outlookBtn) {
            outlookBtn.innerHTML =
              originalText ||
              `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="margin-right: 8px; vertical-align: middle;">
                        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" fill="currentColor"/>
                    </svg>Sign In with Outlook`;
            outlookBtn.disabled = false;
            outlookBtn.className = originalClass || "btn btn-secondary";
          }

          // Show user-friendly error
          alert("Failed to sign in with Outlook. Please try again or contact support.");
        }
      }

      async function handleOutlookLoginSuccess(authResult) {
        try {
          // Extract user information
          const userInfo = {
            email: authResult.account.username,
            name: authResult.account.name || authResult.account.username,
            id: authResult.account.homeAccountId,
            accessToken: authResult.accessToken,
          };

          // Determine user role based on email domain or admin list
          const userRole = determineUserRole(userInfo.email);

          // Store authentication info
          currentUser = {
            type: "staff",
            role: userRole,
            email: userInfo.email,
            name: userInfo.name,
            authMethod: "outlook",
            accessToken: userInfo.accessToken,
          };

          // Update UI with user info
          document.getElementById("userName").textContent = userInfo.name;

          // Hide login and show dashboard
          document.getElementById("loginContainer").style.display = "none";
          document.getElementById("userMenu").style.display = "flex";
          document.getElementById("staffDashboard").classList.add("active");

          // Show admin settings if user is admin
          if (userRole === "admin") {
            document.getElementById("admin-settings").style.display = "block";
            setupAdminPanel();
          }

          // Optional: Sync with backend
          await syncOutlookUserWithBackend(userInfo);

          console.log("Outlook authentication successful:", userInfo.email);
        } catch (error) {
          console.error("Error processing Outlook login:", error);
          alert(
            "Authentication succeeded but there was an error setting up your session. Please refresh and try again.",
          );
        }
      }

      function determineUserRole(email) {
        // Define admin emails (this could be configured via backend)
        const adminEmails = [
          "admin@poolsafeinc.com",
          "fatima@poolsafeinc.com",
          "support@poolsafeinc.com",
        ];

        // Check if email is in admin list or is Pool Safe Inc domain
        if (
          adminEmails.includes(email.toLowerCase()) ||
          email.toLowerCase().endsWith("@poolsafeinc.com")
        ) {
          return "admin";
        }

        // Default to support role
        return "support";
      }

      async function syncOutlookUserWithBackend(userInfo) {
        try {
          // Send user info to backend for validation/creation
          const response = await fetch(`${API_BASE}/api/auth/outlook-sync`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${userInfo.accessToken}`,
            },
            body: JSON.stringify({
              email: userInfo.email,
              name: userInfo.name,
              outlookId: userInfo.id,
            }),
          });

          if (!response.ok) {
            console.warn("Backend sync failed, continuing with client-side auth");
          }
        } catch (error) {
          console.warn("Could not sync with backend:", error);
          // Continue anyway - client-side auth is sufficient for now
        }
      }

      function selectRole(role) {
        selectedRole = role;

        // Reset all cards
        document.querySelectorAll(".role-card").forEach((card) => {
          card.classList.remove("active");
        });

        // Hide all auth sections
        document.querySelectorAll(".auth-section").forEach((section) => {
          section.classList.remove("active");
        });

        // Activate selected card
        event.currentTarget.classList.add("active");

        // Show appropriate auth section
        if (role === "partner") {
          document.getElementById("partnerAuth").classList.add("active");
        } else {
          document.getElementById("staffAuth").classList.add("active");
        }
      }

      function login(userType) {
        // Hide login container
        document.getElementById("loginContainer").style.display = "none";

        // Show user menu
        document.getElementById("userMenu").style.display = "flex";

        // Show appropriate dashboard
        if (userType === "partner") {
          document.getElementById("partnerDashboard").classList.add("active");
          document.getElementById("userName").textContent = "Comfort Solutions Inc";
        } else {
          document.getElementById("staffDashboard").classList.add("active");
          document.getElementById("userName").textContent = "Support Team";
        }

        currentUser = userType;
      }

      // Add some interactivity
      document.addEventListener("DOMContentLoaded", function () {
        // Simulate real-time updates
        setInterval(updateTimestamps, 60000);
      });

      function updateTimestamps() {
        // Update relative timestamps
        const timeElements = document.querySelectorAll('[style*="font-size: 12px"]');
        // This would update timestamps in a real application
      }

      // Admin Logo Upload Functions
      function setupAdminPanel() {
        const companyLogoUpload = document.getElementById("company-logo-upload");
        const productLogoUpload = document.getElementById("product-logo-upload");

        if (companyLogoUpload) {
          companyLogoUpload.addEventListener("change", function (e) {
            handleLogoUpload(e, "company");
          });
        }

        if (productLogoUpload) {
          productLogoUpload.addEventListener("change", function (e) {
            handleLogoUpload(e, "product");
          });
        }
      }

      function handleLogoUpload(event, logoType) {
        const file = event.target.files[0];
        const statusDiv = document.getElementById("upload-status");

        if (!file) return;

        // Validate file type
        const validTypes = ["image/svg+xml", "image/png", "image/jpeg", "image/jpg"];
        if (!validTypes.includes(file.type)) {
          showUploadStatus("Please select a valid image file (SVG, PNG, JPG)", "error");
          return;
        }

        // Validate file size (max 5MB)
        if (file.size > 5 * 1024 * 1024) {
          showUploadStatus("File size must be less than 5MB", "error");
          return;
        }

        showUploadStatus("Uploading logo...", "info");

        // Create FileReader to preview the image
        const reader = new FileReader();
        reader.onload = function (e) {
          const previewContainer =
            logoType === "company"
              ? document.querySelector(".logo-preview:first-child .logo-container img")
              : document.querySelector(".logo-preview:last-child .logo-container img");

          if (previewContainer) {
            previewContainer.src = e.target.result;
          }

          // Simulate upload success
          setTimeout(() => {
            showUploadStatus(
              `${logoType === "company" ? "Company" : "Product"} logo updated successfully!`,
              "success",
            );

            // Update the actual logos in the header
            if (logoType === "company") {
              const companyLogos = document.querySelectorAll('img[alt*="Pool Safe"]');
              companyLogos.forEach((img) => (img.src = e.target.result));
            } else {
              const productLogos = document.querySelectorAll('img[alt*="LounGenie"]');
              productLogos.forEach((img) => (img.src = e.target.result));
            }
          }, 1000);
        };
        reader.readAsDataURL(file);
      }

      function showUploadStatus(message, type) {
        const statusDiv = document.getElementById("upload-status");
        statusDiv.textContent = message;
        statusDiv.className = `upload-status ${type}`;
        statusDiv.style.display = "block";

        if (type === "success" || type === "error") {
          setTimeout(() => {
            statusDiv.style.display = "none";
          }, 3000);
        }
      }

      function saveSettings() {
        const portalTitle = document.getElementById("portal-title").value;
        const companyName = document.getElementById("company-name").value;
        const supportEmail = document.getElementById("support-email").value;

        // Simulate saving
        showUploadStatus("Saving settings...", "info");

        setTimeout(() => {
          // Update page title
          document.title = portalTitle;

          // Update any company name references
          const companyElements = document.querySelectorAll(".company-name");
          companyElements.forEach((el) => (el.textContent = companyName));

          showUploadStatus("Settings saved successfully!", "success");
        }, 1000);
      }

      // Enhanced login function to show admin panel
      function enhancedLogin(userType, role = null) {
        // Hide login container
        document.getElementById("loginContainer").style.display = "none";

        // Show appropriate dashboard
        if (userType === "partner") {
          document.getElementById("partnerDashboard").style.display = "block";
          currentUser = { type: "partner", role: "partner" };
        } else {
          document.getElementById("staffDashboard").style.display = "block";
          currentUser = { type: "staff", role: role || "support" };

          // Show admin settings if admin role
          if (role === "admin") {
            document.getElementById("admin-settings").style.display = "block";
            setupAdminPanel();
          }
        }
      }

      // Initialize admin functionality on page load
      document.addEventListener("DOMContentLoaded", function () {
        // Override existing login functions
        window.login = function (userType) {
          const role = selectedRole === "staff" ? "admin" : userType;
          enhancedLogin(userType, role);
        };
      });

      // Partner Map Functionality
      let partnerMap;
      let markers = [];
      let currentPartners = [];

      // Real Partner Location Database - Loaded from Backend API
      let partnerDatabase = [];

      // Fetch real partner data from backend
      async function loadPartnerData() {
        try {
          const response = await fetch(`${API_BASE}/api/partners`);
          if (response.ok) {
            const partners = await response.json();
            partnerDatabase = partners.map((partner) => ({
              id: partner.id,
              name: partner.companyName,
              type: partner.managementCompany?.toLowerCase().includes("resort")
                ? "resort"
                : "hotel",
              location: {
                lat: partner.latitude || 40.7128,
                lng: partner.longitude || -74.006,
              },
              address: `${partner.streetAddress}, ${partner.city}, ${partner.state} ${partner.zip}`,
              phone: "Contact via portal",
              email: "Contact via portal",
              status: "active",
              units: partner.numberOfLoungeUnits || 0,
              lastSync: new Date().toISOString(),
              amenities: ["Pool", "Spa", "Fitness Center"],
              rating: 4.5,
              totalBookings: Math.floor(Math.random() * 1000) + 500,
              managementCompany: partner.managementCompany,
              topColour: partner.topColour,
            }));
          } else {
            console.log("Using fallback partner data - backend not available");
            useFallbackData();
          }
        } catch (error) {
          console.log("Using fallback partner data - backend error:", error.message);
          useFallbackData();
        }
      }

      // Fallback partner data for demo purposes
      function useFallbackData() {
        partnerDatabase = [
          {
            id: 1,
            name: "Adventureland",
            type: "resort",
            location: { lat: 41.637302, lng: -93.472463 },
            address: "3300 Adventureland Dr, Altoona, IA 50009",
            phone: "(800) 255-7826",
            email: "Contact via portal",
            status: "active",
            units: 15,
            lastSync: new Date().toISOString(),
            amenities: ["Pool", "Spa", "Water Park"],
            rating: 4.6,
            totalBookings: 1247,
            managementCompany: "Palace Entertainment",
            topColour: "Ice Blue",
          },
          {
            id: 2,
            name: "Beech Bend Park & Splash Lagoon",
            type: "resort",
            location: { lat: 36.944736, lng: -86.461282 },
            address: "798 Beech Bend Rd, Bowling Green, KY 42101",
            phone: "(270) 781-7634",
            email: "Contact via portal",
            status: "active",
            units: 19,
            lastSync: new Date().toISOString(),
            amenities: ["Pool", "Water Park", "Amusement Park"],
            rating: 4.4,
            totalBookings: 892,
            managementCompany: "Beech Bend Park & Splash Lagoon",
            topColour: "Ice Blue",
          },
          {
            id: 3,
            name: "Big Dam Waterpark",
            type: "resort",
            location: { lat: 33.466667, lng: -94.037778 },
            address: "5501 Crossroads Pkwy, Texarkana, AR 71854",
            phone: "(870) 774-4677",
            email: "Contact via portal",
            status: "active",
            units: 12,
            lastSync: new Date().toISOString(),
            amenities: ["Pool", "Water Slides", "Lazy River"],
            rating: 4.3,
            totalBookings: 756,
            managementCompany: "P23 - Big Dam Waterpark",
            topColour: "Classic Blue",
          },
          {
            id: 4,
            name: "Breakwater Beach Waterpark",
            type: "resort",
            location: { lat: 39.944994, lng: -74.071956 },
            address: "800 Ocean Terrace, Seaside Heights, NJ 8751",
            phone: "(732) 793-6488",
            email: "Contact via portal",
            status: "active",
            units: 10,
            lastSync: new Date().toISOString(),
            amenities: ["Beach Access", "Pool", "Water Sports"],
            rating: 4.5,
            totalBookings: 634,
            managementCompany: "Breakwater Beach Waterpark",
            topColour: "Ice Blue",
          },
        ];
      }

      // Initialize Partner Map with Leaflet
      function initializePartnerMap() {
        // Check if Leaflet is available
        if (typeof L !== "undefined") {
          createLeafletMap();
        } else {
          // Fallback to visual map
          createVisualPartnerMap();
        }
        loadPartnerMarkers();
      }

      // Create Leaflet Map (Modern, Free, No API Key Required)
      function createLeafletMap() {
        const mapContainer = document.getElementById("partner-map");

        // Initialize Leaflet map
        partnerMap = L.map(mapContainer).setView([39.8283, -98.5795], 4);

        // Add OpenStreetMap tiles (free)
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
          attribution: " OpenStreetMap contributors",
          maxZoom: 19,
        }).addTo(partnerMap);

        // Add partner markers
        addLeafletMarkers();
      }

      // Add partner markers to Leaflet map
      function addLeafletMarkers() {
        if (!partnerMap || typeof L === "undefined") return;

        const markers = L.markerClusterGroup({
          chunkedLoading: true,
          maxClusterRadius: 50,
        });

        currentPartners.forEach((partner) => {
          const marker = L.marker([partner.location.lat, partner.location.lng]).bindPopup(`
                        <div class="map-popup">
                            <h4>${partner.name}</h4>
                            <p><strong>Type:</strong> ${partner.type}</p>
                            <p><strong>Status:</strong> <span class="status ${partner.status}">${partner.status}</span></p>
                            <p><strong>Location:</strong> ${partner.location.city}, ${partner.location.state}</p>
                            <p><strong>Units:</strong> ${partner.units}</p>
                            <button class="btn btn-sm btn-primary" onclick="viewPartnerDetails('${partner.id}')">
                                View Details
                            </button>
                        </div>
                    `);

          markers.addLayer(marker);
        });

        partnerMap.addLayer(markers);
      }

      // Create Visual Partner Map with Advanced Features (No API Required)
      function createVisualPartnerMap() {
        const mapContainer = document.getElementById("partner-map");

        // Group nearby partners for clustering
        const clusters = createPartnerClusters(currentPartners);

        mapContainer.innerHTML = `
                <div class="visual-map-container">
                    <div class="map-background">
                        <svg width="100%" height="500" viewBox="0 0 1000 500" class="enhanced-map">
                            <!-- USA Outline with States -->
                            <path d="M158 206c34-15 68-29 105-38 45-11 93-16 141-12 38 3 75 10 111 21 42 13 82 31 118 54 28 18 54 39 76 63 16 18 30 38 41 59 8 16 14 33 17 50 2 12 2 24 0 36-3 17-9 33-18 47-12 19-28 36-46 49-22 16-47 28-73 36-31 9-63 14-95 16-38 2-76 0-114-5-35-5-69-13-102-24-38-13-74-30-107-51-25-16-48-35-68-56-14-15-26-32-36-50-7-13-12-27-15-42-2-11-2-22 0-33 3-16 8-31 16-45 10-18 23-34 38-48 19-18 41-33 65-45z" fill="#e8f4f8" stroke="#94a3b8" stroke-width="2"/>
                            
                            <!-- Major Cities (for reference) -->
                            <circle cx="280" cy="240" r="3" fill="#94a3b8" opacity="0.6"/>
                            <text x="280" y="235" text-anchor="middle" font-size="9" fill="#6b7280">NYC</text>
                            
                            <circle cx="200" cy="320" r="3" fill="#94a3b8" opacity="0.6"/>
                            <text x="200" y="315" text-anchor="middle" font-size="9" fill="#6b7280">ATL</text>
                            
                            <circle cx="150" cy="280" r="3" fill="#94a3b8" opacity="0.6"/>
                            <text x="150" y="275" text-anchor="middle" font-size="9" fill="#6b7280">CHI</text>
                            
                            <circle cx="750" cy="320" r="3" fill="#94a3b8" opacity="0.6"/>
                            <text x="750" y="315" text-anchor="middle" font-size="9" fill="#6b7280">LA</text>
                            
                            <!-- Advanced Partner Markers and Clusters -->
                            ${clusters
                              .map((cluster) => {
                                if (cluster.isCluster) {
                                  return createClusterMarker(cluster);
                                } else {
                                  return createAdvancedPartnerMarker(cluster.partner);
                                }
                              })
                              .join("")}
                        </svg>
                        
                        <!-- Enhanced Map Controls -->
                        <div class="map-controls">
                            <button class="map-control-btn" onclick="zoomIn()" title="Zoom In">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <path d="m21 21-4.35-4.35"></path>
                                    <line x1="11" y1="8" x2="11" y2="14"></line>
                                    <line x1="8" y1="11" x2="14" y2="11"></line>
                                </svg>
                            </button>
                            <button class="map-control-btn" onclick="zoomOut()" title="Zoom Out">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <path d="m21 21-4.35-4.35"></path>
                                    <line x1="8" y1="11" x2="14" y2="11"></line>
                                </svg>
                            </button>
                            <button class="map-control-btn" onclick="resetMapView()" title="Reset View">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 7v6h6"></path>
                                    <path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"></path>
                                </svg>
                            </button>
                        </div>
                        
                        <!-- Enhanced Map Legend -->
                        <div class="map-legend enhanced-legend">
                            <div class="legend-section">
                                <h4>Partner Status</h4>
                                <div class="legend-item">
                                    <div class="legend-marker water-park active"></div>
                                    <span>Active Water Parks</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-marker resort active"></div>
                                    <span>Active Resorts</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-marker maintenance"></div>
                                    <span>Maintenance</span>
                                </div>
                            </div>
                            <div class="legend-section">
                                <h4>Clusters</h4>
                                <div class="legend-item">
                                    <div class="legend-cluster">3+</div>
                                    <span>Multiple Partners</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

        // Add click handlers to all interactive elements
        addMapInteractionHandlers(mapContainer);
      }

      // Create partner clusters for nearby locations
      function createPartnerClusters(partners) {
        const clusters = [];
        const processed = new Set();
        const clusterDistance = 50; // Distance threshold for clustering

        partners.forEach((partner, index) => {
          if (processed.has(index)) return;

          const x = ((partner.location.lng + 125) / 60) * 1000;
          const y = 500 - ((partner.location.lat - 25) / 25) * 400;

          const nearbyPartners = [partner];
          processed.add(index);

          // Find nearby partners
          partners.forEach((otherPartner, otherIndex) => {
            if (processed.has(otherIndex) || index === otherIndex) return;

            const otherX = ((otherPartner.location.lng + 125) / 60) * 1000;
            const otherY = 500 - ((otherPartner.location.lat - 25) / 25) * 400;

            const distance = Math.sqrt(Math.pow(x - otherX, 2) + Math.pow(y - otherY, 2));

            if (distance < clusterDistance) {
              nearbyPartners.push(otherPartner);
              processed.add(otherIndex);
            }
          });

          if (nearbyPartners.length > 1) {
            // Create cluster
            const avgX =
              nearbyPartners.reduce((sum, p) => sum + ((p.location.lng + 125) / 60) * 1000, 0) /
              nearbyPartners.length;
            const avgY =
              nearbyPartners.reduce(
                (sum, p) => sum + (500 - ((p.location.lat - 25) / 25) * 400),
                0,
              ) / nearbyPartners.length;

            clusters.push({
              isCluster: true,
              x: avgX,
              y: avgY,
              count: nearbyPartners.length,
              partners: nearbyPartners,
            });
          } else {
            // Single partner
            clusters.push({
              isCluster: false,
              partner: partner,
            });
          }
        });

        return clusters;
      }

      // Create advanced partner marker with custom icons
      function createAdvancedPartnerMarker(partner) {
        const x = ((partner.location.lng + 125) / 60) * 1000;
        const y = 500 - ((partner.location.lat - 25) / 25) * 400;
        const statusColor = partner.status === "active" ? "#10b981" : "#f59e0b";
        const typeIcon = partner.type === "resort" ? "" : "";

        return `
                <g class="partner-marker-group" data-partner-id="${partner.id}">
                    <!-- Pulse animation for active status -->
                    ${
                      partner.status === "active"
                        ? `
                        <circle cx="${x}" cy="${y}" r="15" fill="${statusColor}" opacity="0.3" class="pulse-ring">
                            <animate attributeName="r" values="15;25;15" dur="2s" repeatCount="indefinite"/>
                            <animate attributeName="opacity" values="0.3;0;0.3" dur="2s" repeatCount="indefinite"/>
                        </circle>
                    `
                        : ""
                    }
                    
                    <!-- Main marker -->
                    <circle cx="${x}" cy="${y}" r="12" fill="${statusColor}" stroke="white" stroke-width="3" class="partner-dot enhanced-dot"/>
                    
                    <!-- Type icon -->
                    <text x="${x}" y="${y + 4}" text-anchor="middle" font-size="14" class="partner-icon">${typeIcon}</text>
                    
                    <!-- Partner name -->
                    <text x="${x}" y="${y + 30}" text-anchor="middle" font-size="10" fill="#374151" class="partner-name">${partner.name.split(" ")[0]}</text>
                    
                    <!-- Unit count badge -->
                    <circle cx="${x + 10}" cy="${y - 10}" r="8" fill="white" stroke="${statusColor}" stroke-width="2"/>
                    <text x="${x + 10}" y="${y - 6}" text-anchor="middle" font-size="9" font-weight="bold" fill="${statusColor}">${partner.units}</text>
                </g>
            `;
      }

      // Create cluster marker
      function createClusterMarker(cluster) {
        const activeCount = cluster.partners.filter((p) => p.status === "active").length;
        const clusterColor = activeCount === cluster.count ? "#10b981" : "#f59e0b";

        return `
                <g class="cluster-marker-group" data-cluster-partners='${JSON.stringify(cluster.partners.map((p) => p.id))}'>
                    <!-- Cluster background -->
                    <circle cx="${cluster.x}" cy="${cluster.y}" r="20" fill="${clusterColor}" stroke="white" stroke-width="3" class="cluster-dot"/>
                    
                    <!-- Cluster count -->
                    <text x="${cluster.x}" y="${cluster.y + 4}" text-anchor="middle" font-size="14" font-weight="bold" fill="white">${cluster.count}</text>
                    
                    <!-- Cluster label -->
                    <text x="${cluster.x}" y="${cluster.y + 35}" text-anchor="middle" font-size="10" fill="#374151">Partners</text>
                </g>
            `;
      }

      // Add interaction handlers for map elements
      function addMapInteractionHandlers(mapContainer) {
        // Partner marker clicks
        mapContainer.querySelectorAll(".partner-marker-group").forEach((marker) => {
          marker.addEventListener("click", (e) => {
            e.stopPropagation();
            const partnerId = parseInt(e.currentTarget.dataset.partnerId);
            const partner = currentPartners.find((p) => p.id === partnerId);
            if (partner) {
              showPartnerDetails(partner);
            }
          });

          marker.addEventListener("mouseenter", (e) => {
            e.currentTarget.style.transform = "scale(1.1)";
            e.currentTarget.style.transformOrigin = "center";
          });

          marker.addEventListener("mouseleave", (e) => {
            e.currentTarget.style.transform = "scale(1)";
          });
        });

        // Cluster marker clicks
        mapContainer.querySelectorAll(".cluster-marker-group").forEach((cluster) => {
          cluster.addEventListener("click", (e) => {
            e.stopPropagation();
            const partnerIds = JSON.parse(e.currentTarget.dataset.clusterPartners);
            showClusterDetails(partnerIds);
          });
        });
      }

      // Show cluster details
      function showClusterDetails(partnerIds) {
        const partners = partnerIds
          .map((id) => currentPartners.find((p) => p.id === id))
          .filter(Boolean);

        document.getElementById("partner-name").textContent =
          `Cluster: ${partners.length} Partners`;

        const panelContent = document.querySelector("#partner-details-panel .panel-content");
        panelContent.innerHTML = `
                <div class="cluster-info">
                    <h4>Partners in this area:</h4>
                    ${partners
                      .map(
                        (partner) => `
                        <div class="cluster-partner-item" onclick="showPartnerDetails(${JSON.stringify(partner).replace(/"/g, "&quot;")})">
                            <div class="partner-summary">
                                <span class="partner-type-icon">${partner.type === "resort" ? "" : ""}</span>
                                <div class="partner-summary-text">
                                    <strong>${partner.name}</strong>
                                    <div class="partner-summary-meta">${partner.units} units  ${partner.status}</div>
                                </div>
                            </div>
                        </div>
                    `,
                      )
                      .join("")}
                </div>
            `;

        document.getElementById("partner-details-panel").classList.remove("partner-details-hidden");
      }

      // Map control functions
      function zoomIn() {
        // Simulate zoom in functionality
        const svg = document.querySelector(".enhanced-map");
        const currentTransform = svg.style.transform || "scale(1)";
        const scale = parseFloat(currentTransform.match(/scale\(([^)]+)\)/)?.[1] || 1);
        svg.style.transform = `scale(${Math.min(scale * 1.2, 3)})`;
        svg.style.transformOrigin = "center";
      }

      function zoomOut() {
        // Simulate zoom out functionality
        const svg = document.querySelector(".enhanced-map");
        const currentTransform = svg.style.transform || "scale(1)";
        const scale = parseFloat(currentTransform.match(/scale\(([^)]+)\)/)?.[1] || 1);
        svg.style.transform = `scale(${Math.max(scale / 1.2, 0.5)})`;
        svg.style.transformOrigin = "center";
      }

      function resetMapView() {
        // Reset map to original view
        const svg = document.querySelector(".enhanced-map");
        svg.style.transform = "scale(1)";
      }

      // Load Partner Markers on Map
      function loadPartnerMarkers() {
        currentPartners = partnerDatabase.slice();
        markers = [];

        currentPartners.forEach((partner) => {
          addPartnerMarker(partner);
        });

        updatePartnerStats();
      }

      // Add Individual Partner Marker
      function addPartnerMarker(partner) {
        if (typeof google === "undefined") return;

        const marker = new google.maps.Marker({
          position: partner.location,
          map: partnerMap,
          title: partner.name,
          icon: {
            url: getMarkerIcon(partner.type, partner.status),
            scaledSize: new google.maps.Size(30, 30),
          },
        });

        const infoWindow = new google.maps.InfoWindow({
          content: createMarkerInfoContent(partner),
        });

        marker.addListener("click", () => {
          infoWindow.open(partnerMap, marker);
          showPartnerDetails(partner);
        });

        markers.push({ marker, partner, infoWindow });
      }

      // Get Marker Icon Based on Type and Status
      function getMarkerIcon(type, status) {
        const baseColor = type === "hotel" ? "#007bff" : "#28a745";
        const statusColor = status === "active" ? baseColor : "#ffc107";

        // Return a data URL for a simple colored circle
        const canvas = document.createElement("canvas");
        canvas.width = 30;
        canvas.height = 30;
        const ctx = canvas.getContext("2d");

        ctx.beginPath();
        ctx.arc(15, 15, 12, 0, 2 * Math.PI);
        ctx.fillStyle = statusColor;
        ctx.fill();
        ctx.strokeStyle = "#ffffff";
        ctx.lineWidth = 2;
        ctx.stroke();

        return canvas.toDataURL();
      }

      // Create Marker Info Content
      function createMarkerInfoContent(partner) {
        return `
                <div class="marker-info">
                    <h4>${partner.name}</h4>
                    <p><strong>Type:</strong> ${partner.type.charAt(0).toUpperCase() + partner.type.slice(1)}</p>
                    <p><strong>Status:</strong> <span class="status-${partner.status}">${partner.status.charAt(0).toUpperCase() + partner.status.slice(1)}</span></p>
                    <p><strong>Units:</strong> ${partner.units}</p>
                    <p><strong>Rating:</strong> ${"".repeat(Math.floor(partner.rating))} ${partner.rating}/5</p>
                    <button onclick="showPartnerDetails(${JSON.stringify(partner).replace(/"/g, "&quot;")})" class="btn btn-sm btn-primary">View Details</button>
                </div>
            `;
      }

      // Show Partner Details Panel
      function showPartnerDetails(partner) {
        document.getElementById("partner-name").textContent = partner.name;

        const panelContent = document.querySelector("#partner-details-panel .panel-content");
        panelContent.innerHTML = `
                <div class="partner-info">
                    <div class="info-row">
                        <span class="label">Type:</span>
                        <span class="value">${partner.type.charAt(0).toUpperCase() + partner.type.slice(1)}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Status:</span>
                        <span class="value status-${partner.status}">${partner.status.charAt(0).toUpperCase() + partner.status.slice(1)}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Total Units:</span>
                        <span class="value">${partner.units}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Rating:</span>
                        <span class="value">${"".repeat(Math.floor(partner.rating))} ${partner.rating}/5</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Total Bookings:</span>
                        <span class="value">${partner.totalBookings.toLocaleString()}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Address:</span>
                        <span class="value">${partner.address}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Phone:</span>
                        <span class="value">${partner.phone}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Email:</span>
                        <span class="value">${partner.email}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Last Sync:</span>
                        <span class="value">${new Date(partner.lastSync).toLocaleString()}</span>
                    </div>
                    <div class="info-section">
                        <h4>Amenities</h4>
                        <div class="amenities-list">
                            ${partner.amenities.map((amenity) => `<span class="amenity-tag">${amenity}</span>`).join("")}
                        </div>
                    </div>
                </div>
            `;

        document.getElementById("partner-details-panel").classList.remove("partner-details-hidden");
      }

      // Close Partner Details Panel
      function closePartnerDetails() {
        document.getElementById("partner-details-panel").classList.add("partner-details-hidden");
      }

      // Filter Partners by Type
      function filterPartners(type) {
        // Update filter buttons
        document.querySelectorAll(".filter-btn").forEach((btn) => {
          btn.classList.remove("active");
        });
        event.target.classList.add("active");

        // Clear existing markers
        markers.forEach((item) => {
          item.marker.setMap(null);
        });
        markers = [];

        // Filter and show partners
        const filteredPartners =
          type === "all"
            ? partnerDatabase.slice()
            : partnerDatabase.filter((partner) => partner.type === type);

        currentPartners = filteredPartners;

        filteredPartners.forEach((partner) => {
          addPartnerMarker(partner);
        });

        updatePartnerStats();
      }

      // Update Partner Statistics
      function updatePartnerStats() {
        const totalPartners = currentPartners.length;
        const activePartners = currentPartners.filter((p) => p.status === "active").length;
        const totalUnits = currentPartners.reduce((sum, p) => sum + p.units, 0);
        const avgRating = currentPartners.reduce((sum, p) => sum + p.rating, 0) / totalPartners;

        document.querySelector(".partners-count").textContent = totalPartners;
        document.querySelector(".active-count").textContent = activePartners;
        document.querySelector(".total-units").textContent = totalUnits.toLocaleString();
        document.querySelector(".avg-rating").textContent = avgRating.toFixed(1);
      }

      // Show Partner Map Section - Admin/Support Only
      function showPartnerMap() {
        // Check if user has admin or support role
        if (
          !currentUser ||
          (currentUser.type !== "staff" &&
            currentUser.role !== "admin" &&
            currentUser.role !== "support")
        ) {
          alert("Access Denied: Partner Map is only available to Admin and Support staff.");
          return;
        }

        // Hide other sections
        document.querySelectorAll(".dashboard-section").forEach((section) => {
          section.style.display = "none";
        });

        // Show map section
        document.getElementById("partner-map-section").classList.remove("map-section-hidden");
        document.getElementById("partner-map-section").style.display = "block";

        // Initialize map if not already done
        setTimeout(() => {
          if (!partnerMap) {
            initializePartnerMap();
          } else if (typeof partnerMap.invalidateSize === "function") {
            // Refresh map size if using Leaflet
            partnerMap.invalidateSize();
          }
        }, 200);
      }

      // View partner details from map
      function viewPartnerDetails(partnerId) {
        const partner = currentPartners.find((p) => p.id == partnerId);
        if (partner) {
          showPartnerDetails(partner.id);
        }
      }

      // Navigation function for Partner Map
      window.showPartnerMap = showPartnerMap;
      window.filterPartners = filterPartners;
      window.closePartnerDetails = closePartnerDetails;
      window.showPartnerDetails = showPartnerDetails;
      window.viewPartnerDetails = viewPartnerDetails;

      // Global Search Functionality
      let searchData = [];

      // Initialize search data with sample content
      function initializeSearchData() {
        searchData = [
          // Tickets
          {
            id: "ticket-1",
            title: "LounGenie Call Button Not Responding",
            description: "Unit #12 call button unresponsive",
            category: "Ticket",
            type: "ticket",
          },
          {
            id: "ticket-2",
            title: "Battery Management Alert",
            description: "Sheraton Bay - Units #5, #8, #15 showing reduced battery capacity",
            category: "Ticket",
            type: "ticket",
          },
          {
            id: "ticket-3",
            title: "Display Enhancement",
            description: "Westin Resort - Screen display optimization complete",
            category: "Ticket",
            type: "ticket",
          },

          // Partners
          {
            id: "partner-1",
            title: "Adventureland",
            description: "3300 Adventureland Dr, Altoona, IA - 15 units",
            category: "Partner",
            type: "partner",
          },
          {
            id: "partner-2",
            title: "Beech Bend Park & Splash Lagoon",
            description: "798 Beech Bend Rd, Bowling Green, KY - 12 units",
            category: "Partner",
            type: "partner",
          },
          {
            id: "partner-3",
            title: "Big Dam Waterpark",
            description: "Lake Barkley State Resort Park, KY - 8 units",
            category: "Partner",
            type: "partner",
          },

          // Portal Content
          {
            id: "content-1",
            title: "Partner Map",
            description: "Interactive map showing all partner locations",
            category: "Feature",
            type: "content",
          },
          {
            id: "content-2",
            title: "Analytics & Reports",
            description: "Performance tracking and insights dashboard",
            category: "Feature",
            type: "content",
          },
          {
            id: "content-3",
            title: "Support Operations",
            description: "Ticket management and resolution center",
            category: "Feature",
            type: "content",
          },
          {
            id: "content-4",
            title: "Microsoft Authentication",
            description: "Outlook login for admin and support staff",
            category: "Feature",
            type: "content",
          },

          // System Features
          {
            id: "system-1",
            title: "Admin Settings",
            description: "Portal configuration and logo management",
            category: "System",
            type: "system",
          },
          {
            id: "system-2",
            title: "Security Center",
            description: "Access control and monitoring tools",
            category: "System",
            type: "system",
          },
          {
            id: "system-3",
            title: "Service Calendar",
            description: "Schedule and track maintenance activities",
            category: "System",
            type: "system",
          },
        ];
      }

      // Perform search functionality
      function performSearch() {
        const query = document.getElementById("globalSearch").value.trim();
        if (query.length < 2) {
          hideSearchResults();
          return;
        }

        const results = searchData.filter(
          (item) =>
            item.title.toLowerCase().includes(query.toLowerCase()) ||
            item.description.toLowerCase().includes(query.toLowerCase()),
        );

        displaySearchResults(results, query);
      }

      // Display search results
      function displaySearchResults(results, query) {
        const resultsContainer = document.getElementById("searchResults");

        if (results.length === 0) {
          resultsContainer.innerHTML =
            '<div class="search-result-item"><div class="search-result-title">No results found</div><div class="search-result-description">Try different keywords or check spelling</div></div>';
        } else {
          resultsContainer.innerHTML = results
            .map(
              (result) => `
                    <div class="search-result-item" onclick="selectSearchResult('${result.id}', '${result.type}')">
                        <div class="search-result-category">${result.category}</div>
                        <div class="search-result-title">${highlightMatch(result.title, query)}</div>
                        <div class="search-result-description">${highlightMatch(result.description, query)}</div>
                    </div>
                `,
            )
            .join("");
        }

        resultsContainer.classList.remove("search-results-hidden");
      }

      // Highlight matching text
      function highlightMatch(text, query) {
        const regex = new RegExp(`(${query})`, "gi");
        return text.replace(
          regex,
          '<strong style="background: #fef3c7; color: #92400e;">$1</strong>',
        );
      }

      // Handle search result selection
      function selectSearchResult(id, type) {
        hideSearchResults();
        document.getElementById("globalSearch").value = "";

        // Handle different result types
        switch (type) {
          case "partner":
            if (typeof showPartnerMap === "function") {
              showPartnerMap();
            }
            break;
          case "content":
            if (id === "content-1" && typeof showPartnerMap === "function") {
              showPartnerMap();
            }
            break;
          case "ticket":
            // Could navigate to ticket management
            console.log("Navigate to ticket:", id);
            break;
          case "system":
            // Could navigate to system features
            console.log("Navigate to system feature:", id);
            break;
        }
      }

      // Hide search results
      function hideSearchResults() {
        document.getElementById("searchResults").classList.add("search-results-hidden");
      }

      // Initialize search functionality
      document.addEventListener("DOMContentLoaded", function () {
        initializeSearchData();

        // Real-time search as user types
        document.getElementById("globalSearch").addEventListener("input", function () {
          setTimeout(performSearch, 150); // Debounce search
        });

        // Handle Enter key
        document.getElementById("globalSearch").addEventListener("keydown", function (e) {
          if (e.key === "Enter") {
            performSearch();
          }
        });

        // Hide results when clicking outside
        document.addEventListener("click", function (e) {
          if (!e.target.closest(".search-container")) {
            hideSearchResults();
          }
        });
      });

      // Export search function to global scope
      window.performSearch = performSearch;

      // Notification Center Functionality
      let notifications = [];

      // Initialize notification data
      function initializeNotifications() {
        notifications = [
          {
            id: 1,
            title: "New High Priority Ticket",
            description: "LounGenie unit #12 call button not responding at Adventureland",
            type: "error",
            time: "5 minutes ago",
            read: false,
            icon: "",
          },
          {
            id: 2,
            title: "Partner Status Update",
            description: "Beech Bend Park scheduled maintenance completed successfully",
            type: "success",
            time: "1 hour ago",
            read: false,
            icon: "",
          },
          {
            id: 3,
            title: "System Maintenance",
            description: "Scheduled maintenance window tonight 11 PM - 2 AM EST",
            type: "info",
            time: "3 hours ago",
            read: false,
            icon: "",
          },
          {
            id: 4,
            title: "New Partner Onboarded",
            description: "Breakwater Beach Waterpark successfully integrated - 10 units active",
            type: "success",
            time: "1 day ago",
            read: true,
            icon: "",
          },
          {
            id: 5,
            title: "Battery Alert",
            description: "Multiple units showing reduced battery capacity - replacement scheduled",
            type: "warning",
            time: "2 days ago",
            read: true,
            icon: "",
          },
        ];

        updateNotificationBadge();
        renderNotifications();
      }

      // Toggle notification panel
      function toggleNotifications() {
        const panel = document.getElementById("notificationPanel");
        const isHidden = panel.classList.contains("notification-panel-hidden");

        if (isHidden) {
          panel.classList.remove("notification-panel-hidden");
          renderNotifications();
        } else {
          panel.classList.add("notification-panel-hidden");
        }
      }

      // Render notifications
      function renderNotifications() {
        const container = document.getElementById("notificationList");

        if (notifications.length === 0) {
          container.innerHTML =
            '<div class="notification-item"><div class="notification-content"><div class="notification-text"><div class="notification-title">No notifications</div><div class="notification-description">All caught up! Check back later for updates.</div></div></div></div>';
          return;
        }

        container.innerHTML = notifications
          .map(
            (notification) => `
                <div class="notification-item ${notification.read ? "" : "unread"}" onclick="markAsRead(${notification.id})">
                    <div class="notification-content">
                        <div class="notification-icon ${notification.type}">
                            ${notification.icon}
                        </div>
                        <div class="notification-text">
                            <div class="notification-title">${notification.title}</div>
                            <div class="notification-description">${notification.description}</div>
                            <div class="notification-time">${notification.time}</div>
                        </div>
                    </div>
                </div>
            `,
          )
          .join("");
      }

      // Mark notification as read
      function markAsRead(id) {
        const notification = notifications.find((n) => n.id === id);
        if (notification && !notification.read) {
          notification.read = true;
          updateNotificationBadge();
          renderNotifications();
        }
      }

      // Clear all notifications
      function clearAllNotifications() {
        notifications.forEach((n) => (n.read = true));
        updateNotificationBadge();
        renderNotifications();
      }

      // Update notification badge
      function updateNotificationBadge() {
        const badge = document.getElementById("notificationBadge");
        const unreadCount = notifications.filter((n) => !n.read).length;

        if (unreadCount > 0) {
          badge.textContent = unreadCount;
          badge.style.display = "flex";
        } else {
          badge.style.display = "none";
        }
      }

      // Add new notification (for demo purposes)
      function addNotification(title, description, type = "info", icon = "") {
        const newNotification = {
          id: Date.now(),
          title,
          description,
          type,
          time: "Just now",
          read: false,
          icon,
        };

        notifications.unshift(newNotification);
        updateNotificationBadge();

        if (
          !document
            .getElementById("notificationPanel")
            .classList.contains("notification-panel-hidden")
        ) {
          renderNotifications();
        }
      }

      // Hide notification panel when clicking outside
      document.addEventListener("click", function (e) {
        if (!e.target.closest(".notification-center")) {
          document.getElementById("notificationPanel").classList.add("notification-panel-hidden");
        }
      });

      // Initialize notifications on page load
      document.addEventListener("DOMContentLoaded", function () {
        initializeNotifications();
      });

      // Export notification functions to global scope
      window.toggleNotifications = toggleNotifications;
      window.markAsRead = markAsRead;
      window.clearAllNotifications = clearAllNotifications;
      window.addNotification = addNotification;

      // ===== COMPREHENSIVE ANALYTICS DASHBOARD =====

      // Global variables for analytics
      let analyticsCharts = {};
      let realTimeInterval = null;
      let isRealTimeEnabled = true;

      // Initialize Analytics Dashboard
      function initializeAnalytics() {
        if (typeof Chart === "undefined") {
          console.error("Chart.js not loaded");
          return;
        }

        // Initialize all charts
        initializeKPICharts();
        initializeMainCharts();

        // Start real-time updates
        startRealTimeUpdates();

        // Initialize event listeners
        setupAnalyticsEventListeners();

        console.log(" Analytics Dashboard Initialized Successfully");
      }

      // Initialize KPI Mini Charts
      function initializeKPICharts() {
        // Ticket Volume Chart
        const ticketCtx = document.getElementById("ticketVolumeChart");
        if (ticketCtx) {
          analyticsCharts.ticketVolume = new Chart(ticketCtx, {
            type: "line",
            data: {
              labels: ["Week 1", "Week 2", "Week 3", "Week 4"],
              datasets: [
                {
                  data: [65, 78, 82, 95],
                  borderColor: "#3b82f6",
                  backgroundColor: "rgba(59, 130, 246, 0.1)",
                  borderWidth: 2,
                  fill: true,
                  tension: 0.4,
                  pointRadius: 0,
                  pointHoverRadius: 4,
                },
              ],
            },
            options: getKPIChartOptions(),
          });
        }

        // Response Time Chart
        const responseCtx = document.getElementById("responseTimeChart");
        if (responseCtx) {
          analyticsCharts.responseTime = new Chart(responseCtx, {
            type: "line",
            data: {
              labels: ["Week 1", "Week 2", "Week 3", "Week 4"],
              datasets: [
                {
                  data: [1.8, 1.5, 1.3, 1.2],
                  borderColor: "#10b981",
                  backgroundColor: "rgba(16, 185, 129, 0.1)",
                  borderWidth: 2,
                  fill: true,
                  tension: 0.4,
                  pointRadius: 0,
                  pointHoverRadius: 4,
                },
              ],
            },
            options: getKPIChartOptions(),
          });
        }

        // Resolution Chart
        const resolutionCtx = document.getElementById("resolutionChart");
        if (resolutionCtx) {
          analyticsCharts.resolution = new Chart(resolutionCtx, {
            type: "line",
            data: {
              labels: ["Week 1", "Week 2", "Week 3", "Week 4"],
              datasets: [
                {
                  data: [89, 91, 93, 94],
                  borderColor: "#f59e0b",
                  backgroundColor: "rgba(245, 158, 11, 0.1)",
                  borderWidth: 2,
                  fill: true,
                  tension: 0.4,
                  pointRadius: 0,
                  pointHoverRadius: 4,
                },
              ],
            },
            options: getKPIChartOptions(),
          });
        }

        // Uptime Chart
        const uptimeCtx = document.getElementById("uptimeChart");
        if (uptimeCtx) {
          analyticsCharts.uptime = new Chart(uptimeCtx, {
            type: "line",
            data: {
              labels: ["Week 1", "Week 2", "Week 3", "Week 4"],
              datasets: [
                {
                  data: [99.2, 99.5, 99.7, 99.8],
                  borderColor: "#06b6d4",
                  backgroundColor: "rgba(6, 182, 212, 0.1)",
                  borderWidth: 2,
                  fill: true,
                  tension: 0.4,
                  pointRadius: 0,
                  pointHoverRadius: 4,
                },
              ],
            },
            options: getKPIChartOptions(),
          });
        }
      }

      // Initialize Main Analytics Charts
      function initializeMainCharts() {
        // Ticket Trends Chart
        const trendsCtx = document.getElementById("ticketTrendsChart");
        if (trendsCtx) {
          analyticsCharts.ticketTrends = new Chart(trendsCtx, {
            type: "line",
            data: {
              labels: generateDateLabels(30),
              datasets: [
                {
                  label: "Total Tickets",
                  data: generateTrendData(30, 15, 5),
                  borderColor: "#3b82f6",
                  backgroundColor: "rgba(59, 130, 246, 0.1)",
                  borderWidth: 3,
                  fill: true,
                  tension: 0.4,
                },
                {
                  label: "Resolved",
                  data: generateTrendData(30, 12, 3),
                  borderColor: "#10b981",
                  backgroundColor: "rgba(16, 185, 129, 0.1)",
                  borderWidth: 3,
                  fill: true,
                  tension: 0.4,
                },
                {
                  label: "Open",
                  data: generateTrendData(30, 3, 2),
                  borderColor: "#f59e0b",
                  backgroundColor: "rgba(245, 158, 11, 0.1)",
                  borderWidth: 3,
                  fill: true,
                  tension: 0.4,
                },
              ],
            },
            options: getMainChartOptions("Ticket Volume Over Time"),
          });
        }

        // Performance Chart
        const performanceCtx = document.getElementById("performanceChart");
        if (performanceCtx) {
          analyticsCharts.performance = new Chart(performanceCtx, {
            type: "doughnut",
            data: {
              labels: ["Excellent", "Good", "Needs Attention"],
              datasets: [
                {
                  data: [75, 20, 5],
                  backgroundColor: ["#10b981", "#f59e0b", "#ef4444"],
                  borderWidth: 2,
                  borderColor: "#ffffff",
                },
              ],
            },
            options: getDoughnutChartOptions("Performance Distribution"),
          });
        }

        // Category Chart
        const categoryCtx = document.getElementById("categoryChart");
        if (categoryCtx) {
          analyticsCharts.category = new Chart(categoryCtx, {
            type: "bar",
            data: {
              labels: ["Hardware", "Software", "Network", "Battery", "Display"],
              datasets: [
                {
                  label: "Tickets",
                  data: [45, 28, 15, 32, 18],
                  backgroundColor: ["#3b82f6", "#10b981", "#f59e0b", "#ef4444", "#8b5cf6"],
                  borderRadius: 6,
                  borderSkipped: false,
                },
              ],
            },
            options: getBarChartOptions("Issues by Category"),
          });
        }

        // Heatmap Chart (using custom implementation)
        initializeHeatmap();
      }

      // KPI Chart Options
      function getKPIChartOptions() {
        return {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false,
            },
          },
          scales: {
            x: {
              display: false,
            },
            y: {
              display: false,
            },
          },
          elements: {
            point: {
              hoverRadius: 6,
              hoverBorderWidth: 2,
            },
          },
          interaction: {
            intersect: false,
            mode: "index",
          },
        };
      }

      // Main Chart Options
      function getMainChartOptions(title) {
        return {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: "top",
              align: "end",
              labels: {
                usePointStyle: true,
                padding: 20,
              },
            },
            tooltip: {
              backgroundColor: "rgba(0, 0, 0, 0.8)",
              titleColor: "#ffffff",
              bodyColor: "#ffffff",
              borderColor: "#3b82f6",
              borderWidth: 1,
              cornerRadius: 8,
              displayColors: true,
            },
          },
          scales: {
            x: {
              grid: {
                color: "rgba(0, 0, 0, 0.05)",
              },
              ticks: {
                color: "#64748b",
              },
            },
            y: {
              beginAtZero: true,
              grid: {
                color: "rgba(0, 0, 0, 0.05)",
              },
              ticks: {
                color: "#64748b",
              },
            },
          },
          interaction: {
            intersect: false,
            mode: "index",
          },
        };
      }

      // Doughnut Chart Options
      function getDoughnutChartOptions(title) {
        return {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: "bottom",
              labels: {
                padding: 20,
                usePointStyle: true,
              },
            },
            tooltip: {
              backgroundColor: "rgba(0, 0, 0, 0.8)",
              titleColor: "#ffffff",
              bodyColor: "#ffffff",
              callbacks: {
                label: function (context) {
                  const label = context.label || "";
                  const value = context.parsed;
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = ((value / total) * 100).toFixed(1);
                  return `${label}: ${value} (${percentage}%)`;
                },
              },
            },
          },
        };
      }

      // Bar Chart Options
      function getBarChartOptions(title) {
        return {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false,
            },
            tooltip: {
              backgroundColor: "rgba(0, 0, 0, 0.8)",
              titleColor: "#ffffff",
              bodyColor: "#ffffff",
            },
          },
          scales: {
            x: {
              grid: {
                display: false,
              },
              ticks: {
                color: "#64748b",
              },
            },
            y: {
              beginAtZero: true,
              grid: {
                color: "rgba(0, 0, 0, 0.05)",
              },
              ticks: {
                color: "#64748b",
              },
            },
          },
        };
      }

      // Initialize Heatmap
      function initializeHeatmap() {
        const heatmapCtx = document.getElementById("heatmapChart");
        if (heatmapCtx) {
          // Create a simple grid-based heatmap representation
          const heatmapData = generateHeatmapData();
          analyticsCharts.heatmap = new Chart(heatmapCtx, {
            type: "scatter",
            data: {
              datasets: [
                {
                  label: "Performance Regions",
                  data: heatmapData,
                  backgroundColor: function (context) {
                    const value = context.parsed.y;
                    if (value >= 95) return "#10b981";
                    if (value >= 85) return "#f59e0b";
                    return "#ef4444";
                  },
                  borderColor: "#ffffff",
                  borderWidth: 2,
                  pointRadius: 8,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: false,
                },
                tooltip: {
                  callbacks: {
                    title: function () {
                      return "Regional Performance";
                    },
                    label: function (context) {
                      return `Performance: ${context.parsed.y}%`;
                    },
                  },
                },
              },
              scales: {
                x: {
                  type: "linear",
                  position: "bottom",
                  title: {
                    display: true,
                    text: "Geographic Regions",
                  },
                  min: 0,
                  max: 10,
                },
                y: {
                  title: {
                    display: true,
                    text: "Performance %",
                  },
                  min: 70,
                  max: 100,
                },
              },
            },
          });
        }
      }

      // Data Generation Functions
      function generateDateLabels(days) {
        const labels = [];
        const now = new Date();
        for (let i = days - 1; i >= 0; i--) {
          const date = new Date(now);
          date.setDate(date.getDate() - i);
          labels.push(date.toLocaleDateString("en-US", { month: "short", day: "numeric" }));
        }
        return labels;
      }

      function generateTrendData(days, baseValue, variance) {
        const data = [];
        let currentValue = baseValue;
        for (let i = 0; i < days; i++) {
          currentValue += (Math.random() - 0.5) * variance;
          currentValue = Math.max(0, currentValue);
          data.push(Math.round(currentValue));
        }
        return data;
      }

      function generateHeatmapData() {
        const regions = [
          { x: 2, y: 96, region: "Florida" },
          { x: 4, y: 92, region: "California" },
          { x: 6, y: 88, region: "Texas" },
          { x: 8, y: 94, region: "New York" },
          { x: 3, y: 82, region: "Nevada" },
          { x: 7, y: 98, region: "Hawaii" },
        ];
        return regions;
      }

      // Real-time Updates
      function startRealTimeUpdates() {
        if (realTimeInterval) {
          clearInterval(realTimeInterval);
        }

        realTimeInterval = setInterval(() => {
          if (isRealTimeEnabled) {
            updateKPIValues();
            updateChartData();
            updatePerformanceMetrics();
          }
        }, 5000); // Update every 5 seconds
      }

      function updateKPIValues() {
        // Update KPI display values with animation
        const kpiElements = {
          ticketVolume: document.getElementById("ticketVolume"),
          avgResponseTime: document.getElementById("avgResponseTime"),
          resolutionRate: document.getElementById("resolutionRate"),
          systemUptime: document.getElementById("systemUptime"),
        };

        // Simulate data changes
        if (kpiElements.ticketVolume) {
          const current = parseInt(kpiElements.ticketVolume.textContent);
          const change = Math.floor(Math.random() * 6) - 3; // -3 to +3
          animateValue(kpiElements.ticketVolume, current, current + change);
        }

        if (kpiElements.resolutionRate) {
          const newValue = (94.2 + (Math.random() - 0.5) * 2).toFixed(1);
          kpiElements.resolutionRate.textContent = newValue + "%";
        }
      }

      function updateChartData() {
        // Update chart data points
        Object.keys(analyticsCharts).forEach((chartKey) => {
          const chart = analyticsCharts[chartKey];
          if (chart && chart.data && chart.data.datasets) {
            chart.data.datasets.forEach((dataset) => {
              if (dataset.data && Array.isArray(dataset.data)) {
                // Add new data point and remove oldest
                const newValue = dataset.data[dataset.data.length - 1] + (Math.random() - 0.5) * 5;
                dataset.data.push(Math.max(0, Math.round(newValue)));

                if (dataset.data.length > 30) {
                  dataset.data.shift();
                }
              }
            });
            chart.update("none"); // Smooth animation
          }
        });
      }

      function updatePerformanceMetrics() {
        // Update performance bars with animation
        const metrics = document.querySelectorAll(".metric-fill");
        metrics.forEach((metric) => {
          const currentWidth = parseInt(metric.className.match(/metric-(\d+)/)?.[1] || "0");
          const newWidth = Math.max(10, Math.min(95, currentWidth + (Math.random() - 0.5) * 10));

          // Remove old metric class and add new one
          metric.className = metric.className.replace(
            /metric-\d+/,
            `metric-${Math.round(newWidth)}`,
          );

          // Update associated value
          const valueElement = metric.parentElement.querySelector(".metric-value");
          if (valueElement) {
            if (metric.classList.contains("good") || metric.classList.contains("excellent")) {
              valueElement.textContent =
                Math.round(newWidth) + (Math.random() > 0.5 ? "ms" : "MB/s");
            } else {
              valueElement.textContent = Math.round(newWidth) + "%";
            }
          }
        });
      }

      // Animation helper
      function animateValue(element, start, end, duration = 1000) {
        const startTime = performance.now();
        const difference = end - start;

        function updateValue(currentTime) {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);
          const current = Math.round(start + difference * progress);

          element.textContent = current;

          if (progress < 1) {
            requestAnimationFrame(updateValue);
          }
        }

        requestAnimationFrame(updateValue);
      }

      // Event Listeners
      function setupAnalyticsEventListeners() {
        // Time range filter
        const timeRangeFilter = document.getElementById("timeRangeFilter");
        if (timeRangeFilter) {
          timeRangeFilter.addEventListener("change", function () {
            refreshAnalyticsData(this.value);
          });
        }

        // Real-time toggle
        const realTimeToggle = document.getElementById("realTimeToggle");
        if (realTimeToggle) {
          realTimeToggle.addEventListener("change", function () {
            isRealTimeEnabled = this.checked;
            if (isRealTimeEnabled) {
              startRealTimeUpdates();
            } else {
              clearInterval(realTimeInterval);
            }
          });
        }
      }

      // Public Functions for Dashboard Controls
      function refreshAnalytics() {
        const button = event.target;
        button.classList.add("refreshing");

        // Simulate refresh delay
        setTimeout(() => {
          // Reinitialize charts with new data
          Object.keys(analyticsCharts).forEach((chartKey) => {
            const chart = analyticsCharts[chartKey];
            if (chart) {
              chart.destroy();
            }
          });

          initializeAnalytics();
          button.classList.remove("refreshing");

          addNotification("Analytics data refreshed successfully", "success");
        }, 1500);
      }

      function exportAnalytics() {
        const button = event.target;
        button.classList.add("exporting");

        // Simulate export process
        setTimeout(() => {
          button.classList.remove("exporting");
          addNotification("Analytics report exported successfully", "success");
        }, 2000);
      }

      function toggleChartView(chartType, viewType) {
        // Update active button
        const buttons = event.target.parentElement.querySelectorAll(".chart-btn");
        buttons.forEach((btn) => btn.classList.remove("active"));
        event.target.classList.add("active");

        // Update chart type
        if (analyticsCharts[chartType]) {
          const chart = analyticsCharts[chartType];
          chart.config.type = viewType;
          chart.update();
        }
      }

      function refreshCategoryData() {
        if (analyticsCharts.category) {
          const chart = analyticsCharts.category;
          chart.data.datasets[0].data = chart.data.datasets[0].data.map((value) =>
            Math.max(5, Math.round(value + (Math.random() - 0.5) * 10)),
          );
          chart.update();
        }
      }

      function refreshAnalyticsData(timeRange) {
        console.log(`Refreshing analytics for time range: ${timeRange}`);
        // Implement time range specific data loading
        addNotification(`Analytics updated for ${timeRange} period`, "info");
      }

      function generateReport(type) {
        addNotification(`Generating ${type} report...`, "info");

        setTimeout(() => {
          addNotification(
            `${type.charAt(0).toUpperCase() + type.slice(1)} report generated successfully`,
            "success",
          );
        }, 2000);
      }

      function scheduleReport() {
        addNotification("Report scheduling feature coming soon", "info");
      }

      function buildCustomReport() {
        const reportType = document.getElementById("reportType")?.value;
        const dateRange = document.getElementById("reportDateRange")?.value;
        const format = document.getElementById("reportFormat")?.value;

        addNotification(
          `Building ${format.toUpperCase()} report for ${reportType} (${dateRange})...`,
          "info",
        );

        setTimeout(() => {
          addNotification(
            `Custom ${format.toUpperCase()} report completed successfully`,
            "success",
          );
        }, 3000);
      }

      // Initialize Analytics when Dashboard is shown
      function showDashboard(role) {
        selectedRole = role;

        // Hide login and show dashboard
        document.getElementById("loginContainer").style.display = "none";

        // Show appropriate dashboard
        if (role === "partner") {
          document.getElementById("partnerDashboard").classList.add("active");

          // Initialize analytics after DOM is ready
          setTimeout(() => {
            initializeAnalytics();
          }, 100);
        }

        document.querySelector(".container").style.display = "block";
      }

      // Add analytics functions to global scope
      window.refreshAnalytics = refreshAnalytics;
      window.exportAnalytics = exportAnalytics;

      // Sidebar Navigation Functions
      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        const overlay = document.getElementById("sidebarOverlay");

        sidebar.classList.toggle("mobile-open");
        overlay.classList.toggle("active");
      }

      function closeSidebar() {
        const sidebar = document.getElementById("sidebar");
        const overlay = document.getElementById("sidebarOverlay");

        sidebar.classList.remove("mobile-open");
        overlay.classList.remove("active");
      }

      function toggleSidebarCollapse() {
        const sidebar = document.getElementById("sidebar");
        sidebar.classList.toggle("collapsed");
      }

      // Navigation Functions
      function setActiveNavLink(activeElement) {
        // Remove active class from all nav links
        document.querySelectorAll(".nav-link").forEach((link) => {
          link.classList.remove("active");
        });

        // Add active class to clicked link
        if (activeElement) {
          activeElement.classList.add("active");
        }
      }

      function showDashboard() {
        setActiveNavLink(event.target.closest(".nav-link"));

        // Hide all sections
        document.querySelectorAll(".dashboard-section").forEach((section) => {
          section.style.display = "none";
        });

        // Show partner dashboard
        document.getElementById("partnerDashboard").style.display = "block";

        // Close mobile sidebar
        closeSidebar();
      }

      function showAnalytics() {
        setActiveNavLink(event.target.closest(".nav-link"));

        // Hide all sections
        document.querySelectorAll(".dashboard-section").forEach((section) => {
          section.style.display = "none";
        });

        // Show analytics section
        document.getElementById("analytics-section").style.display = "block";

        // Initialize analytics if not already done
        if (typeof initializeAnalytics === "function") {
          initializeAnalytics();
        }

        closeSidebar();
      }

      function showPartnerManagement() {
        setActiveNavLink(event.target.closest(".nav-link"));

        // Hide all sections
        document.querySelectorAll(".dashboard-section").forEach((section) => {
          section.style.display = "none";
        });

        // Show partner management section
        document.getElementById("partner-management").style.display = "block";

        closeSidebar();
      }

      function showAdminSettings() {
        setActiveNavLink(event.target.closest(".nav-link"));

        // Hide all sections
        document.querySelectorAll(".dashboard-section").forEach((section) => {
          section.style.display = "none";
        });

        // Show admin settings section
        document.getElementById("admin-settings").style.display = "block";

        closeSidebar();
      }

      function showTickets() {
        setActiveNavLink(event.target.closest(".nav-link"));

        // Hide all sections
        document.querySelectorAll(".dashboard-section").forEach((section) => {
          section.style.display = "none";
        });

        // Show dashboard (tickets are in main dashboard)
        document.getElementById("partnerDashboard").style.display = "block";

        // Scroll to tickets section if it exists
        const ticketsSection = document.querySelector("#partnerDashboard .activity-list");
        if (ticketsSection) {
          ticketsSection.scrollIntoView({ behavior: "smooth" });
        }

        closeSidebar();
      }

      function showReports() {
        setActiveNavLink(event.target.closest(".nav-link"));

        // Show analytics section for reports
        showAnalytics();
      }

      function showUserManagement() {
        setActiveNavLink(event.target.closest(".nav-link"));

        // Show admin settings for user management
        showAdminSettings();
      }

      function showSecuritySettings() {
        setActiveNavLink(event.target.closest(".nav-link"));

        // Show admin settings and scroll to security section
        showAdminSettings();

        // Scroll to security settings if they exist
        setTimeout(() => {
          const securitySection = document.querySelector(".security-settings");
          if (securitySection) {
            securitySection.scrollIntoView({ behavior: "smooth" });
          }
        }, 100);
      }

      function showHelpCenter() {
        setActiveNavLink(event.target.closest(".nav-link"));

        alert(
          "Help Center - Coming Soon!\n\nFor immediate assistance, contact:\nsupport@poolsafeinc.com\n1-800-POOLSAFE",
        );

        closeSidebar();
      }

      function showDocumentation() {
        setActiveNavLink(event.target.closest(".nav-link"));

        // Open documentation in new window
        window.open("https://docs.poolsafeinc.com", "_blank");

        closeSidebar();
      }

      function showVideos() {
        setActiveNavLink(event.target.closest(".nav-link"));

        // Get current user role from global variable
        const currentUserRole = getCurrentUserRole();

        document.getElementById("mainContent").innerHTML = `
          <div class="content-header">
            <div class="header-left">
              <h1 class="page-title"> Training Videos</h1>
              <p class="page-subtitle">Instructional videos and tutorials for the support portal</p>
            </div>
            ${
              currentUserRole !== "partner"
                ? `
            <div class="header-right">
              <button class="btn btn-primary" onclick="openAddVideoModal()">
                <span class="btn-icon"></span>
                Add Video
              </button>
            </div>
            `
                : ""
            }
          </div>

          <!-- Video Categories -->
          <div class="video-categories">
            <button class="category-btn active" onclick="filterVideos('all')">All Videos</button>
            <button class="category-btn" onclick="filterVideos('getting-started')">Getting Started</button>
            <button class="category-btn" onclick="filterVideos('partner-management')">Partner Management</button>
            <button class="category-btn" onclick="filterVideos('ticketing')">Ticketing System</button>
            <button class="category-btn" onclick="filterVideos('analytics')">Analytics</button>
            <button class="category-btn" onclick="filterVideos('administration')">Administration</button>
          </div>

          <!-- Video Grid -->
          <div class="video-grid" id="videoGrid">
            <!-- Videos will be loaded here -->
          </div>

          <!-- Video Player Modal -->
          <div class="modal" id="videoModal">
            <div class="modal-content video-modal-content">
              <div class="modal-header">
                <h3 id="modalVideoTitle">Video Title</h3>
                <button class="modal-close" onclick="closeVideoModal()">&times;</button>
              </div>
              <div class="modal-body">
                <div class="video-player-container">
                  <video id="modalVideoPlayer" controls width="100%">
                    Your browser does not support the video tag.
                  </video>
                </div>
                <div class="video-info">
                  <p id="modalVideoDescription">Video description...</p>
                  <div class="video-meta">
                    <span class="video-duration" id="modalVideoDuration">5:30</span>
                    <span class="video-category" id="modalVideoCategory">Getting Started</span>
                    <span class="video-date" id="modalVideoDate">Added 2 days ago</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          ${
            currentUserRole !== "partner"
              ? `
          <!-- Add Video Modal -->
          <div class="modal" id="addVideoModal">
            <div class="modal-content">
              <div class="modal-header">
                <h3>Add New Training Video</h3>
                <button class="modal-close" onclick="closeAddVideoModal()">&times;</button>
              </div>
              <div class="modal-body">
                <form id="addVideoForm" onsubmit="addNewVideo(event)">
                  <div class="form-group">
                    <label for="videoTitle">Video Title</label>
                    <input type="text" id="videoTitle" name="title" required placeholder="Enter video title">
                  </div>
                  
                  <div class="form-group">
                    <label for="videoDescription">Description</label>
                    <textarea id="videoDescription" name="description" rows="3" placeholder="Enter video description"></textarea>
                  </div>
                  
                  <div class="form-group">
                    <label for="videoCategory">Category</label>
                    <select id="videoCategory" name="category" required>
                      <option value="">Select category</option>
                      <option value="getting-started">Getting Started</option>
                      <option value="partner-management">Partner Management</option>
                      <option value="ticketing">Ticketing System</option>
                      <option value="analytics">Analytics</option>
                      <option value="administration">Administration</option>
                    </select>
                  </div>
                  
                  <div class="form-group">
                    <label for="videoFile">Video File</label>
                    <input type="file" id="videoFile" name="file" accept="video/*" required>
                    <small class="form-help">Supported formats: MP4, WebM, OGV (Max: 100MB)</small>
                  </div>
                  
                  <div class="form-group">
                    <label for="videoThumbnail">Thumbnail (Optional)</label>
                    <input type="file" id="videoThumbnail" name="thumbnail" accept="image/*">
                    <small class="form-help">Recommended: 16:9 aspect ratio, JPG/PNG</small>
                  </div>
                  
                  <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAddVideoModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Video</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
          `
              : ""
          }
        `;

        // Load videos
        loadTrainingVideos();
        closeSidebar();
      }

      // Global navigation functions
      window.toggleSidebar = toggleSidebar;
      window.closeSidebar = closeSidebar;
      window.toggleSidebarCollapse = toggleSidebarCollapse;
      window.showDashboard = showDashboard;
      window.showAnalytics = showAnalytics;
      window.showPartnerManagement = showPartnerManagement;
      window.showAdminSettings = showAdminSettings;
      window.showTickets = showTickets;
      window.showReports = showReports;
      window.showUserManagement = showUserManagement;
      window.showSecuritySettings = showSecuritySettings;
      window.showHelpCenter = showHelpCenter;
      window.showDocumentation = showDocumentation;
      window.showVideos = showVideos;
      window.toggleChartView = toggleChartView;
      window.refreshCategoryData = refreshCategoryData;
      window.generateReport = generateReport;
      window.scheduleReport = scheduleReport;
      window.buildCustomReport = buildCustomReport;

      // Update existing showDashboard calls to initialize analytics
      const originalShowDashboard = window.showDashboard;
      window.showDashboard = function (role) {
        if (originalShowDashboard) {
          originalShowDashboard(role);
        } else {
          showDashboard(role);
        }
      };

      // Video Management Functions
      let currentVideoFilter = "all";
      const trainingVideos = [
        {
          id: 1,
          title: "Getting Started with Pool Safe Portal",
          description:
            "A comprehensive introduction to the Pool Safe support portal, covering basic navigation and key features for new users.",
          category: "getting-started",
          duration: "5:30",
          thumbnail: null,
          videoUrl: "#", // Would be actual video URL
          addedBy: "Support Team",
          dateAdded: "2025-09-28",
          views: 127,
        },
        {
          id: 2,
          title: "Partner Management Best Practices",
          description:
            "Learn how to effectively manage partners, update information, and maintain strong relationships through the portal.",
          category: "partner-management",
          duration: "8:15",
          thumbnail: null,
          videoUrl: "#",
          addedBy: "Admin Team",
          dateAdded: "2025-09-26",
          views: 89,
        },
        {
          id: 3,
          title: "Ticketing System Tutorial",
          description:
            "Complete guide to creating, managing, and resolving support tickets efficiently within the system.",
          category: "ticketing",
          duration: "12:45",
          thumbnail: null,
          videoUrl: "#",
          addedBy: "Support Manager",
          dateAdded: "2025-09-25",
          views: 156,
        },
        {
          id: 4,
          title: "Analytics Dashboard Deep Dive",
          description:
            "Explore the analytics dashboard features, understand key metrics, and generate meaningful reports.",
          category: "analytics",
          duration: "15:20",
          thumbnail: null,
          videoUrl: "#",
          addedBy: "Data Team",
          dateAdded: "2025-09-24",
          views: 203,
        },
        {
          id: 5,
          title: "User Role Administration",
          description:
            "Comprehensive guide for administrators on managing user roles, permissions, and access controls.",
          category: "administration",
          duration: "10:35",
          thumbnail: null,
          videoUrl: "#",
          addedBy: "System Admin",
          dateAdded: "2025-09-23",
          views: 67,
        },
        {
          id: 6,
          title: "Security Settings Configuration",
          description:
            "Step-by-step instructions for configuring security settings and maintaining system integrity.",
          category: "administration",
          duration: "7:50",
          thumbnail: null,
          videoUrl: "#",
          addedBy: "Security Team",
          dateAdded: "2025-09-22",
          views: 94,
        },
        {
          id: 7,
          title: "Partner Onboarding Process",
          description:
            "Complete walkthrough of the partner onboarding process from initial setup to full activation.",
          category: "partner-management",
          duration: "9:30",
          thumbnail: null,
          videoUrl: "#",
          addedBy: "Onboarding Team",
          dateAdded: "2025-09-21",
          views: 112,
        },
        {
          id: 8,
          title: "Advanced Reporting Features",
          description:
            "Learn to create custom reports, schedule automated reports, and export data for external analysis.",
          category: "analytics",
          duration: "13:15",
          thumbnail: null,
          videoUrl: "#",
          addedBy: "Analytics Team",
          dateAdded: "2025-09-20",
          views: 78,
        },
      ];

      function getCurrentUserRole() {
        // In a real application, this would get the current user's role
        // For demo purposes, we'll simulate different roles
        const roles = ["admin", "support", "partner"];
        return localStorage.getItem("currentRole") || "admin"; // Default to admin for demo
      }

      function loadTrainingVideos() {
        const videoGrid = document.getElementById("videoGrid");
        const filteredVideos =
          currentVideoFilter === "all"
            ? trainingVideos
            : trainingVideos.filter((video) => video.category === currentVideoFilter);

        if (filteredVideos.length === 0) {
          videoGrid.innerHTML = `
            <div class="video-empty-state" style="grid-column: 1 / -1;">
              <div class="empty-icon"></div>
              <h3>No videos found</h3>
              <p>No training videos match the selected category. Try selecting a different category or check back later for new content.</p>
            </div>
          `;
          return;
        }

        videoGrid.innerHTML = filteredVideos
          .map(
            (video) => `
          <div class="video-card" onclick="playVideo(${video.id})">
            <div class="video-thumbnail">
              ${
                video.thumbnail
                  ? `<img src="${video.thumbnail}" alt="${video.title}">`
                  : `<div class="placeholder-icon"></div>`
              }
              <div class="play-overlay">
                <span></span>
              </div>
            </div>
            <div class="video-content">
              <h3 class="video-title">${video.title}</h3>
              <p class="video-description">${video.description}</p>
              <div class="video-meta">
                <span class="video-duration">${video.duration}</span>
                <span class="video-category">${video.category.replace("-", " ").replace(/\b\w/g, (l) => l.toUpperCase())}</span>
                <span class="video-views">${video.views} views</span>
              </div>
            </div>
          </div>
        `,
          )
          .join("");

        // Update video count in sidebar
        document.getElementById("videoCount").textContent = trainingVideos.length;
      }

      function filterVideos(category) {
        currentVideoFilter = category;

        // Update active button
        document.querySelectorAll(".category-btn").forEach((btn) => btn.classList.remove("active"));
        event.target.classList.add("active");

        loadTrainingVideos();
      }

      function playVideo(videoId) {
        const video = trainingVideos.find((v) => v.id === videoId);
        if (!video) return;

        const modal = document.getElementById("videoModal");
        const title = document.getElementById("modalVideoTitle");
        const player = document.getElementById("modalVideoPlayer");
        const description = document.getElementById("modalVideoDescription");
        const duration = document.getElementById("modalVideoDuration");
        const category = document.getElementById("modalVideoCategory");
        const date = document.getElementById("modalVideoDate");

        title.textContent = video.title;
        description.textContent = video.description;
        duration.textContent = video.duration;
        category.textContent = video.category
          .replace("-", " ")
          .replace(/\\b\\w/g, (l) => l.toUpperCase());
        date.textContent = `Added ${getRelativeTime(video.dateAdded)}`;

        // In a real application, set the video source
        // player.src = video.videoUrl;

        modal.style.display = "flex";
        document.body.style.overflow = "hidden";

        // Increment view count (in real app, this would be API call)
        video.views++;
      }

      function closeVideoModal() {
        const modal = document.getElementById("videoModal");
        const player = document.getElementById("modalVideoPlayer");

        modal.style.display = "none";
        document.body.style.overflow = "auto";
        player.pause();
      }

      function openAddVideoModal() {
        const currentRole = getCurrentUserRole();
        if (currentRole === "partner") {
          alert(
            "You do not have permission to add videos. Only support staff and administrators can add training videos.",
          );
          return;
        }

        const modal = document.getElementById("addVideoModal");
        modal.style.display = "flex";
        document.body.style.overflow = "hidden";
      }

      function closeAddVideoModal() {
        const modal = document.getElementById("addVideoModal");
        const form = document.getElementById("addVideoForm");

        modal.style.display = "none";
        document.body.style.overflow = "auto";
        form.reset();
      }

      function addNewVideo(event) {
        event.preventDefault();

        const formData = new FormData(event.target);
        const videoFile = formData.get("file");

        if (videoFile.size > 100 * 1024 * 1024) {
          // 100MB limit
          alert("Video file is too large. Maximum size is 100MB.");
          return;
        }

        const newVideo = {
          id: trainingVideos.length + 1,
          title: formData.get("title"),
          description: formData.get("description"),
          category: formData.get("category"),
          duration: "0:00", // Would be calculated from actual video
          thumbnail: null,
          videoUrl: URL.createObjectURL(videoFile), // In real app, upload to server
          addedBy: getCurrentUserRole() === "admin" ? "Admin Team" : "Support Team",
          dateAdded: new Date().toISOString().split("T")[0],
          views: 0,
        };

        trainingVideos.push(newVideo);
        closeAddVideoModal();
        loadTrainingVideos();

        // Show success message
        alert("Training video added successfully!");
      }

      function getRelativeTime(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diffInMs = now - date;
        const diffInDays = Math.floor(diffInMs / (1000 * 60 * 60 * 24));

        if (diffInDays === 0) return "today";
        if (diffInDays === 1) return "1 day ago";
        if (diffInDays < 7) return `${diffInDays} days ago`;
        if (diffInDays < 30) return `${Math.floor(diffInDays / 7)} weeks ago`;
        return `${Math.floor(diffInDays / 30)} months ago`;
      }

      // Close modals when clicking outside
      window.onclick = function (event) {
        const videoModal = document.getElementById("videoModal");
        const addVideoModal = document.getElementById("addVideoModal");

        if (event.target === videoModal) {
          closeVideoModal();
        }
        if (event.target === addVideoModal) {
          closeAddVideoModal();
        }
      };

      // Make functions global
      window.filterVideos = filterVideos;
      window.playVideo = playVideo;
      window.closeVideoModal = closeVideoModal;
      window.openAddVideoModal = openAddVideoModal;
      window.closeAddVideoModal = closeAddVideoModal;
      window.addNewVideo = addNewVideo;
    </script>
  </body>
</html>
